<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grattan Institute • grattan</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Grattan Institute">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">grattan</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.6.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/grattan.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/long-vignettes/budget-2018.html">Budget 2018 modelling</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HughParsonage/grattan">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Grattan Institute</h1>
                        <h4 class="author">Hugh Parsonage</h4>
            
            <h4 class="date">2018-08-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HughParsonage/grattan/blob/master/vignettes/grattan.Rmd"><code>vignettes/grattan.Rmd</code></a></small>
      <div class="hidden name"><code>grattan.Rmd</code></div>

    </div>

    
    
<div id="budget-2018" class="section level2">
<h2 class="hasAnchor">
<a href="#budget-2018" class="anchor"></a>Budget 2018</h2>
<p>For a vignette from the Budget 2018 analysis, see: <a href="https://hughparsonage.github.io/grattan/articles/long-vignettes/budget-2018.html" class="uri">https://hughparsonage.github.io/grattan/articles/long-vignettes/budget-2018.html</a></p>
<p>This vignette collates the vignettes that were present before version 1.5.3.</p>
</div>
<div id="bracket-creep" class="section level1">
<h1 class="hasAnchor">
<a href="#bracket-creep" class="anchor"></a>Bracket creep</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mgcv)
<span class="co">#&gt; Loading required package: nlme</span>
<span class="co">#&gt; This is mgcv 1.8-24. For overview type 'help("mgcv-package")'.</span>
<span class="kw">library</span>(lattice)
<span class="kw">library</span>(dtplyr)
<span class="kw">library</span>(dplyr)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following object is masked from 'package:nlme':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     collapse</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(scales)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(ggrepel)
<span class="kw">library</span>(viridis)
<span class="co">#&gt; Loading required package: viridisLite</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'viridis'</span>
<span class="co">#&gt; The following object is masked from 'package:scales':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     viridis_pal</span>
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(hutils)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'hutils'</span>
<span class="co">#&gt; The following objects are masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     coalesce, if_else</span>
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(data.table)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'data.table'</span>
<span class="co">#&gt; The following objects are masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     between, first, last</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">templib &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/provide.dir">provide.dir</a></span>(templib)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="kw">requireNamespace</span>(<span class="st">"taxstats1516"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>) <span class="op">&amp;&amp;</span>
<span class="st">    </span><span class="kw">requireNamespace</span>(<span class="st">"taxstats"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
  <span class="kw">library</span>(taxstats)
  <span class="kw">library</span>(taxstats1516)
} <span class="cf">else</span> {
  <span class="kw">install.packages</span>(<span class="st">"https://raw.githubusercontent.com/hughparsonage/tax-drat/master/src/contrib/taxstats_0.0.5.1415.tar.gz"</span>,
                   <span class="dt">dependencies =</span> <span class="ot">FALSE</span>,
                   <span class="dt">quiet =</span> <span class="ot">TRUE</span>,
                   <span class="dt">lib =</span> templib,
                   <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                   <span class="dt">repos =</span> <span class="ot">NULL</span>)
  
  <span class="kw">library</span>(<span class="st">"taxstats"</span>,
          <span class="dt">lib.loc =</span> templib,
          <span class="dt">verbose =</span> <span class="ot">TRUE</span>,
          <span class="dt">character.only =</span> <span class="ot">TRUE</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_files_all &lt;-
<span class="st">    </span><span class="kw">rbindlist</span>(<span class="kw">lapply</span>(<span class="kw">list</span>(<span class="st">`</span><span class="dt">2003-04</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0304</span>, 
                          <span class="st">`</span><span class="dt">2004-05</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0405</span>,
                          <span class="st">`</span><span class="dt">2005-06</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0506</span>, 
                          <span class="st">`</span><span class="dt">2006-07</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0607</span>,
                          <span class="st">`</span><span class="dt">2007-08</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0708</span>, 
                          <span class="st">`</span><span class="dt">2008-09</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0809</span>,
                          <span class="st">`</span><span class="dt">2009-10</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0910</span>, 
                          <span class="st">`</span><span class="dt">2010-11</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1011</span>,
                          <span class="st">`</span><span class="dt">2011-12</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1112</span>, 
                          <span class="st">`</span><span class="dt">2012-13</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1213</span>,
                          <span class="st">`</span><span class="dt">2013-14</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1314</span>), 
                     data.table<span class="op">::</span>as.data.table),
              <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
              <span class="dt">fill =</span> <span class="ot">TRUE</span>, 
              <span class="dt">idcol =</span> <span class="st">"fy.year"</span>)
sample_files_all[, WEIGHT <span class="op">:</span><span class="er">=</span><span class="st"> </span>hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/if_else">if_else</a></span>(fy.year <span class="op">&gt;</span><span class="st"> '2010-11'</span>, 50L, 100L)]
age_range_decoder &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(age_range_decoder)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(grattan)
<span class="co">#&gt; Last change: NAMESPACE at 2018-08-14 12:16:30 (3 hours ago).</span></code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette uses a <a href="https://grattan.edu.au/news/young-australians-will-wear-the-costs-of-turnbulls-middle-income-tax-cut/">recent op-ed</a> to demonstrate several tools within the <code>grattan</code> package:</p>
<ol style="list-style-type: decimal">
<li>projection of sample files for analysis over the budget forward estimates, including a flexible assumption about future wage growth</li>
<li>calculating income tax, both under present settings and changes to thresholds or rates.</li>
</ol>
<div id="average-change-of-tax-rates-by-decile" class="section level3">
<h3 class="hasAnchor">
<a href="#average-change-of-tax-rates-by-decile" class="anchor"></a>Average change of tax rates by decile</h3>
<p>Say we want to compare the expected income tax paid by individuals in 2016-17 vs 2020-21. We have 2% sample files from 2012-13 and 2013-14. To do distributional analysis for years beyond 2013-14, we <code>project</code> a sample file as many years ahead as required. So for 2016-17, we use <code>project</code> with <code>h = 4L</code>. (The <code>h</code> stands for ‘’horizon’‘. The <code>L</code> means ’integer’ in R: <code>project</code> insists that the <code>h</code> value is strictly an integer as that is the only type of value that makes sense here.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">1617</span> &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/project.html">project</a></span>(sample_file_<span class="dv">1213</span>,
          <span class="dt">h =</span> 4L,
          <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2012-13"</span>)</code></pre></div>
<p>and similarly for 2020-21 we use <code>h = 8L</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">2021</span> &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/project.html">project</a></span>(sample_file_<span class="dv">1213</span>,
          <span class="dt">h =</span> 8L,
          <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2012-13"</span>)</code></pre></div>
<p>I use <code>fy.year.of.sample.file = "2012-13"</code> rather than <code>= "2013-14"</code> as the former seems to give more accurate forecasts when compared with final budget outcomes in the years that follow.</p>
<p>The next step is to calculate the tax paid for each entry in the sample file for those years. The <code>grattan</code> package provides <code>income_tax</code> for this purpose, with the optional argument <code>.dots.ATO</code> accepting a sample file to take care of the variables that are needed for the complex calculations of offsets and the Medicare levy. The argument <code>fy.year</code> specifies what tax scales to use; for future years, we assume the current settings, unless the Government has announced changes in a future year, such as the expected increase to the Medicare levy. Since the <code>income_tax</code> function only currently works for years as far ahead as 2019-20, we use that year for the 2020-21 projection of the sample file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">1617</span>[, tax_paid <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income,
                                          <span class="dt">.dots.ATO =</span> <span class="kw">copy</span>(sample_file_<span class="dv">1617</span>),
                                          <span class="dt">fy.year =</span> <span class="st">"2016-17"</span>)]
sample_file_<span class="dv">1617</span>[, avg_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax_paid <span class="op">/</span><span class="st"> </span>Taxable_Income]
sample_file_<span class="dv">2021</span>[, tax_paid <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income,
                                          <span class="dt">.dots.ATO =</span> <span class="kw">copy</span>(sample_file_<span class="dv">2021</span>),
                                          <span class="dt">fy.year =</span> <span class="st">"2019-20"</span>)]
sample_file_<span class="dv">2021</span>[, avg_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax_paid <span class="op">/</span><span class="st"> </span>Taxable_Income]</code></pre></div>
<p>To calculate the average (average) tax by decile, we use <code>weighted_ntile</code> with the optional arguments <code>weights</code> left to the default (as the sample file is equiweighted).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_decile_<span class="dv">1617</span> &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">1617</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax =</span> <span class="kw">mean</span>(avg_tax)),
    keyby =<span class="st"> </span>.(<span class="dt">decile =</span> <span class="kw"><a href="../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">10</span>))]

avg_tax_by_decile_<span class="dv">2021</span> &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">2021</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax =</span> <span class="kw">mean</span>(avg_tax)),
    keyby =<span class="st"> </span>.(<span class="dt">decile =</span> <span class="kw"><a href="../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">10</span>))]</code></pre></div>
<p>We can then plot a comparison of these table by joining them and using <code>ggplot2</code>. Since the tables are already keyed by <code>decile</code>, we can use the <code>X[Y]</code> method from <code>data.table</code> to join by <code>decile</code>. This creates a three-column table: the first is <code>decile</code>, the second is <code>avg_tax</code> which is the <code>avg_tax</code> from the 2016-17 table and <code>i.avg_tax</code> which is the <code>avg_tax</code> from the 2020-21 table. (In the result of <code>X[Y]</code>, any column in <code>Y</code> which has the same name as a column in <code>X</code> (but isn’t a key) is prefixed with <code>i.</code> to distinguish it.) We discard the lowest decile as the average tax is <code>NaN</code> for those with zero taxable income. Lastly, for cosmetic reasons, we convert <code>decile</code> to a factor so that the labels on the chart are <code>1, 2, 3, ...</code> rather than <code>0, 2.5, 5, ...</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_decile_<span class="dv">1617</span>[avg_tax_by_decile_<span class="dv">2021</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[decile <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, ppt_increase <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(i.avg_tax <span class="op">-</span><span class="st"> </span>avg_tax)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(decile)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> decile, <span class="dt">y =</span> ppt_increase)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>()</code></pre></div>
<p><img src="grattan_files/figure-html/tax-changes-grattan-forecast-1.png" width="700"></p>
<p>This chart and the underlying data are a reflection of the assumptions in the <code>project</code> function. In particular, the <code>project</code> function uses a particular forecast of the wage price index to uprate the salary column in the sample file. This differs from the assumptions in the 2017 Budget.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Budget_wage_series &lt;-
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw">c</span>(<span class="st">"2017-18"</span>, <span class="st">"2018-19"</span>, <span class="st">"2019-20"</span>, <span class="st">"2020-21"</span>),
             <span class="dt">r =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.03</span>, <span class="fl">0.035</span>, <span class="fl">0.0375</span>))

<span class="kw">kable</span>(Budget_wage_series)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">fy_year</th>
<th align="right">r</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2017-18</td>
<td align="right">0.0250</td>
</tr>
<tr class="even">
<td align="left">2018-19</td>
<td align="right">0.0300</td>
</tr>
<tr class="odd">
<td align="left">2019-20</td>
<td align="right">0.0350</td>
</tr>
<tr class="even">
<td align="left">2020-21</td>
<td align="right">0.0375</td>
</tr>
</tbody>
</table>
<p>The <code>project</code> function expects wages to grow by 7.97% over the period 2016-17 to 2020-21, whereas by the forecast in the Budget this number would be 13.4%. Whatever the merits of each forecast, the <code>project</code> function allows you to specify a particular wage series in the future through the argument <code>wage.series =</code>. We can then repeat the analysis above using those estimates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">1617</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/project.html">project</a></span>(sample_file_<span class="dv">1213</span>,
                            <span class="dt">h =</span> 4L,
                            <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2012-13"</span>)

sample_file_<span class="dv">2021</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/project.html">project</a></span>(sample_file_<span class="dv">1213</span>,
                            <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2012-13"</span>,
                            <span class="dt">h =</span> 8L,
                            <span class="dt">wage.series =</span> Budget_wage_series)

sample_file_<span class="dv">1617</span>[, tax_paid <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income,
                                          <span class="dt">.dots.ATO =</span> <span class="kw">copy</span>(sample_file_<span class="dv">1617</span>),
                                          <span class="dt">fy.year =</span> <span class="st">"2016-17"</span>)]
sample_file_<span class="dv">1617</span>[, avg_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax_paid <span class="op">/</span><span class="st"> </span>Taxable_Income]
sample_file_<span class="dv">2021</span>[, tax_paid <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income,
                                          <span class="dt">.dots.ATO =</span> <span class="kw">copy</span>(sample_file_<span class="dv">2021</span>),
                                          <span class="dt">fy.year =</span> <span class="st">"2019-20"</span>)]
sample_file_<span class="dv">2021</span>[, avg_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax_paid <span class="op">/</span><span class="st"> </span>Taxable_Income]

avg_tax_by_decile_<span class="dv">1617</span> &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">1617</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax =</span> <span class="kw">mean</span>(avg_tax)),
    keyby =<span class="st"> </span>.(<span class="dt">decile =</span> <span class="kw"><a href="../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">10</span>))]

avg_tax_by_decile_<span class="dv">2021</span> &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">2021</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax =</span> <span class="kw">mean</span>(avg_tax)),
    keyby =<span class="st"> </span>.(<span class="dt">decile =</span> <span class="kw"><a href="../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">10</span>))]

difference_2021_Budget &lt;-
<span class="st">  </span>avg_tax_by_decile_<span class="dv">1617</span>[avg_tax_by_decile_<span class="dv">2021</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[decile <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, ppt_increase <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">100</span><span class="op">*</span>(i.avg_tax <span class="op">-</span><span class="st"> </span>avg_tax)]

difference_2021_Budget <span class="op">%&gt;%</span>
<span class="st">  </span>copy <span class="op">%&gt;%</span>
<span class="st">  </span>.[, decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(decile)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> decile, <span class="dt">y =</span> ppt_increase)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>()</code></pre></div>
<p><img src="grattan_files/figure-html/project-with-respect-to-budget-1.png" width="700"></p>
<p>Through some intermediate calculations, we can obtain the sentence that was used in the op-ed:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">middle_income_avg_inc &lt;-
<span class="st">  </span>difference_2021_Budget <span class="op">%&gt;%</span>
<span class="st">  </span>.[decile <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)] <span class="op">%$%</span>
<span class="st">  </span><span class="kw">range</span>(<span class="kw">round</span>(ppt_increase, <span class="dv">1</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">1617</span>[, percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">100</span>)]
<span class="kw">stopifnot</span>(<span class="dv">56</span> <span class="op">%in%</span><span class="st"> </span>sample_file_<span class="dv">1617</span>[Taxable_Income <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">49500</span>, <span class="dv">50500</span>)][[<span class="st">"percentile"</span>]])

avg_tax_rate_2017_50k &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">1617</span>[percentile <span class="op">==</span><span class="st"> </span><span class="dv">56</span>] <span class="op">%$%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mean</span>(avg_tax) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">round</span>(<span class="dv">3</span>)

avg_tax_rate_2021_50k &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">2021</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[, percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">100</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[percentile <span class="op">==</span><span class="st"> </span><span class="dv">56</span>] <span class="op">%$%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mean</span>(avg_tax) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">round</span>(<span class="dv">3</span>)</code></pre></div>
<blockquote>
<p>Middle-income earners are particularly hurt by bracket creep. Based on the wages growth projected in the 2016 budget, the average tax rates for people in middle-income groups will increase by between 1.6 and 2.5 percentage points by 2021. For example, a person earning $50,000 a year will go from paying an average tax rate of 17.2 per cent in 2017 to 19.2 per cent in 2021.</p>
</blockquote>
</div>
<div id="income-tax-with-changes-to-rates" class="section level3">
<h3 class="hasAnchor">
<a href="#income-tax-with-changes-to-rates" class="anchor"></a>Income tax with changes to rates</h3>
<p>We can also use the package to estimate the revenue difference under changes to the marginal tax rates. The following function accepts two arguments: the bracket number to modified, and a rate increase to that bracket. The function returns the change in revenue (as a loss).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tax_delta &lt;-<span class="st"> </span><span class="cf">function</span>(bracket_number, <span class="dt">rate_increase =</span> <span class="op">-</span><span class="fl">0.01</span>) {
  current_tax &lt;-
<span class="st">    </span>sample_file_<span class="dv">2021</span>[, .(<span class="dt">tax =</span> <span class="kw">sum</span>(tax_paid), 
                         <span class="dt">WEIGHT =</span> WEIGHT[<span class="dv">1</span>])] <span class="op">%$%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">sum</span>(tax <span class="op">*</span><span class="st"> </span>WEIGHT)
  
  orig_rates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span>, <span class="fl">0.325</span>, <span class="fl">0.37</span>, <span class="fl">0.45</span>)
  new_rates &lt;-<span class="st"> </span>orig_rates
  new_rates[bracket_number] &lt;-<span class="st"> </span>new_rates[bracket_number] <span class="op">+</span><span class="st"> </span>rate_increase
    
  <span class="co"># rebate_income is an internal function</span>
  .ri &lt;-<span class="st"> </span>grattan<span class="op">:::</span>rebate_income
  
  new_tax &lt;-<span class="st"> </span>
<span class="st">    </span>sample_file_<span class="dv">2021</span> <span class="op">%&gt;%</span>
<span class="st">    </span>copy <span class="op">%&gt;%</span>
<span class="st">    </span>.[, base_tax. <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/IncomeTax.html">IncomeTax</a></span>(Taxable_Income,
                              <span class="dt">thresholds =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="dv">37000</span>, <span class="dv">87000</span>, <span class="fl">180e3</span>),
                              <span class="dt">rates =</span> new_rates)] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, medicare_levy. <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/medicare_levy.html">medicare_levy</a></span>(<span class="dt">income =</span> Taxable_Income, <span class="dt">fy.year =</span> <span class="st">"2019-20"</span>,
                                       <span class="dt">Spouse_income =</span> Spouse_adjusted_taxable_inc,
                                       <span class="dt">sapto.eligible =</span> (age_range <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>),
                                       <span class="dt">family_status =</span> <span class="kw">if_else</span>(Spouse_adjusted_taxable_inc <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">"family"</span>, <span class="st">"individual"</span>))] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, lito. <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/lito.html">lito</a></span>(Taxable_Income, <span class="dt">max_lito =</span> <span class="dv">445</span>, <span class="dt">lito_taper =</span> <span class="fl">0.015</span>, <span class="dt">min_bracket =</span> <span class="dv">37000</span>)] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, rebate_income <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">.ri</span>(Taxable_Income,
                             <span class="dt">Rptbl_Empr_spr_cont_amt =</span> Rptbl_Empr_spr_cont_amt,
                             <span class="dt">Net_fincl_invstmt_lss_amt =</span> Net_fincl_invstmt_lss_amt,
                             <span class="dt">Net_rent_amt =</span> Net_rent_amt,
                             <span class="dt">Rep_frng_ben_amt =</span> Rep_frng_ben_amt)] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, sapto. <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/sapto.html">sapto</a></span>(rebate_income, <span class="dt">fy.year =</span> <span class="st">"2019-20"</span>, <span class="dt">sapto.eligible =</span> (age_range <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>))] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, tax_payable <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(base_tax. <span class="op">-</span><span class="st"> </span>lito. <span class="op">-</span><span class="st"> </span>sapto., <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>medicare_levy.] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, .(<span class="dt">tax =</span> <span class="kw">sum</span>(tax_payable), 
          <span class="dt">WEIGHT =</span> WEIGHT[<span class="dv">1</span>])] <span class="op">%$%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">sum</span>(tax <span class="op">*</span><span class="st"> </span>WEIGHT)
  
  current_tax <span class="op">-</span><span class="st"> </span>new_tax
}</code></pre></div>
<p>which leads to the sentence and table in the op-ed:</p>
<blockquote>
<p>For example, if the government was to reduce the tax rate only in the middle (37,000-87,000) bracket from 32.5% to 30%, the promised $7.8 billion surplus in 2021 would all but be swallowed up by the 6.8 bn revenue loss.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data.table</span>(<span class="dt">tax_bracket =</span> <span class="kw">c</span>(<span class="st">"&lt;18,200"</span>,
                           <span class="st">"18,200-37,000"</span>,
                           <span class="st">"37,000-87,000"</span>,
                           <span class="st">"87,000-180,000"</span>,
                           <span class="st">"180,000+"</span>),
           <span class="dt">budget_impact =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">round</span>(<span class="kw">vapply</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">5</span>, tax_delta, <span class="dt">FUN.VALUE =</span> <span class="kw">double</span>(<span class="dv">1</span>)) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span>kable</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">tax_bracket</th>
<th align="right">budget_impact</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">&lt;18,200</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">18,200-37,000</td>
<td align="right">1.21</td>
</tr>
<tr class="odd">
<td align="left">37,000-87,000</td>
<td align="right">2.24</td>
</tr>
<tr class="even">
<td align="left">87,000-180,000</td>
<td align="right">0.79</td>
</tr>
<tr class="odd">
<td align="left">180,000+</td>
<td align="right">0.40</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="companion-to-the-2013-14-sample-file" class="section level1">
<h1 class="hasAnchor">
<a href="#companion-to-the-2013-14-sample-file" class="anchor"></a>Companion to the 2013-14 sample file</h1>
<div id="prologue" class="section level2">
<h2 class="hasAnchor">
<a href="#prologue" class="anchor"></a>Prologue</h2>
<p>This vignette is a mirror of a small book prepared internally by Grattan Institute. The goal is to demonstrate how to perform simple analysis and create common charts. You will need the <code>taxstats</code> package available via <code><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">devtools::install_github('hughparsonage/taxstats')</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="st">"scipen"</span> =<span class="st"> </span><span class="dv">99</span>)
opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">fig.width =</span> <span class="dv">9</span>,
               <span class="dt">fig.height =</span> <span class="fl">6.5</span>,
               <span class="dt">warn =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FY.YEAR &lt;-<span class="st"> "2013-14"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wsum &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">w =</span> <span class="dv">1</span>){
  <span class="kw">sum</span>((x) <span class="op">*</span><span class="st"> </span>w)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grattan_dollar &lt;-<span class="st"> </span><span class="cf">function</span> (x, <span class="dt">digits =</span> <span class="dv">0</span>) {
  <span class="co">#</span>
  nsmall &lt;-<span class="st"> </span>digits
  commaz &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">abs</span>(x), <span class="dt">nsmall =</span> nsmall, <span class="dt">trim =</span> <span class="ot">TRUE</span>, <span class="dt">big.mark =</span> <span class="st">","</span>, 
                   <span class="dt">scientific =</span> <span class="ot">FALSE</span>, <span class="dt">digits =</span> 1L)
  
  <span class="kw">if_else</span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, 
          <span class="kw">paste0</span>(<span class="st">"\U2212"</span>,<span class="st">"$"</span>, commaz),
          <span class="kw">paste0</span>(<span class="st">"$"</span>, commaz))
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file &lt;-<span class="st"> </span>sample_files_all[fy.year <span class="op">==</span><span class="st"> </span>FY.YEAR]
sample_file &lt;-<span class="st"> </span><span class="kw">merge</span>(sample_file, age_range_decoder, <span class="dt">by =</span> <span class="st">"age_range"</span>)
PREV.FY.YEAR &lt;-<span class="st"> </span><span class="kw"><a href="../reference/is.fy.html">yr2fy</a></span>(<span class="kw"><a href="../reference/is.fy.html">fy2yr</a></span>(FY.YEAR) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
sample_file_prev &lt;-<span class="st"> </span>sample_files_all[fy.year <span class="op">==</span><span class="st"> </span>PREV.FY.YEAR]
sample_file_prev &lt;-<span class="st"> </span><span class="kw">merge</span>(sample_file_prev, age_range_decoder, <span class="dt">by =</span> <span class="st">"age_range"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">48031</span>)
sample_file <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(age_range_description) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">min_age =</span> <span class="kw">if_else</span>(<span class="kw">grepl</span>(<span class="st">"to"</span>, age_range_description), 
                           <span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">"^([0-9]{2}).*$"</span>, <span class="st">"</span><span class="ch">\\</span><span class="st">1"</span>, age_range_description)), 
                           <span class="kw">if_else</span>(<span class="kw">grepl</span>(<span class="st">"70"</span>, age_range_description),
                                   <span class="dv">70</span>, 
                                   <span class="dv">15</span>)),
         <span class="dt">max_age =</span> min_age <span class="op">+</span><span class="st"> </span><span class="dv">5</span>, 
         <span class="dt">age_imp =</span> <span class="kw">runif</span>(<span class="kw">n</span>(), min_age, max_age)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>min_age, <span class="op">-</span>max_age)
<span class="co">#&gt; Warning in if_else(grepl("to", age_range_description),</span>
<span class="co">#&gt; as.numeric(gsub("^([0-9]{2}).*$", : NAs introduced by coercion</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file <span class="op">%&lt;&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tax_Bracket =</span> <span class="kw">cut</span>(Taxable_Income, 
                           <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">18200</span>, <span class="fl">37e3</span>, <span class="fl">80e3</span>, <span class="fl">180e3</span>, <span class="ot">Inf</span>),
                           <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>, 
                           <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"$0-$18,200"</span>, 
                                      <span class="st">"$18,201-$37,000"</span>, 
                                      <span class="st">"37,001-$80,000"</span>, 
                                      <span class="st">"$80,001-$180,000"</span>, 
                                      <span class="st">"$180,000+"</span>)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">texNum &lt;-<span class="st"> </span><span class="cf">function</span>(number, <span class="dt">sig.figs =</span> 3L, <span class="dt">dollar =</span> <span class="ot">FALSE</span>, <span class="dt">pre.phrase =</span> <span class="ot">NULL</span>, <span class="dt">.suffix =</span> <span class="ot">NULL</span>){
  orig.number &lt;-<span class="st"> </span>number
  <span class="kw">stopifnot</span>(<span class="kw">is.numeric</span>(number), <span class="kw">length</span>(number) <span class="op">==</span><span class="st"> </span>1L)
  is.negative &lt;-<span class="st"> </span>number <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>
  number &lt;-<span class="st"> </span><span class="kw">abs</span>(number)
  <span class="cf">if</span> (number <span class="op">==</span><span class="st"> </span><span class="dv">0</span>){
    <span class="kw">warning</span>(<span class="st">"Returning 0"</span>)
    <span class="kw">return</span>(<span class="dv">0</span>)
  } <span class="cf">else</span> {
    <span class="cf">if</span> (<span class="kw">is.null</span>(.suffix)){
    n.digits &lt;-<span class="st"> </span><span class="kw">ceiling</span>(<span class="kw">log10</span>(number))
    
    suffix &lt;-<span class="st"> </span><span class="ot">NULL</span>
    suffix_val &lt;-<span class="st"> </span><span class="dv">1</span>
    
    <span class="cf">if</span> (n.digits <span class="op">&lt;</span><span class="st"> </span>sig.figs){
      prefix &lt;-<span class="st"> </span><span class="kw">signif</span>(<span class="dt">x =</span> number, <span class="dt">digits =</span> sig.figs)
    } <span class="cf">else</span> {
      
      <span class="cf">if</span> (n.digits <span class="op">&lt;=</span><span class="st"> </span><span class="dv">6</span>) {
        prefix_val &lt;-<span class="st"> </span><span class="kw">round</span>(number, sig.figs <span class="op">-</span><span class="st"> </span>n.digits <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
        prefix &lt;-<span class="st"> </span><span class="kw">prettyNum</span>(prefix_val, <span class="dt">big.mark =</span> <span class="st">","</span>, <span class="dt">scientific =</span> <span class="ot">FALSE</span>)
      } <span class="cf">else</span> {
        <span class="co"># Want to show only the number / 10^(multiple of 3) then the suffix multiplier</span>
        suffix_val &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">^</span><span class="st"> </span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>((n.digits <span class="op">%/%</span><span class="st"> </span><span class="dv">3</span>)))
        prefix_val &lt;-<span class="st"> </span><span class="kw">signif</span>(number<span class="op">/</span>suffix_val, <span class="dt">digits =</span> sig.figs)
        prefix &lt;-<span class="st"> </span>prefix_val
        
        <span class="cf">if</span> (suffix_val <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">12</span>){
          <span class="cf">switch</span>(<span class="kw">log10</span>(suffix_val) <span class="op">/</span><span class="st"> </span><span class="dv">3</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,
                 suffix &lt;-<span class="st"> "~million"</span>, 
                 suffix &lt;-<span class="st"> "~billion"</span>, 
                 suffix &lt;-<span class="st"> "~trillion"</span>)
        } <span class="cf">else</span> {
          prefix &lt;-<span class="st"> </span><span class="kw">signif</span>(number <span class="op">/</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">12</span>, <span class="dt">digits =</span> sig.figs)
          suffix &lt;-<span class="st"> "~trillion"</span>
        }
      }
    }
    } <span class="cf">else</span> {
      <span class="kw">stopifnot</span>(.suffix <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"million"</span>, <span class="st">"billion"</span>, <span class="st">"trillion"</span>))
      <span class="cf">switch</span>(.suffix, 
             <span class="st">"million"</span> =<span class="st"> </span>{
              prefix &lt;-<span class="st"> </span><span class="kw">signif</span>(number <span class="op">/</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span>, <span class="dt">digits =</span> sig.figs)
              suffix &lt;-<span class="st"> "~million"</span>
              suffix_val &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">6</span>
             }, 
             <span class="st">"billion"</span> =<span class="st"> </span>{
               prefix &lt;-<span class="st"> </span><span class="kw">signif</span>(number <span class="op">/</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">9</span>, <span class="dt">digits =</span> sig.figs)
               suffix &lt;-<span class="st"> "~billion"</span>
               suffix_val &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">9</span>
             }, 
             <span class="st">"trillion"</span> =<span class="st"> </span>{
               prefix &lt;-<span class="st"> </span><span class="kw">signif</span>(number <span class="op">/</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">12</span>, <span class="dt">digits =</span> sig.figs)
               suffix &lt;-<span class="st"> "~trillion"</span>
               suffix_val &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">12</span>
             })
      prefix_val &lt;-<span class="st"> </span>prefix
    }
    
    <span class="cf">if</span> (dollar){
      out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">$"</span>, prefix, suffix)
    } <span class="cf">else</span> {
      out &lt;-<span class="st"> </span><span class="kw">paste0</span>(prefix, suffix)
    }
    
    <span class="cf">if</span> (is.negative){
      <span class="co"># General LaTeX</span>
      out &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"</span><span class="ch">\\</span><span class="st">(-</span><span class="ch">\\</span><span class="st">)"</span>, out)
    }
    <span class="co"># is the displayed number larger than the original?</span>
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(pre.phrase)){
      out_larger &lt;-<span class="st"> </span>prefix_val <span class="op">*</span><span class="st"> </span>suffix_val <span class="op">&gt;</span><span class="st"> </span>orig.number
      
        <span class="cf">if</span> (out_larger) {
          out &lt;-<span class="st"> </span><span class="kw">paste</span>(pre.phrase[<span class="dv">1</span>], out, <span class="dt">sep =</span> <span class="cf">if</span>(<span class="kw">grepl</span>(<span class="st">"~$"</span>, pre.phrase[<span class="dv">1</span>])) <span class="st">""</span> <span class="cf">else</span> <span class="st">" "</span>)
        } <span class="cf">else</span> {
          <span class="cf">if</span> (<span class="op">!</span><span class="kw">isTRUE</span>(<span class="kw">all.equal</span>(prefix_val <span class="op">*</span><span class="st"> </span>suffix_val, 
                                orig.number, 
                                <span class="dt">tolerance =</span> .Machine<span class="op">$</span>double.eps)))
            out &lt;-<span class="st"> </span><span class="kw">paste</span>(pre.phrase[<span class="dv">2</span>], out, <span class="dt">sep =</span> <span class="cf">if</span>(<span class="kw">grepl</span>(<span class="st">"~$"</span>, pre.phrase[<span class="dv">2</span>])) <span class="st">""</span> <span class="cf">else</span> <span class="st">" "</span>)
        }
      
    }
    <span class="kw">return</span>(out)
  }
}</code></pre></div>
<p>There were 12.9~million taxpayers in 2013-14 in Australia. Of those, 180,000 had zero taxable income (or a taxable loss). (… and so these ‘’taxpayers’’ naturally paid no tax. Nor did the 2.5~million individuals below the tax-free threshold. For this vignette, a <em>taxpayer</em> is anyone who lodged a tax return, regardless of their tax liability).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tx_inc_q &lt;-<span class="st"> </span><span class="cf">function</span>(q){
  <span class="kw">quantile</span>(sample_file<span class="op">$</span>Taxable_Income, <span class="dt">probs =</span> q)
}

my_labs &lt;-<span class="st"> </span><span class="kw">grattan_dollar</span>(<span class="kw">tx_inc_q</span>((<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)<span class="op">/</span><span class="dv">10</span>))
my_labs[<span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)] &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, my_labs[<span class="kw">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>)])

dens &lt;-<span class="st"> </span><span class="kw">density</span>(sample_file[Taxable_Income <span class="op">&lt;</span><span class="st"> </span><span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>)]<span class="op">$</span>Taxable_Income)
DF &lt;-<span class="st"> </span><span class="kw">with</span>(dens, <span class="kw">data.frame</span>(x, y))

sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">between</span>(Taxable_Income, <span class="dv">0</span>, <span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">"Taxable Income deciles"</span>, 
                     <span class="dt">labels =</span> <span class="kw">c</span>(my_labs, <span class="kw">grattan_dollar</span>(<span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>))),
                     <span class="co"># limits = c(0, tx_inc_q(0.95)),</span>
                     <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="kw">tx_inc_q</span>((<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)<span class="op">/</span><span class="dv">10</span>), <span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>, 
        <span class="dt">axis.line.y =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="grattan_files/figure-html/taxable-income-quantiles-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">cut</span>(x, 
                                     <span class="dt">breaks =</span> <span class="kw">quantile</span>(sample_file<span class="op">$</span>Taxable_Income,
                                                       <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)<span class="op">/</span><span class="dv">10</span>), 
                                     <span class="dt">right =</span> <span class="ot">TRUE</span>,
                                     <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">between</span>(x, <span class="op">-</span><span class="dv">1</span>, <span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>) <span class="op">*</span><span class="st"> </span><span class="fl">1.05</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>{
    <span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_area</span>(<span class="dt">color =</span> <span class="st">"black"</span>, <span class="dt">size =</span> <span class="fl">1.45</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y, 
                    <span class="dt">group =</span> Taxable_Income_decile, 
                    <span class="dt">fill =</span> <span class="kw">factor</span>(Taxable_Income_decile),
                    <span class="dt">color =</span> <span class="kw">factor</span>(Taxable_Income_decile))) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">scale_color_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">scale_x_continuous</span>(<span class="st">"Taxable Income deciles"</span>, 
                         <span class="dt">labels =</span> <span class="kw">c</span>(my_labs, <span class="kw">grattan_dollar</span>(<span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>))),
                         <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),
                         <span class="co"># limits = c(-1, tx_inc_q(0.95)*1.05),</span>
                         <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="kw">tx_inc_q</span>((<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)<span class="op">/</span><span class="dv">10</span>), <span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(.<span class="op">$</span>y) <span class="op">*</span><span class="st"> </span><span class="fl">1.05</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>, 
        <span class="dt">axis.line.y =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())<span class="op">+</span><span class="st"> </span>
<span class="st">      </span>
<span class="st">      </span><span class="kw">annotate</span>(<span class="st">"text"</span>,
               <span class="dt">x =</span> <span class="kw">tx_inc_q</span>(<span class="fl">0.925</span>), 
               <span class="dt">y =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">max</span>(.<span class="op">$</span>y[.<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="kw">tx_inc_q</span>(<span class="fl">0.925</span>)]),
               <span class="dt">size =</span> <span class="dv">10</span><span class="op">/</span>(<span class="dv">14</span><span class="op">/</span><span class="dv">5</span>),
               <span class="dt">label =</span> <span class="kw">paste0</span>(<span class="st">"5% of taxpayers</span><span class="ch">\n</span><span class="st">had incomes</span><span class="ch">\n</span><span class="st">greater than</span><span class="ch">\n</span><span class="st">"</span>, <span class="kw">grattan_dollar</span>(<span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>))),
               <span class="dt">hjust =</span> <span class="dv">0</span>,
               <span class="dt">vjust =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">annotate</span>(<span class="st">"segment"</span>, 
               <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">type =</span> <span class="st">"closed"</span>, <span class="dt">length =</span> <span class="kw">unit</span>(<span class="dv">11</span>, <span class="st">"pt"</span>), <span class="dt">angle =</span> <span class="dv">20</span>),
               <span class="dt">x =</span> <span class="kw">tx_inc_q</span>(<span class="fl">0.925</span>), 
               <span class="dt">y =</span> <span class="fl">1.9</span> <span class="op">*</span><span class="st"> </span><span class="kw">max</span>(.<span class="op">$</span>y[.<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="kw">tx_inc_q</span>(<span class="fl">0.925</span>)]),
               <span class="dt">size =</span> <span class="dv">1</span>,
               <span class="dt">xend =</span> <span class="kw">tx_inc_q</span>(<span class="fl">0.95</span>),
               <span class="dt">yend =</span> <span class="fl">1.9</span> <span class="op">*</span><span class="st"> </span><span class="kw">max</span>(.<span class="op">$</span>y[.<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="kw">tx_inc_q</span>(<span class="fl">0.925</span>)])) 
  }</code></pre></div>
<p><img src="grattan_files/figure-html/taxable-income-quantiles-filled-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_CGs &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Tot_CY_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(WEIGHT)

n_CGs_prev &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_prev <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Tot_CY_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(WEIGHT)

tot_CG_amt &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(<span class="kw">as.numeric</span>(Tot_CY_CG_amt <span class="op">*</span><span class="st"> </span>WEIGHT))

tot_Net_CG_amt &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(<span class="kw">as.numeric</span>(Net_CG_amt <span class="op">*</span><span class="st"> </span>WEIGHT))

tax_on_CG &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR), 
         <span class="dt">tax_wo_CG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(<span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Taxable_Income <span class="op">-</span><span class="st"> </span>Net_CG_amt, <span class="dv">0</span>), <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">sum</span>((tax <span class="op">-</span><span class="st"> </span>tax_wo_CG) <span class="op">*</span><span class="st"> </span>WEIGHT),
            <span class="dt">avg =</span> <span class="kw">mean</span>(tax <span class="op">-</span><span class="st"> </span>tax_wo_CG))

tax_on_CG_prev &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_prev <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR), 
         <span class="dt">tax_wo_CG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(<span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Taxable_Income <span class="op">-</span><span class="st"> </span>Net_CG_amt, <span class="dv">0</span>), <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total =</span> <span class="kw">sum</span>((tax <span class="op">-</span><span class="st"> </span>tax_wo_CG) <span class="op">*</span><span class="st"> </span>WEIGHT),
            <span class="dt">avg =</span> <span class="kw">mean</span>(tax <span class="op">-</span><span class="st"> </span>tax_wo_CG))
  </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">latex_percent &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">gsub</span>(<span class="st">"%"</span>, <span class="st">"</span><span class="ch">\\</span><span class="st">%"</span>, <span class="kw">percent</span>(x), <span class="dt">fixed =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>The capital gains discount applies to assets sold after more than 12 months’ holding. There were 840,000 individuals who sold capital assets, up 8.84% from last year. The sale of their assets totalled $34.2~billion of which $12.9~billion comprised part of their taxable income.</p>
<p>The tax on these capital gains totalled $4.76~billion or $7,900 per individual with capital gains tax.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">probCG_by_age &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(age_range_description) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">probCG =</span> <span class="kw">mean</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))

probCG_twenties &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(age_imp <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)

probCG_65p &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(age_imp <span class="op">&gt;=</span><span class="st"> </span><span class="dv">65</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)

avg_marginal_rate_CG &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">marginal_rate =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">fy.year =</span> FY.YEAR) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%$%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mean</span>(marginal_rate)

avg_marginal_rate_CG_weighted_by_CG &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">marginal_rate =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">fy.year =</span> FY.YEAR) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%$%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">weighted.mean</span>(marginal_rate, Net_CG_amt)

avg_marginal_rate_b4_CG &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, 
         age_imp <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_b4_CG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Taxable_Income <span class="op">-</span><span class="st"> </span>Net_CG_amt, <span class="dv">0</span>),
         <span class="dt">marginal_rate_b4_CG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_b4_CG <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">fy.year =</span> FY.YEAR) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_b4_CG, <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">is_in_workforce =</span> <span class="kw">between</span>(age_imp, <span class="dv">20</span>, <span class="dv">65</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(is_in_workforce) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_marginal_rate_weighted =</span> <span class="kw">weighted.mean</span>(marginal_rate_b4_CG, Net_CG_amt), 
            <span class="dt">avg_marginal_Rate =</span> <span class="kw">mean</span>(marginal_rate_b4_CG))

prop_no_CGT_discount &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apparent_discount =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Net_CG_amt <span class="op">/</span><span class="st"> </span>Tot_CY_CG_amt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Tot_CY_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(apparent_discount <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)

prop_100pc_CGT_discount &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apparent_discount =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Net_CG_amt <span class="op">/</span><span class="st"> </span>Tot_CY_CG_amt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Tot_CY_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(apparent_discount <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)

prop_50pc_CGT_discount &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apparent_discount =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Net_CG_amt <span class="op">/</span><span class="st"> </span>Tot_CY_CG_amt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Tot_CY_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(<span class="kw">between</span>(apparent_discount, <span class="fl">0.45</span>, <span class="fl">0.55</span>))

prop_no_CGT_discount_by_val &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apparent_discount =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Net_CG_amt <span class="op">/</span><span class="st"> </span>Tot_CY_CG_amt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Tot_CY_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">weighted.mean</span>(apparent_discount <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, Tot_CY_CG_amt)

cgt_ratio_res &lt;-<span class="st"> </span><span class="dv">50</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(Tot_CY_CG_amt, Net_CG_amt, WEIGHT) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Tot_CY_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apparent_discount =</span> Net_CG_amt <span class="op">/</span><span class="st"> </span>Tot_CY_CG_amt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">apparent_discount_round =</span> <span class="kw">round</span>(apparent_discount <span class="op">*</span><span class="st"> </span>cgt_ratio_res) <span class="op">/</span><span class="st"> </span>cgt_ratio_res) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(apparent_discount_round) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_taxpayers =</span> <span class="kw">sum</span>(WEIGHT), 
            <span class="dt">n_taxpayers_by_val =</span> <span class="kw">sum</span>(<span class="kw">as.double</span>(WEIGHT <span class="op">*</span><span class="st"> </span>Tot_CY_CG_amt))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> apparent_discount_round, <span class="dt">y =</span> n_taxpayers_by_val)) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Ratio of Net capital gains to Total capital gains"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">width =</span> <span class="dv">1</span><span class="op">/</span>cgt_ratio_res) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="grattan_files/figure-html/Ratio-Net-CG-to-Tot-CG-1.png" width="864"></p>
<p>Taxable capital gains are typically realized later in life. This is unsurprising: a capital gain can only be realized when one has an asset to sell. Further, the capital gains tax makes the sale of assets less attractive when incomes are high. Taxpayers in their twenties have a 1.28% chance of incurring capital gains tax, whereas 11.8% of those of retirement age have capital gains.  shows that although capital gains have been more common with older taxpayers, the age skew is slightly more pronounced in 2013-14 than in previous years.</p>
<p>The average marginal tax rate of those with capital gains tax was 29.1%; however, this weights an individual with a capital gain of $1 equally as someone with a capital gain of $500,000. Weighting by the value of capital gain, the average marginal tax rate was 40.6%.</p>
<p>The net capital gains includes the CGT discount (and other discounts) applied to: <span class="math display">\[\text{Total capital gains} - \text{Total capital losses (incl. from prev. years)}\]</span> Comparing the ratio  of  can shed some light on the value of the discount and the impact of capital losses on tax and tax revenue. Of those with nonzero total capital gains, 8.79% had no discount and 28.5% paid no tax (or a 100% discount). Some 45.3% had net capital gains of around 50% of their total gains. Weighting these numbers by the value of total capital gains, 1.51% of capital gains are taxed at the full marginal rate.  shows the distribution of this ratio. The deviance from 50% is due to some gains being realized within 12 months and (more commonly) capital losses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CG_descriptive_by_bracket &lt;-<span class="st"> </span>
sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR), 
         <span class="dt">tax_wo_CG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(<span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Taxable_Income <span class="op">-</span><span class="st"> </span>Net_CG_amt, <span class="dv">0</span>), <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Tax_Bracket) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_taxpayers =</span> <span class="kw">sum</span>(WEIGHT),
            <span class="dt">n_CG =</span> <span class="kw">sum</span>(WEIGHT[Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>]),
            <span class="dt">val_CG =</span> <span class="kw">sum</span>(<span class="kw">as.double</span>(Tot_CY_CG_amt <span class="op">*</span><span class="st"> </span>WEIGHT)), 
            <span class="dt">total_CGT =</span> <span class="kw">sum</span>(<span class="kw">as.double</span>((tax <span class="op">-</span><span class="st"> </span>tax_wo_CG) <span class="op">*</span><span class="st"> </span>WEIGHT))) <span class="op">%&gt;%</span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Tax_Bracket) </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CG_descriptive_by_bracket <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># cosmetic</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxpayers =</span> <span class="kw">comma</span>(n_taxpayers),
         <span class="st">`</span><span class="dt">with CG</span><span class="st">`</span> =<span class="st"> </span><span class="kw">comma</span>(n_CG),
         <span class="st">`</span><span class="dt">Total cap. gains ($)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">grattan_dollar</span>(val_CG),
         <span class="st">`</span><span class="dt">Total CGT ($)</span><span class="st">`</span> =<span class="st"> </span><span class="kw">grattan_dollar</span>(total_CGT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">Tax bracket</span><span class="st">`</span> =<span class="st"> </span>Tax_Bracket,
         <span class="st">`</span><span class="dt">Taxpayers</span><span class="st">`</span>, <span class="st">`</span><span class="dt">with CG</span><span class="st">`</span>, <span class="st">`</span><span class="dt">Total cap. gains ($)</span><span class="st">`</span>, <span class="st">`</span><span class="dt">Total CGT ($)</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">"rrrrrr"</span>) </code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Tax bracket</th>
<th align="right">Taxpayers</th>
<th align="right">with CG</th>
<th align="right">Total cap. gains ($)</th>
<th align="right">Total CGT ($)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">$0-$18,200</td>
<td align="right">2,512,650</td>
<td align="right">84,000</td>
<td align="right">$2,503,663,250</td>
<td align="right">$0</td>
</tr>
<tr class="even">
<td align="right">$18,201-$37,000</td>
<td align="right">3,101,900</td>
<td align="right">118,300</td>
<td align="right">$1,958,287,950</td>
<td align="right">$64,130,858</td>
</tr>
<tr class="odd">
<td align="right">37,001-$80,000</td>
<td align="right">4,808,650</td>
<td align="right">185,600</td>
<td align="right">$4,696,316,500</td>
<td align="right">$413,550,412</td>
</tr>
<tr class="even">
<td align="right">$80,001-$180,000</td>
<td align="right">2,135,400</td>
<td align="right">151,350</td>
<td align="right">$7,373,503,900</td>
<td align="right">$965,377,002</td>
</tr>
<tr class="odd">
<td align="right">$180,000+</td>
<td align="right">380,100</td>
<td align="right">61,150</td>
<td align="right">$17,649,661,600</td>
<td align="right">$3,314,621,140</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age_imp, <span class="dt">y =</span> <span class="kw">as.numeric</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">color =</span> <span class="kw">viridis</span>(<span class="dv">1</span>), <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent) 
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></code></pre></div>
<p><img src="grattan_files/figure-html/CG-incidence-by-age-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(age_range, Net_CG_amt, fy.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">merge</span>(age_range_decoder, <span class="dt">by =</span> <span class="st">"age_range"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(age_range_description) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">min_age =</span> <span class="kw">if_else</span>(<span class="kw">grepl</span>(<span class="st">"to"</span>, age_range_description), 
                           <span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">"^([0-9]{2}).*$"</span>, <span class="st">"</span><span class="ch">\\</span><span class="st">1"</span>, age_range_description)), 
                           <span class="kw">if_else</span>(<span class="kw">grepl</span>(<span class="st">"70"</span>, age_range_description),
                                   <span class="dv">70</span>, 
                                   <span class="dv">15</span>)),
         <span class="dt">max_age =</span> min_age <span class="op">+</span><span class="st"> </span><span class="dv">5</span>, 
         <span class="dt">age_imp =</span> <span class="kw">runif</span>(<span class="kw">n</span>(), min_age, max_age)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>min_age, <span class="op">-</span>max_age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">last_fy =</span> fy.year <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(fy.year)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Tax year</span><span class="st">`</span> =<span class="st"> </span><span class="kw">factor</span>(fy.year)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">Tax year</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">if_else</span>(age_imp <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(age_imp), fy.year, <span class="ot">NA_character_</span>),
         <span class="dt">is_CG =</span> Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,
         <span class="dt">label.y =</span> <span class="kw">mean</span>(is_CG[age_imp <span class="op">&gt;</span><span class="st"> </span><span class="dv">71</span>]), 
         <span class="dt">Age =</span> age_imp) <span class="op">%&gt;%</span>
<span class="st">         </span>{
           
           <span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> Age, 
                         <span class="dt">y =</span> <span class="kw">as.numeric</span>(is_CG), 
                         <span class="dt">color =</span> <span class="st">`</span><span class="dt">Tax year</span><span class="st">`</span>, 
                         <span class="dt">group =</span> <span class="st">`</span><span class="dt">Tax year</span><span class="st">`</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">ggtitle</span>(<span class="st">"Incidence of capital gains"</span>) <span class="op">+</span>
<span class="st">             </span><span class="kw">scale_color_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">"smooth"</span>, <span class="dt">method =</span> <span class="st">"auto"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span>
<span class="st">             </span><span class="kw">geom_label_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label, <span class="dt">y =</span> label.y),
                              <span class="dt">fill =</span> <span class="ot">NA</span>,
                              <span class="dt">nudge_x =</span> <span class="dv">1</span>,
                              <span class="dt">hjust =</span> <span class="dv">0</span>, 
                              <span class="dt">vjust =</span> <span class="dv">0</span>, 
                              <span class="dt">fontface =</span> <span class="st">"bold"</span>, 
                              <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">annotate</span>(<span class="st">"blank"</span>, 
                      <span class="dt">x =</span> <span class="dv">80</span>, <span class="dt">y =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">             </span><span class="kw">theme_dark</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())
         }
<span class="co">#&gt; Warning in if_else(grepl("to", age_range_description),</span>
<span class="co">#&gt; as.numeric(gsub("^([0-9]{2}).*$", : NAs introduced by coercion</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: x, y</span>
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></code></pre></div>
<p><img src="grattan_files/figure-html/CG-incidence-by-age-by-fy-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">24841</span>)
sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(age_range, Net_CG_amt, fy.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">merge</span>(age_range_decoder, <span class="dt">by =</span> <span class="st">"age_range"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(age_range_description) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">min_age =</span> <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">"to"</span>, age_range_description), 
                          <span class="kw">as.numeric</span>(<span class="kw">gsub</span>(<span class="st">"^([0-9]{2}).*$"</span>, <span class="st">"</span><span class="ch">\\</span><span class="st">1"</span>, age_range_description)), 
                          <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">"70"</span>, age_range_description),
                                 <span class="dv">70</span>, 
                                 <span class="dv">15</span>)),
         <span class="dt">max_age =</span> min_age <span class="op">+</span><span class="st"> </span><span class="dv">5</span>, 
         <span class="dt">age_imp =</span> <span class="kw">runif</span>(<span class="kw">n</span>(), min_age, max_age)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>min_age, <span class="op">-</span>max_age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Age =</span> <span class="kw">round</span>(age_imp)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(fy.year, Age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_Net_CG =</span> <span class="kw">mean</span>(Net_CG_amt), 
            <span class="dt">sd_Net_CG =</span> <span class="kw">sd</span>(Net_CG_amt)) <span class="op">%&gt;%</span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">last_fy =</span> fy.year <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(fy.year) <span class="op">|</span><span class="st"> </span>fy.year <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(fy.year[fy.year <span class="op">!=</span><span class="st"> </span><span class="kw">max</span>(fy.year)])) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(fy.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">label =</span> <span class="kw">ifelse</span>(Age <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(Age), fy.year, <span class="ot">NA_character_</span>), 
         <span class="dt">label.y =</span> <span class="kw">mean</span>(mean_Net_CG[Age <span class="op">&gt;</span><span class="st"> </span><span class="dv">70</span>])) <span class="op">%&gt;%</span>
<span class="st">         </span>{
           <span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> mean_Net_CG, <span class="dt">color =</span> <span class="kw">factor</span>(fy.year), <span class="dt">group =</span> <span class="kw">factor</span>(fy.year))) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">scale_color_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">"smooth"</span>, <span class="dt">method =</span> <span class="st">"auto"</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span>
<span class="st">             </span><span class="kw">scale_alpha_discrete</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label, <span class="dt">y =</span> label.y, <span class="dt">size =</span> <span class="kw">if_else</span>(last_fy <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2012-13"</span>, <span class="st">"2013-14"</span>), <span class="dv">2</span>, <span class="dv">1</span>),
                                                                      <span class="dt">nudge_x =</span> <span class="kw">if_else</span>(last_fy, <span class="dv">1</span>, <span class="dv">0</span>)),
                       <span class="dt">hjust =</span> <span class="dv">0</span>, 
                       <span class="dt">vjust =</span> <span class="dv">0</span>, 
                       <span class="dt">fontface =</span> <span class="st">"bold"</span>, 
                       <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">theme_dark</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">annotate</span>(<span class="st">"blank"</span>, 
                      <span class="dt">x =</span> <span class="dv">85</span>, <span class="dt">y =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(), 
                   <span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">0</span>), <span class="st">"pt"</span>))
         }
<span class="co">#&gt; Warning: Using alpha for a discrete variable is not advised.</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: nudge_x</span>
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: x, y</span>
<span class="co">#&gt; `geom_smooth()` using method = 'loess' and formula 'NULL'</span></code></pre></div>
<p><img src="grattan_files/figure-html/CGT-by-age-weighted-ntile-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_noCG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_CG_amt, 
         <span class="dt">Taxable_Income_noCG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_noCG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_noCG_decile =</span> <span class="kw">ntile</span>(Taxable_Income_noCG, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Taxable_Income_noCG_decile <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">Age =</span> age_imp) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Taxable Income</span><span class="ch">\n</span><span class="dt">(excl CG) decile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">factor</span>(Taxable_Income_noCG_decile)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">Taxable Income</span><span class="ch">\n</span><span class="dt">(excl CG) decile</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.7</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)</code></pre></div>
<p><img src="grattan_files/figure-html/Age-distribution-ofCG-by-taxable-income-exclCG-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (FY.YEAR <span class="op">!=</span><span class="st"> "2013-14"</span>){
  <span class="kw">stop</span>(<span class="st">"Check annotations in this chart before compiling"</span>)
}
sample_file <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, age_imp <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">marginal_rate =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">fy.year =</span> FY.YEAR) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">Age =</span> age_imp) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> marginal_rate)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">weight =</span> <span class="dv">1</span>), <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>)[<span class="dv">1</span>], <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">weight =</span> Net_CG_amt), <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>)[<span class="dv">2</span>], <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">"text"</span>, 
           <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">57</span>, <span class="dv">57</span>), 
           <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">0.335</span>, <span class="fl">0.435</span>), 
           <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">"Unweighted"</span>, <span class="st">"Weighted by CG amt"</span>), 
           <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>), 
           <span class="dt">fontface =</span> <span class="st">"bold"</span>, 
           <span class="dt">hjust =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span>
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></code></pre></div>
<p><img src="grattan_files/figure-html/CGT-marginal-rate-weighted-and-unweighted-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (FY.YEAR <span class="op">!=</span><span class="st"> "2013-14"</span>){
  <span class="kw">stop</span>(<span class="st">"Check annotations in this chart before compiling"</span>)
}
sample_file <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Net_CG_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, age_imp <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_b4_CG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Taxable_Income <span class="op">-</span><span class="st"> </span>Net_CG_amt, <span class="dv">0</span>),
         <span class="dt">marginal_rate_b4_CG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_b4_CG <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">fy.year =</span> FY.YEAR) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_b4_CG, <span class="dt">fy.year =</span> FY.YEAR)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">Age =</span> age_imp) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> marginal_rate_b4_CG)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">weight =</span> <span class="dv">1</span>),  <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>)[<span class="dv">2</span>], <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="kw">aes</span>(<span class="dt">weight =</span> Net_CG_amt), <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>)[<span class="dv">1</span>], <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">"text"</span>, 
           <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">31</span>, <span class="dv">35</span>), 
           <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">0.315</span>, <span class="fl">0.225</span>), 
           <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">"Unweighted"</span>, <span class="st">"Weighted by CG amt"</span>), 
           <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>), 
           <span class="dt">fontface =</span> <span class="st">"bold"</span>, 
           <span class="dt">hjust =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span>
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></code></pre></div>
<p><img src="grattan_files/figure-html/CGT-marginal-rate-b4-CG-weighted-and-unweighted-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n_prop_invstrs &lt;-
<span class="st">  </span>sample_file <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>((Gross_rent_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>WEIGHT)

n_NGs &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>((Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>WEIGHT)

val_NG_losses &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(<span class="kw">abs</span>(<span class="kw"><a href="../reference/pminC.html">pminC</a></span>(Net_rent_amt, <span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>WEIGHT))

NG_tax_exp &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">new_tax =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income <span class="op">-</span><span class="st"> </span><span class="kw"><a href="../reference/pminC.html">pminC</a></span>(Net_rent_amt, <span class="dv">0</span>), <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">diff =</span> new_tax <span class="op">-</span><span class="st"> </span>tax) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(diff <span class="op">*</span><span class="st"> </span>WEIGHT)</code></pre></div>
<p>There were 2~million property investors. Of these, 1.25~million were negative gearing. Losses claimed totaled $10.7~billion. This delivered a tax expenditure (by revenue foregone) of $3.63~billion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">between</span>(Sw_amt, <span class="dv">0</span>, <span class="fl">250e3</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">Salary =</span> Sw_amt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Salary, <span class="dt">y =</span> <span class="kw">as.numeric</span>(Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>)[<span class="dv">2</span>], <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">label =</span> dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></code></pre></div>
<p><img src="grattan_files/figure-html/NG-vs-salary-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_by_taxBracket &lt;-
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tax_bracket =</span> <span class="kw">cut</span>(Taxable_Income, 
                             <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">18200</span>, <span class="fl">37e3</span>, <span class="fl">80e3</span>, <span class="fl">180e3</span>, <span class="ot">Inf</span>),
                             <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"$0-$18,200"</span>, <span class="st">"$18,201-$37,000"</span>, 
                                        <span class="st">"$37,001-$80,000"</span>, <span class="st">"$80,001-$180,000"</span>, 
                                        <span class="st">"Over $180,000"</span>),
                             <span class="dt">ordered_results =</span> <span class="ot">TRUE</span>,
                             <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Tax_bracket) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_NG =</span> <span class="kw">wsum</span>(Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, WEIGHT), 
            <span class="dt">n =</span> <span class="kw">sum</span>(WEIGHT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Tax_bracket)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_by_taxBracket <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Number negative gearing</span><span class="st">`</span> =<span class="st"> </span><span class="kw">comma</span>(n_NG), 
         <span class="st">`</span><span class="ch">\\</span><span class="dt">%</span><span class="st">`</span> =<span class="st"> </span><span class="kw">percent</span>(n_NG <span class="op">/</span><span class="st"> </span>n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">Tax bracket</span><span class="st">`</span> =<span class="st"> </span>Tax_bracket, 
         <span class="st">`</span><span class="dt">Number negative gearing</span><span class="st">`</span>, 
         <span class="st">`</span><span class="ch">\\</span><span class="dt">%</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">"rrr"</span>) </code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Tax bracket</th>
<th align="right">Number negative gearing</th>
<th align="right">%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">$0-$18,200</td>
<td align="right">161,800</td>
<td align="right">6.4%</td>
</tr>
<tr class="even">
<td align="right">$18,201-$37,000</td>
<td align="right">180,950</td>
<td align="right">5.8%</td>
</tr>
<tr class="odd">
<td align="right">$37,001-$80,000</td>
<td align="right">469,500</td>
<td align="right">9.8%</td>
</tr>
<tr class="even">
<td align="right">$80,001-$180,000</td>
<td align="right">350,800</td>
<td align="right">16.4%</td>
</tr>
<tr class="odd">
<td align="right">Over $180,000</td>
<td align="right">85,200</td>
<td align="right">22.4%</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_by_taxBracket_tax_benefit &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_NoNG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_rent_amt <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Net_rent_amt, <span class="dv">0</span>),
         <span class="dt">Taxable_Income_noNG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_NoNG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>),
         <span class="dt">tax_current =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">tax_noNG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_noNG, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">change =</span> tax_noNG <span class="op">-</span><span class="st"> </span>tax_current) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tax_bracket =</span> <span class="kw">cut</span>(Taxable_Income, 
                             <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">18200</span>, <span class="fl">37e3</span>, <span class="fl">80e3</span>, <span class="fl">180e3</span>, <span class="ot">Inf</span>),
                             <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"$0-$18,200"</span>, 
                                        <span class="st">"$18,201-$37,000"</span>, 
                                        <span class="st">"$37,001-$80,000"</span>, 
                                        <span class="st">"$80,001-$180,000"</span>, 
                                        <span class="st">"Over $180,000"</span>),
                             <span class="dt">ordered_results =</span> <span class="ot">TRUE</span>,
                             <span class="dt">include.lowest =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Tax_bracket) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_tax_change =</span> <span class="kw">sum</span>(change <span class="op">*</span><span class="st"> </span>WEIGHT),
            <span class="dt">avg_tax_change =</span> <span class="kw">mean</span>(change)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Tax_bracket)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_by_taxBracket_tax_benefit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Total tax change</span><span class="st">`</span> =<span class="st"> </span><span class="kw">grattan_dollar</span>(total_tax_change), 
         <span class="st">`</span><span class="dt">Average tax change</span><span class="st">`</span> =<span class="st"> </span><span class="kw">grattan_dollar</span>(avg_tax_change)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">Tax bracket</span><span class="st">`</span> =<span class="st"> </span>Tax_bracket, 
         <span class="st">`</span><span class="dt">Total tax change</span><span class="st">`</span>, 
         <span class="st">`</span><span class="dt">Average tax change</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="kw">paste0</span>(<span class="kw">rep</span>(<span class="st">"r"</span>, <span class="kw">ncol</span>(.)), <span class="dt">collapse =</span> <span class="st">""</span>))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Tax bracket</th>
<th align="right">Total tax change</th>
<th align="right">Average tax change</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">$0-$18,200</td>
<td align="right">$97,261,913</td>
<td align="right">$39</td>
</tr>
<tr class="even">
<td align="right">$18,201-$37,000</td>
<td align="right">$333,873,994</td>
<td align="right">$108</td>
</tr>
<tr class="odd">
<td align="right">$37,001-$80,000</td>
<td align="right">$1,246,976,877</td>
<td align="right">$259</td>
</tr>
<tr class="even">
<td align="right">$80,001-$180,000</td>
<td align="right">$1,288,682,051</td>
<td align="right">$603</td>
</tr>
<tr class="odd">
<td align="right">Over $180,000</td>
<td align="right">$648,280,796</td>
<td align="right">$1,706</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_by_taxable_income_decile &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_NG =</span> <span class="kw">wsum</span>(Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, WEIGHT), 
            <span class="dt">n =</span> <span class="kw">sum</span>(WEIGHT)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Taxable_Income_decile) </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_by_taxable_income_decile <span class="op">%&gt;%</span>
<span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Number negative gearing</span><span class="st">`</span> =<span class="st"> </span><span class="kw">comma</span>(n_NG), 
         <span class="st">`</span><span class="ch">\\</span><span class="dt">%</span><span class="st">`</span> =<span class="st"> </span><span class="kw">percent</span>(n_NG <span class="op">/</span><span class="st"> </span>n)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Taxable Income decile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">factor</span>(Taxable_Income_decile)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">Taxable Income decile</span><span class="st">`</span>, 
         <span class="st">`</span><span class="dt">Number negative gearing</span><span class="st">`</span>, 
         <span class="st">`</span><span class="ch">\\</span><span class="dt">%</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">"rrrr"</span>) </code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Taxable Income decile</th>
<th align="right">Number negative gearing</th>
<th align="right">%</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">109,550</td>
<td align="right">8.5%</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">55,750</td>
<td align="right">4.3%</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">64,950</td>
<td align="right">5.0%</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">82,400</td>
<td align="right">6.4%</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">93,700</td>
<td align="right">7.2%</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">106,600</td>
<td align="right">8.2%</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">130,750</td>
<td align="right">10.1%</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">157,950</td>
<td align="right">12.2%</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">192,600</td>
<td align="right">14.9%</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">254,000</td>
<td align="right">19.6%</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_tax_benefit_taxable_income_decile &lt;-
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_NoNG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_rent_amt <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Net_rent_amt, <span class="dv">0</span>),
         <span class="dt">Taxable_Income_noNG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_NoNG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>),
         <span class="dt">tax_current =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">tax_noNG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_noNG, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">change =</span> tax_noNG <span class="op">-</span><span class="st"> </span>tax_current) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">tax_diff =</span> <span class="kw">sum</span>(change <span class="op">*</span><span class="st"> </span>WEIGHT)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax_diff_prop =</span> tax_diff <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tax_diff)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">decile_by =</span> <span class="st">"Taxable income"</span>)

NG_tax_benefit_taxable_income_decile_noNG &lt;-
<span class="st">  </span>sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_NoNG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_rent_amt <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Net_rent_amt, <span class="dv">0</span>),
         <span class="dt">Taxable_Income_noNG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_NoNG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>),
         <span class="dt">tax_current =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">tax_noNG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_noNG, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">change =</span> tax_noNG <span class="op">-</span><span class="st"> </span>tax_current) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income_noNG, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">tax_diff =</span> <span class="kw">sum</span>(change <span class="op">*</span><span class="st"> </span>WEIGHT)) <span class="op">%&gt;%</span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax_diff_prop =</span> tax_diff <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tax_diff)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">decile_by =</span> <span class="st">"Taxable income before NG"</span>)

<span class="kw">bind_rows</span>(<span class="st">"Current"</span> =<span class="st"> </span>NG_tax_benefit_taxable_income_decile, 
          <span class="st">"Before NG"</span> =<span class="st"> </span>NG_tax_benefit_taxable_income_decile_noNG) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Taxable income decile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">factor</span>(Taxable_Income_decile)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Taxable income decile</span><span class="st">`</span>, <span class="dt">y =</span> tax_diff_prop, <span class="dt">fill =</span> decile_by)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>decile_by) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent, 
                     <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),
                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">round</span>(<span class="kw">max</span>(<span class="kw">c</span>(NG_tax_benefit_taxable_income_decile_noNG<span class="op">$</span>tax_diff_prop, 
                                               NG_tax_benefit_taxable_income_decile<span class="op">$</span>tax_diff_prop)), <span class="dv">1</span>)))</code></pre></div>
<p><img src="grattan_files/figure-html/NG-tax-benefit-by-income-tax-decile-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">NG_tax_benefit_taxable_income_decile_prev &lt;-
<span class="st">  </span>sample_file_prev <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_NoNG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_rent_amt <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Net_rent_amt, <span class="dv">0</span>),
         <span class="dt">Taxable_Income_noNG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_NoNG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>),
         <span class="dt">tax_current =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">tax_noNG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_noNG, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">change =</span> tax_noNG <span class="op">-</span><span class="st"> </span>tax_current) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">tax_diff =</span> <span class="kw">sum</span>(change <span class="op">*</span><span class="st"> </span>WEIGHT)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax_diff_prop =</span> tax_diff <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tax_diff)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">decile_by =</span> <span class="st">"Taxable income"</span>)

NG_tax_benefit_taxable_income_decile_noNG_prev &lt;-
<span class="st">  </span>sample_file_prev <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_NoNG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_rent_amt <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Net_rent_amt, <span class="dv">0</span>),
         <span class="dt">Taxable_Income_noNG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_NoNG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>),
         <span class="dt">tax_current =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">tax_noNG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_noNG, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">change =</span> tax_noNG <span class="op">-</span><span class="st"> </span>tax_current) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Taxable_Income_decile) <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">tax_diff =</span> <span class="kw">sum</span>(change <span class="op">*</span><span class="st"> </span>WEIGHT)) <span class="op">%&gt;%</span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tax_diff_prop =</span> tax_diff <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tax_diff)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">decile_by =</span> <span class="st">"Taxable income before NG"</span>)

<span class="kw">bind_rows</span>(<span class="st">"Current"</span> =<span class="st"> </span>NG_tax_benefit_taxable_income_decile, 
          <span class="st">"Before NG"</span> =<span class="st"> </span>NG_tax_benefit_taxable_income_decile_noNG, 
          <span class="st">"Current (prev fy)"</span> =<span class="st"> </span>NG_tax_benefit_taxable_income_decile_prev, 
          <span class="st">"Before NG (prev fy)"</span> =<span class="st"> </span>NG_tax_benefit_taxable_income_decile_noNG_prev, 
          <span class="dt">.id =</span> <span class="st">"df_id"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Taxable income decile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">factor</span>(Taxable_Income_decile)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">financial_year =</span> <span class="kw">ifelse</span>(<span class="kw">grepl</span>(<span class="st">"prev fy"</span>, df_id), PREV.FY.YEAR, FY.YEAR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Taxable income decile</span><span class="st">`</span>, <span class="dt">y =</span> tax_diff_prop, <span class="dt">fill =</span> financial_year)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">begin =</span> <span class="dv">0</span>, <span class="dt">end =</span> <span class="fl">0.3333</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>decile_by) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent, 
                     <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),
                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">round</span>(<span class="kw">max</span>(<span class="kw">c</span>(NG_tax_benefit_taxable_income_decile_noNG<span class="op">$</span>tax_diff_prop, 
                                               NG_tax_benefit_taxable_income_decile<span class="op">$</span>tax_diff_prop)), <span class="dv">1</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.margin =</span> <span class="kw">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>), 
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.00</span>, <span class="fl">1.025</span>), 
        <span class="dt">legend.background =</span> <span class="kw">element_blank</span>(),
               
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), 
        <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),
        <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="kw">grey</span>(<span class="fl">0.8</span>), <span class="dt">fill =</span> <span class="kw">grey</span>(<span class="fl">0.8</span>)),
        <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">colour =</span> <span class="st">"white"</span>, <span class="dt">face =</span> <span class="st">"bold"</span>))
<span class="co">#&gt; Warning: `legend.margin` must be specified using `margin()`. For the old</span>
<span class="co">#&gt; behavior use legend.spacing</span></code></pre></div>
<p><img src="grattan_files/figure-html/NG-tax-benefit-comparison-prev-fy-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="ot">NULL</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> sample_file, 
              <span class="kw">aes</span>(<span class="dt">x =</span> age_imp, <span class="dt">y =</span> <span class="kw">as.numeric</span>(Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)), 
              <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>)[<span class="dv">1</span>], 
              <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> <span class="kw">filter</span>(sample_file, Gross_rent_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>), 
              <span class="kw">aes</span>(<span class="dt">x =</span> age_imp, 
                  <span class="dt">y =</span> <span class="kw">as.numeric</span>(Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)), 
              <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>)[<span class="dv">2</span>], 
              <span class="dt">size =</span> <span class="fl">1.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Age"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>()) 

<span class="cf">if</span> (FY.YEAR <span class="op">==</span><span class="st"> "2013-14"</span>){
  p &lt;-<span class="st"> </span>
<span class="st">    </span>p <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">annotate</span>(<span class="st">"text"</span>, 
             <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">38</span>, <span class="dv">38</span>), 
             <span class="dt">y =</span> <span class="kw">c</span>(<span class="fl">0.18</span>, <span class="dt">y =</span> <span class="fl">0.80</span>), 
             <span class="dt">label =</span> <span class="kw">c</span>(<span class="st">"All taxpayers"</span>, <span class="st">"Property investors"</span>), 
             <span class="dt">hjust =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">0</span>), 
             <span class="dt">colour =</span> <span class="kw">viridis</span>(<span class="dv">2</span>),
             <span class="dt">fontface =</span> <span class="st">"bold"</span>)
} <span class="cf">else</span> {
  p &lt;-<span class="st"> </span>p <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)
}

p
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span>
<span class="co">#&gt; `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</span></code></pre></div>
<p><img src="grattan_files/figure-html/NG-incidence-by-age-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age_res =<span class="st"> </span><span class="dv">1</span>
inc_res =<span class="st"> </span><span class="dv">10000</span>

sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_NoNG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_rent_amt <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Net_rent_amt, <span class="dv">0</span>),
         <span class="dt">Taxable_Income_noNG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_NoNG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>),
         <span class="dt">tax_current =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">tax_noNG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_noNG, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">change =</span> tax_noNG <span class="op">-</span><span class="st"> </span>tax_current) <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># This excludes income losses (barely any anyway)</span>
<span class="st">  </span><span class="co"># and high income earners</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">between</span>(Tot_inc_amt_NoNG, 
                 <span class="dv">0</span>, 
                 upper_ylim &lt;&lt;-<span class="st"> </span><span class="kw">quantile</span>(.<span class="op">$</span>Tot_inc_amt_NoNG[.<span class="op">$</span>Tot_inc_amt_NoNG <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>], <span class="dt">probs =</span> <span class="fl">0.95</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Age =</span> age_res <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(age_imp <span class="op">/</span><span class="st"> </span>age_res), 
         <span class="st">`</span><span class="dt">Total Income (before NG)</span><span class="st">`</span> =<span class="st"> </span>inc_res <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(Tot_inc_amt_NoNG <span class="op">/</span><span class="st"> </span>inc_res)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Age, <span class="st">`</span><span class="dt">Total Income (before NG)</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_NG =</span> <span class="kw">sum</span>((Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>WEIGHT), 
            <span class="dt">prop_NG =</span> <span class="kw">mean</span>(Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>),
            <span class="dt">tot_tax_benefit =</span> <span class="kw">sum</span>(change <span class="op">*</span><span class="st"> </span>WEIGHT), 
            <span class="dt">avg_tax_benefit =</span> <span class="kw">mean</span>(change)) <span class="op">%&gt;%</span><span class="st"> </span>ungroup <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Total Income (before NG)</span><span class="st">`</span>, <span class="dt">fill =</span> prop_NG)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="st">"% NG"</span>, <span class="dt">labels =</span> percent) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">label =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_dark</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), 
        <span class="dt">plot.margin =</span> <span class="kw">unit</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">"pt"</span>))<span class="co"># %&gt;%</span></code></pre></div>
<p><img src="grattan_files/figure-html/NG-by-age-by-total-income-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#align_baptiste(.)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">age_res =<span class="st"> </span><span class="dv">1</span>
inc_res =<span class="st"> </span><span class="dv">10000</span>

sample_file <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Tot_inc_amt_NoNG =</span> Tot_inc_amt <span class="op">-</span><span class="st"> </span>Net_rent_amt <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Net_rent_amt, <span class="dv">0</span>),
         <span class="dt">Taxable_Income_noNG =</span> <span class="kw"><a href="../reference/pmaxC.html">pmaxC</a></span>(Tot_inc_amt_NoNG <span class="op">-</span><span class="st"> </span>Tot_ded_amt <span class="op">-</span><span class="st"> </span>NPP_loss_claimed <span class="op">-</span><span class="st"> </span>PP_loss_claimed, <span class="dv">0</span>),
         <span class="dt">tax_current =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">tax_noNG =</span> <span class="kw"><a href="../reference/income_tax.html">income_tax</a></span>(Taxable_Income_noNG, <span class="dt">fy.year =</span> FY.YEAR),
         <span class="dt">change =</span> tax_noNG <span class="op">-</span><span class="st"> </span>tax_current) <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># This excludes income losses (barely any anyway)</span>
<span class="st">  </span><span class="co"># and high income earners</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">between</span>(Tot_inc_amt_NoNG, 
                 <span class="dv">0</span>, 
                 upper_ylim &lt;&lt;-<span class="st"> </span><span class="kw">quantile</span>(.<span class="op">$</span>Tot_inc_amt_NoNG[.<span class="op">$</span>Tot_inc_amt_NoNG <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>], <span class="dt">probs =</span> <span class="fl">0.95</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Age =</span> age_res <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(age_imp <span class="op">/</span><span class="st"> </span>age_res), 
         <span class="st">`</span><span class="dt">Total Income (before NG)</span><span class="st">`</span> =<span class="st"> </span>inc_res <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(Tot_inc_amt_NoNG <span class="op">/</span><span class="st"> </span>inc_res)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Age, <span class="st">`</span><span class="dt">Total Income (before NG)</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_NG =</span> <span class="kw">sum</span>((Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">*</span><span class="st"> </span>WEIGHT), 
            <span class="dt">prop_NG =</span> <span class="kw">mean</span>(Net_rent_amt <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>),
            <span class="dt">tot_tax_benefit =</span> <span class="kw">sum</span>(change <span class="op">*</span><span class="st"> </span>WEIGHT), 
            <span class="dt">avg_tax_benefit =</span> <span class="kw">mean</span>(change)) <span class="op">%&gt;%</span><span class="st"> </span>ungroup <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">  </span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Age, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Total Income (before NG)</span><span class="st">`</span>, <span class="dt">fill =</span> avg_tax_benefit)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_fill_viridis</span>(<span class="st">"Tax benefit"</span>, <span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">label =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_dark</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="grattan_files/figure-html/NG-tax-benefit-by-age-by-total-income-1.png" width="864"></p>
</div>
</div>
<div id="differential-uprating" class="section level1">
<h1 class="hasAnchor">
<a href="#differential-uprating" class="anchor"></a>Differential uprating</h1>
<p>Since the most recent versions of data detailing population income and wealth (as is contained within the ATO’s sample files) is typically years out-of-date on release, even understanding the present requires a forecast. Since most variables relating to income increase due to inflation – so any sensible forecast will increase the values relative to the past – this procedure is often called <strong>uprating</strong>.</p>
<div id="basic-uprating" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-uprating" class="anchor"></a>Basic uprating</h2>
<p>The most basic uprate method is the identity function, where the variables are not changed.</p>
<p>Alternatively, the variables can be increased by a long-term inflation rate. Even better, we can use the relevant time series indices for the variables and inflate using that index. For instance, salary and wage variables can be increased by the observed increase in the wage price index amd growth in the population of taxpayers by the labour force index.</p>
</div>
<div id="differential-uprating-1" class="section level2">
<h2 class="hasAnchor">
<a href="#differential-uprating-1" class="anchor"></a>Differential uprating</h2>
<p>Basic uprating suffers some limitations. There are significant structural differences in how much individuals’ incomes grow. High-income individuals tend to have higher than average wage growth. Low-income individuals also have higher than average wage growth. That is, the pattern of wage growth by wage is U-shaped.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_r_by_fy &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy.year =</span> <span class="kw"><a href="../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2005</span><span class="op">:</span><span class="dv">2014</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag_fy =</span> <span class="kw"><a href="../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2004</span><span class="op">:</span><span class="dv">2013</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wage_growth_r =</span> <span class="kw"><a href="../reference/wage_inflator.html">wage_inflator</a></span>(<span class="dt">from_fy =</span> lag_fy, <span class="dt">to_fy =</span> fy.year) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">average_salary_by_fy_swtile &lt;-<span class="st"> </span>
<span class="st">  </span>sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(fy.year, Sw_amt) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(Sw_amt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(fy.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">ntile</span>(Sw_amt, <span class="dv">100</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(fy.year, <span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_salary =</span> <span class="kw">mean</span>(Sw_amt)) <span class="op">%&gt;%</span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span>, fy.year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r_average_salary =</span> average_salary <span class="op">/</span><span class="st"> </span><span class="kw">lag</span>(average_salary) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(fy.year <span class="op">!=</span><span class="st"> </span><span class="kw">min</span>(fy.year))

{
  p &lt;-<span class="st"> </span>
<span class="st">    </span>average_salary_by_fy_swtile <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># NA</span>
<span class="st">    </span>ungroup <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">merge</span>(wage_r_by_fy, <span class="dt">by =</span> <span class="st">"fy.year"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Basic wage inflator</span><span class="st">`</span> =<span class="st"> "Basic wage inflator"</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span>, <span class="dt">y =</span> r_average_salary, <span class="dt">group =</span> fy.year, <span class="dt">fill =</span> fy.year), 
              <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">stat =</span> <span class="st">"smooth"</span>, <span class="dt">method =</span> <span class="st">"loess"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>, <span class="dt">plot.background =</span> <span class="kw">element_blank</span>()) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span>, <span class="dt">y =</span> wage_growth_r, <span class="dt">group =</span> <span class="st">`</span><span class="dt">Basic wage inflator</span><span class="st">`</span>, <span class="dt">color =</span> <span class="st">`</span><span class="dt">Basic wage inflator</span><span class="st">`</span>),
              <span class="dt">size =</span> <span class="fl">1.125</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="st">"black"</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">name =</span> <span class="st">"Salary rate of increase"</span>, <span class="dt">label =</span> percent) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>fy.year, <span class="dt">ncol =</span> <span class="dv">5</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), 
          <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(), 
          <span class="dt">legend.key =</span> <span class="kw">element_blank</span>(),
          <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))
  
  <span class="co"># ggplotly(p)</span>
  p
}</code></pre></div>
<p><img src="grattan_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">differential_uprates &lt;-<span class="st"> </span>
<span class="st">  </span>average_salary_by_fy_swtile <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_r =</span> <span class="kw">mean</span>(r_average_salary)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">avg_r_normed =</span> avg_r <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(avg_r))

differential_uprates <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Salary percentile</span><span class="st">`</span>, <span class="dt">y =</span> avg_r)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> percent)</code></pre></div>
<p><img src="grattan_files/figure-html/unnamed-chunk-4-1.png" width="864"></p>
<p><strong>Differential uprating</strong> is a method by which variables are uprated by a function of not only the time period and the type of variable, but of the variable’s value too. To differentially uprate salary, use <code>differentially_uprate_wage</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data_frame</span>(<span class="dt">wage =</span> <span class="kw">c</span>(<span class="fl">20e3</span>, <span class="fl">50e3</span>, <span class="fl">100e3</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ordinary =</span> <span class="kw"><a href="../reference/wage_inflator.html">wage_inflator</a></span>(wage, <span class="dt">from_fy =</span> <span class="st">"2012-13"</span>, <span class="dt">to_fy =</span> <span class="st">"2013-14"</span>), 
         <span class="st">`</span><span class="dt">change ordinary</span><span class="st">`</span> =<span class="st"> </span>ordinary <span class="op">/</span><span class="st"> </span>wage <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, 
         <span class="dt">differential =</span> <span class="kw"><a href="../reference/differentially_uprate_wage.html">differentially_uprate_wage</a></span>(wage, <span class="dt">from_fy =</span> <span class="st">"2012-13"</span>, <span class="dt">to_fy =</span> <span class="st">"2013-14"</span>), 
         <span class="st">`</span><span class="dt">change differential</span><span class="st">`</span> =<span class="st"> </span>differential <span class="op">/</span><span class="st"> </span>wage <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
         ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wage =</span> <span class="kw">dollar</span>(wage),
         <span class="dt">ordinary =</span> <span class="kw">dollar</span>(ordinary), 
         <span class="dt">differential =</span> <span class="kw">dollar</span>(differential), 
         <span class="st">`</span><span class="dt">change ordinary</span><span class="st">`</span> =<span class="st"> </span><span class="kw">percent</span>(<span class="st">`</span><span class="dt">change ordinary</span><span class="st">`</span>), 
         <span class="st">`</span><span class="dt">change differential</span><span class="st">`</span> =<span class="st"> </span><span class="kw">percent</span>(<span class="st">`</span><span class="dt">change differential</span><span class="st">`</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="kw">rep</span>(<span class="st">"r"</span>, <span class="kw">ncol</span>(.)))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">wage</th>
<th align="right">ordinary</th>
<th align="right">change ordinary</th>
<th align="right">differential</th>
<th align="right">change differential</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">$20,000</td>
<td align="right">$20,519</td>
<td align="right">2.59%</td>
<td align="right">$20,572</td>
<td align="right">2.858%</td>
</tr>
<tr class="even">
<td align="right">$50,000</td>
<td align="right">$51,296</td>
<td align="right">2.59%</td>
<td align="right">$51,116</td>
<td align="right">2.233%</td>
</tr>
<tr class="odd">
<td align="right">$100,000</td>
<td align="right">$102,593</td>
<td align="right">2.59%</td>
<td align="right">$102,655</td>
<td align="right">2.655%</td>
</tr>
</tbody>
</table>
<p>Note that <code>differentially_update_wage</code> uses the 2003-04 to 2013-14 sample files to generate estimates of the shape of the U. So applying the function to any other vector may have surprising results. In particular, the distribution of the vector provided is not considered. Furthermore, the <code>from_fy</code> must be in the range <code>2003-04</code> to <code>2013-14</code>.</p>
</div>
</div>
<div id="modelling-superannuation-changes" class="section level1">
<h1 class="hasAnchor">
<a href="#modelling-superannuation-changes" class="anchor"></a>Modelling superannuation changes</h1>
<div id="introduction-1" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-1" class="anchor"></a>Introduction</h2>
<p>Australia’s superannuation system offers a number of tax breaks. Relative to most methods of savings, less tax is paid on money contributed to a super fund, and less tax is paid on the earnings. The functions described here attempt to model changes to tax breaks on money contributed to a super fund.</p>
</div>
<div id="modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#modelling" class="anchor"></a>Modelling</h2>
<div id="the-basic-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#the-basic-functions" class="anchor"></a>The basic functions</h3>
<p>The two tax methods modelled are <strong>Superannuation contributions tax concessions</strong> and <strong>Division 293 tax</strong>. The two main outputs are: the extra tax payable by a particular individual (and the symmetric extra revenue), and the number of individuals affected.</p>
<p>To obtain these results (say for 2017-18)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(grattan)
<span class="kw">library</span>(data.table)
<span class="cf">if</span> (<span class="kw">requireNamespace</span>(<span class="st">"taxstats"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)){
  <span class="kw">library</span>(taxstats)
  sample_files_all &lt;-<span class="st"> </span><span class="kw">get_sample_files_all</span>()
} <span class="cf">else</span> {
  templib &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
  hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/provide.dir">provide.dir</a></span>(templib)
  <span class="kw">install.packages</span>(<span class="st">"taxstats"</span>,
                   <span class="dt">lib =</span> templib,
                   <span class="dt">repos =</span> <span class="st">"https://hughparsonage.github.io/drat/"</span>,
                   <span class="dt">type =</span> <span class="st">"source"</span>)
  <span class="kw">library</span>(<span class="st">"taxstats"</span>, <span class="dt">lib.loc =</span> templib)
  sample_files_all &lt;-<span class="st"> </span><span class="kw">get_sample_files_all</span>()
}
<span class="kw">library</span>(magrittr)
<span class="co">#' dollar scales</span>
<span class="co">#' </span>
<span class="co">#' @name grattan_dollar</span>
<span class="co">#' @param x A numeric vector</span>
<span class="co">#' @param digits Minimum number of digits after the decimal point. (\code{nsmall} in \code{base::format}).</span>
<span class="co">#' @details Makes negative numbers appear as \eqn{-\$10,000} instead of \eqn{\$-10,000} in \code{scales::dollar}.</span>
<span class="co">#' @export</span>
<span class="co"># from scales</span>

grattan_dollar &lt;-<span class="st"> </span><span class="cf">function</span> (x, <span class="dt">digits =</span> <span class="dv">0</span>) {
  <span class="co">#</span>
  nsmall &lt;-<span class="st"> </span>digits
  commaz &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">abs</span>(x), <span class="dt">nsmall =</span> nsmall, <span class="dt">trim =</span> <span class="ot">TRUE</span>, <span class="dt">big.mark =</span> <span class="st">","</span>, 
                   <span class="dt">scientific =</span> <span class="ot">FALSE</span>, <span class="dt">digits =</span> 1L)
  
  hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/if_else">if_else</a></span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, 
          <span class="kw">paste0</span>(<span class="st">"\U2212"</span>,<span class="st">"$"</span>, commaz),
          <span class="kw">paste0</span>(<span class="st">"$"</span>, commaz))
}

(new_revenue &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">1314</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/project_to.html">project_to</a></span>(<span class="dt">to_fy =</span> <span class="st">"2017-18"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/model_new_caps_and_div293.html">revenue_from_new_cap_and_div293</a></span>(<span class="dt">new_cap =</span> <span class="fl">25e3</span>, <span class="dt">fy.year =</span> <span class="st">"2016-17"</span>, <span class="dt">new_age_based_cap =</span> <span class="ot">FALSE</span>, <span class="dt">new_div293_threshold =</span> <span class="fl">250e3</span>))
<span class="co">#&gt; [1] 1199407221</span>

<span class="kw">paste</span>(<span class="kw">grattan_dollar</span>(new_revenue <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>), <span class="st">"bn"</span>)
<span class="co">#&gt; [1] "$1 bn"</span>

(n_affected &lt;-
<span class="st">  </span>sample_file_<span class="dv">1314</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/project_to.html">project_to</a></span>(<span class="dt">to_fy =</span> <span class="st">"2017-18"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/model_new_caps_and_div293.html">n_affected_from_new_cap_and_div293</a></span>(<span class="dt">new_cap =</span> <span class="fl">25e3</span>, <span class="dt">fy.year =</span> <span class="st">"2016-17"</span>, <span class="dt">new_age_based_cap =</span> <span class="ot">FALSE</span>, <span class="dt">new_div293_threshold =</span> <span class="fl">250e3</span>))
<span class="co">#&gt; [1] 558767.4</span>

<span class="kw">prettyNum</span>(<span class="kw">round</span>(n_affected), <span class="dt">big.mark =</span> <span class="st">","</span>)
<span class="co">#&gt; [1] "558,767"</span></code></pre></div>
<p>Notes:</p>
<ol style="list-style-type: decimal">
<li>
<code>fy.year</code> refers to the year the function takes the tax scales from, not the forecast year. Because we don’t have tax scales for 2017-18 yet, we model using the most recent (<code>2017-18</code>).</li>
<li>The functions require their inputs to be <code>data.table</code>s. Sorry if you don’t like <code>data.table</code>s.</li>
<li>You must use <code>sample_file_1314</code> (because they have superannuation contributions variables).</li>
</ol>
</div>
<div id="distributional-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#distributional-analysis" class="anchor"></a>Distributional analysis</h3>
<div id="by-taxable-income-decile" class="section level4">
<h4 class="hasAnchor">
<a href="#by-taxable-income-decile" class="anchor"></a>By taxable income decile</h4>
<p>Let’s create an object for <code>sample_file_1718</code> avoid recreating it every time:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">1718</span> &lt;-
<span class="st">  </span>sample_file_<span class="dv">1314</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/project_to.html">project_to</a></span>(<span class="dt">to_fy =</span> <span class="st">"2017-18"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.table</code></pre></div>
<p>The functions mentioned earlier return single values. In contrast, <code>model_new_caps_and_div293</code> returns the sample file with extra variables, which can then be analyzed as a standard sample file. The variables of note are <code>prv_revenue</code> which is the tax payable under the old system, and <code>new_revenue</code> which is the tax payable under the proposed system. Thus:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_sample_file_<span class="dv">1718</span> &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">1718</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/model_new_caps_and_div293.html">model_new_caps_and_div293</a></span>(<span class="dt">new_cap =</span> <span class="fl">25e3</span>, <span class="dt">fy.year =</span> <span class="st">"2016-17"</span>, <span class="dt">new_age_based_cap =</span> <span class="ot">FALSE</span>, <span class="dt">new_div293_threshold =</span> <span class="fl">250e3</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(dtplyr)  <span class="co"># for data.table</span>

new_sample_file_<span class="dv">1718</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="st">`</span><span class="dt">Average increase in tax</span><span class="st">`</span> =<span class="st"> </span><span class="kw">round</span>(<span class="kw">mean</span>(new_revenue <span class="op">-</span><span class="st"> </span>prv_revenue), <span class="dv">2</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span>kable</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Taxable_Income_decile</th>
<th align="right">Average increase in tax</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1.67</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">4.90</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">11.32</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">22.70</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">31.14</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">33.84</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">41.58</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">61.37</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">101.53</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">506.51</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
new_sample_file_<span class="dv">1718</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="st">`</span><span class="dt">Average increase in tax</span><span class="st">`</span> =<span class="st"> </span><span class="kw">mean</span>(new_revenue <span class="op">-</span><span class="st"> </span>prv_revenue)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(Taxable_Income_decile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co">#</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Taxable income decile</span><span class="st">`</span> =<span class="st"> </span><span class="kw">factor</span>(Taxable_Income_decile)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Taxable income decile</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Average increase in tax</span><span class="st">`</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># cosmetic:</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">"bold"</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">margin =</span> <span class="kw">margin</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="st">"lines"</span>)))</code></pre></div>
<p><img src="grattan_files/figure-html/unnamed-chunk-10-1.png" width="864"></p>
</div>
</div>
</div>
</div>
<div id="performance-of-project" class="section level1">
<h1 class="hasAnchor">
<a href="#performance-of-project" class="anchor"></a>Performance of project</h1>
<p>To test the performance of our projection, we consider the projection of the 2012-13 sample file by one year with the actual 2013-14 sample file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_1314_projected &lt;-<span class="st"> </span>
<span class="st">  </span>sample_file_<span class="dv">1213</span> <span class="op">%&gt;%</span>
<span class="st">  </span>copy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">WEIGHT =</span> <span class="dv">50</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/project.html">project</a></span>(<span class="dt">h =</span> 1L,
          <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2012-13"</span>,
          <span class="dt">.recalculate.inflators =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data.table</span>(<span class="dt">the_source =</span> <span class="kw">c</span>(<span class="st">"Actual"</span>,
                          <span class="st">"Projected"</span>),
           <span class="dt">n_persons =</span> <span class="kw">c</span>(<span class="kw">nrow</span>(sample_file_<span class="dv">1314</span>) <span class="op">*</span><span class="st"> </span><span class="dv">50</span>,
                         <span class="kw">sum</span>(sample_file_1314_projected<span class="op">$</span>WEIGHT)), 
           <span class="dt">avg_Taxable_Income =</span> <span class="kw">c</span>(<span class="kw">mean</span>(sample_file_<span class="dv">1314</span><span class="op">$</span>Taxable_Income),
                                  <span class="kw">mean</span>(sample_file_1314_projected<span class="op">$</span>Taxable_Income)),
           <span class="dt">avg_Sw =</span> <span class="kw">c</span>(<span class="kw">mean</span>(sample_file_<span class="dv">1314</span><span class="op">$</span>Sw_amt),
                      <span class="kw">mean</span>(sample_file_1314_projected<span class="op">$</span>Sw_amt))
) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">melt.data.table</span>(<span class="dt">id.vars =</span> <span class="st">"the_source"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(variable) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value_rel =</span> value <span class="op">/</span><span class="st"> </span><span class="kw">first</span>(value)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># dcast.data.table(variable ~ the_source) %&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> variable, <span class="dt">y =</span> value_rel, <span class="dt">fill =</span> the_source)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">comma</span>(<span class="kw">round</span>(value))),
            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.9</span>),
            <span class="dt">hjust =</span> <span class="fl">1.02</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"top"</span>)</code></pre></div>
<p><img src="grattan_files/figure-html/unnamed-chunk-12-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conf_int_of_t.test &lt;-<span class="st"> </span><span class="cf">function</span>(variable){
  t_test &lt;-<span class="st"> </span><span class="kw">t.test</span>(sample_file_<span class="dv">1314</span>[[variable]],
                   sample_file_1314_projected[[variable]])
  
  <span class="kw">data.table</span>(<span class="dt">var =</span> variable,
             <span class="dt">conf.low =</span> t_test<span class="op">$</span>conf.int[<span class="dv">1</span>],
             <span class="dt">conf.high =</span> t_test<span class="op">$</span>conf.int[<span class="dv">2</span>],
             <span class="dt">p.value =</span> t_test<span class="op">$</span>p.value)
}

<span class="kw">c</span>(<span class="st">"Sw_amt"</span>,
  <span class="st">"Net_rent_amt"</span>,
  <span class="st">"Net_CG_amt"</span>,
  <span class="st">"Tot_inc_amt"</span>,
  <span class="st">"Tot_ded_amt"</span>,
  <span class="st">"Taxable_Income"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lapply</span>(conf_int_of_t.test) <span class="op">%&gt;%</span>
<span class="st">  </span>rbindlist <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="kw">list</span>(var, conf.low, conf.high, p.value)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> var,
             <span class="dt">ymin =</span> conf.low,
             <span class="dt">ymax =</span> conf.high,
             <span class="dt">color =</span> p.value <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_errorbar</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>)</code></pre></div>
<p><img src="grattan_files/figure-html/unnamed-chunk-13-1.png" width="864"></p>
<div id="years-not-in-sample-files" class="section level2">
<h2 class="hasAnchor">
<a href="#years-not-in-sample-files" class="anchor"></a>Years not in sample files</h2>
<p>Other tests can be found in the <code>tests/</code> folder to compare the tax collections in those years.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#budget-2018">Budget 2018</a></li>
      <li>
<a href="#bracket-creep">Bracket creep</a><ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      </ul>
</li>
      <li>
<a href="#companion-to-the-2013-14-sample-file">Companion to the 2013-14 sample file</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prologue">Prologue</a></li>
      </ul>
</li>
      <li>
<a href="#differential-uprating">Differential uprating</a><ul class="nav nav-pills nav-stacked">
<li><a href="#basic-uprating">Basic uprating</a></li>
      <li><a href="#differential-uprating-1">Differential uprating</a></li>
      </ul>
</li>
      <li>
<a href="#modelling-superannuation-changes">Modelling superannuation changes</a><ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-1">Introduction</a></li>
      <li><a href="#modelling">Modelling</a></li>
      </ul>
</li>
      <li>
<a href="#performance-of-project">Performance of project</a><ul class="nav nav-pills nav-stacked">
<li><a href="#years-not-in-sample-files">Years not in sample files</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hugh Parsonage, Tim Cameron, Brendan Coates, Matthew Katzen, William Young.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
