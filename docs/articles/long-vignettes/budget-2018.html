<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget 2018 modelling • grattan</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Budget 2018 modelling">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">grattan</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.6.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/grattan.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/datatable-implementation.html">Calculations of income tax are rolling joins</a>
    </li>
    <li>
      <a href="../../articles/long-vignettes/budget-2018.html">Budget 2018 modelling</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HughParsonage/grattan">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Budget 2018 modelling</h1>
                        <h4 class="author">Hugh Parsonage</h4>
            
            <h4 class="date">2018-09-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HughParsonage/grattan/blob/master/vignettes/long-vignettes/budget-2018.Rmd"><code>vignettes/long-vignettes/budget-2018.Rmd</code></a></small>
      <div class="hidden name"><code>budget-2018.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stopifnot</span>(<span class="kw">file.exists</span>(<span class="st">"../../DESCRIPTION"</span>))
<span class="kw">stopifnot</span>(<span class="op">!</span><span class="kw">isFALSE</span>(<span class="kw">getOption</span>(<span class="st">"knitr.use.stringr"</span>)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># New fwriter so that git checkins are not too bad:</span>
fwrite &lt;-<span class="st"> </span><span class="cf">function</span>(x, file, ...) {
  xo &lt;-<span class="st"> </span><span class="kw">copy</span>(x)
  <span class="cf">for</span> (j <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {
    xj &lt;-<span class="st"> </span>x[[j]]
    <span class="cf">if</span> (<span class="kw">is.double</span>(xj)) {
      jmax &lt;-<span class="st"> </span><span class="kw">max</span>(xj, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
      jmin &lt;-<span class="st"> </span><span class="kw">min</span>(xj, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
      <span class="cf">if</span> (jmax <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;&amp;</span><span class="st"> </span>jmin <span class="op">&gt;</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span>) {
        <span class="kw">set</span>(xo, <span class="dt">j =</span> j, <span class="dt">value =</span> <span class="kw">round</span>(xj, <span class="dv">4</span>))
      } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">abs</span>(jmin) <span class="op">&gt;</span><span class="st"> </span><span class="fl">100e3</span>) {
        <span class="kw">set</span>(xo, <span class="dt">j =</span> j, <span class="dt">value =</span> <span class="kw">round</span>(xj, <span class="op">-</span><span class="dv">3</span>))
      } <span class="cf">else</span> {
        <span class="kw">set</span>(xo, <span class="dt">j =</span> j, <span class="dt">value =</span> <span class="kw">round</span>(xj, <span class="dv">1</span>))
      }
    }
  }
  data.table<span class="op">::</span><span class="kw">fwrite</span>(xo, file, ...)
  
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grattan_percent &lt;-<span class="st"> </span><span class="cf">function</span>(number, <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">.percent.suffix =</span> <span class="st">" per cent"</span>) {
  grattanCharts<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grattanCharts/topics/grattan_percent">grattan_percent</a></span>(number, digits, .percent.suffix)
}</code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This article outlines the calculations used in Grattan Institute’s tax modelling. The model is simple:</p>
<ol style="list-style-type: decimal">
<li>Project (“uprate”) the latest sample files to the years required</li>
<li>Use <code>model_income_tax</code> with the required parameters.</li>
</ol>
<p>First load the packages we’ll need.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fst)
<span class="kw">library</span>(fastmatch)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'fastmatch'</span>
<span class="co">#&gt; The following object is masked from 'package:hutils':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     coalesce</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(scales)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(ggrepel)
<span class="kw">library</span>(viridis)
<span class="co">#&gt; Loading required package: viridisLite</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'viridis'</span>
<span class="co">#&gt; The following object is masked from 'package:scales':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     viridis_pal</span>
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(hutils)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(data.table)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'data.table'</span>
<span class="co">#&gt; The following object is masked _by_ '.GlobalEnv':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     fwrite</span>
<span class="kw">library</span>(grattanCharts)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'grattanCharts'</span>
<span class="co">#&gt; The following object is masked _by_ '.GlobalEnv':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     grattan_percent</span>
<span class="co">#&gt; The following object is masked from 'package:datasets':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Orange</span>
templib &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/provide.dir">provide.dir</a></span>(templib)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(grattan)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ntile &lt;-<span class="st"> </span><span class="cf">function</span>(x, n) {
  <span class="cf">if</span> (<span class="kw">requireNamespace</span>(<span class="st">"dplyr"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
    dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/ranking.html">ntile</a></span>(x, n)
  } <span class="cf">else</span> {
    grattan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grattan/topics/weighted_ntile">weighted_ntile</a></span>(x, <span class="dt">n =</span> n)
  }
}
coalesce &lt;-<span class="st"> </span>hutils<span class="op">::</span>coalesce</code></pre></div>
<p>We also load the <code>taxstats</code> package. The other packages are private as the ATO has suppressed the information from the public: unfortunately, only approved institutions can use this data sets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(taxstats)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">1415</span> &lt;-
<span class="st">  </span><span class="cf">if</span> (<span class="kw">requireNamespace</span>(<span class="st">"SampleFile1415"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
    SampleFile1415<span class="op">::</span>sample_file_<span class="dv">1415</span>
  } <span class="cf">else</span> {
    taxstats<span class="op">::</span>sample_file_1415_synth
  }</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_file_<span class="dv">1516</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)) {
    <span class="kw">fread</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>, <span class="dt">logical01 =</span> <span class="ot">FALSE</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">requireNamespace</span>(<span class="st">"taxstats"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
    taxstats1516<span class="op">::</span>sample_file_1516_synth
  } <span class="cf">else</span> {
    <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1415</span>, <span class="dt">h =</span> 1L)
  }</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="kw">file.exists</span>(sample_files_all.fst &lt;-<span class="st"> "budget-2018_cache/sample_files_all.fst"</span>) <span class="op">&amp;&amp;</span>
<span class="st">    </span>cache) {
  sample_files_all &lt;-<span class="st"> </span><span class="kw">read_fst</span>(sample_files_all.fst, <span class="dt">as.data.table =</span> <span class="ot">TRUE</span>)    
} <span class="cf">else</span> {
  sample_files_all &lt;-
<span class="st">    </span><span class="kw">rbindlist</span>(<span class="kw">lapply</span>(<span class="kw">list</span>(<span class="st">`</span><span class="dt">2003-04</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0304</span>, 
                          <span class="st">`</span><span class="dt">2004-05</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0405</span>,
                          <span class="st">`</span><span class="dt">2005-06</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0506</span>, 
                          <span class="st">`</span><span class="dt">2006-07</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0607</span>,
                          <span class="st">`</span><span class="dt">2007-08</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0708</span>, 
                          <span class="st">`</span><span class="dt">2008-09</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0809</span>,
                          <span class="st">`</span><span class="dt">2009-10</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0910</span>, 
                          <span class="st">`</span><span class="dt">2010-11</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1011</span>,
                          <span class="st">`</span><span class="dt">2011-12</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1112</span>, 
                          <span class="st">`</span><span class="dt">2012-13</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1213</span>,
                          <span class="st">`</span><span class="dt">2013-14</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1314</span>,
                          <span class="st">`</span><span class="dt">2014-15</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1415</span>,
                          <span class="st">`</span><span class="dt">2015-16</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1516</span>), 
                     data.table<span class="op">::</span>as.data.table),
              <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
              <span class="dt">fill =</span> <span class="ot">TRUE</span>, 
              <span class="dt">idcol =</span> <span class="st">"fy.year"</span>)
  sample_files_all[, WEIGHT <span class="op">:</span><span class="er">=</span><span class="st"> </span>hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/if_else">if_else</a></span>(fy.year <span class="op">&gt;</span><span class="st"> '2010-11'</span>, 50L, 100L)]
  sample_files_all[<span class="kw">is.na</span>(age_range), age_range <span class="op">:</span><span class="er">=</span><span class="st"> </span>Birth_year]
  sample_files_all[<span class="kw">is.na</span>(Othr_pnsn_amt), Othr_pnsn_amt <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]
  sample_files_all[<span class="kw">is.na</span>(Med_Exp_TO_amt), Med_Exp_TO_amt <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]
  sample_files_all[<span class="kw">is.na</span>(Spouse_adjusted_taxable_inc), Spouse_adjusted_taxable_inc <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]
  age_range_decoder &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(age_range_decoder)
  
  sample_files_all <span class="op">%&gt;%</span>
<span class="st">    </span>.[, tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> .BY[[1L]], <span class="dt">.dots.ATO =</span> .SD), keyby =<span class="st"> "fy.year"</span>] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, Taxable_Income_percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>), keyby =<span class="st"> "fy.year"</span>]
  <span class="kw">write_fst</span>(sample_files_all, sample_files_all.fst)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">revenue_foregone &lt;-<span class="st"> </span><span class="cf">function</span>(dt, <span class="dt">revenue_positive =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="ot">NULL</span>) {
  out &lt;-<span class="st"> </span>dt[, <span class="kw">sum</span>((<span class="kw">as.integer</span>(new_tax) <span class="op">-</span><span class="st"> </span>baseline_tax) <span class="op">*</span><span class="st"> </span>WEIGHT)]
  <span class="kw">class</span>(out) &lt;-<span class="st"> "revenue_foregone"</span>
  <span class="kw">setattr</span>(out, <span class="st">"digits"</span>, digits)
  out
}

.revenue_foregone &lt;-<span class="st"> </span><span class="cf">function</span>(dt, <span class="dt">revenue_positive =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="ot">NULL</span>) {
  out &lt;-<span class="st"> </span>dt[, <span class="kw">sum</span>((<span class="kw">as.integer</span>(new_tax) <span class="op">-</span><span class="st"> </span>baseline_tax) <span class="op">*</span><span class="st"> </span>WEIGHT)]
  <span class="kw">class</span>(out) &lt;-<span class="st"> "revenue_foregone"</span>
  <span class="kw">setattr</span>(out, <span class="st">"digits"</span>, digits)
  
  <span class="cf">if</span> (<span class="kw">is_knitting</span>()) {
    <span class="kw">return</span>(<span class="kw">print.revenue_foregone</span>(out))
  }
  out
}

print.revenue_foregone &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {
  <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {
    pre &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"\u2212"</span>, <span class="cf">if</span> (<span class="kw">is_knitting</span>()) <span class="st">"</span><span class="ch">\\</span><span class="st">$"</span> <span class="cf">else</span> <span class="st">"$"</span>)
    x &lt;-<span class="st"> </span><span class="op">-</span>x
  } <span class="cf">else</span> {
    pre &lt;-<span class="st"> "$"</span>
  }
  d &lt;-<span class="st"> </span><span class="cf">function</span>(default) {
    <span class="cf">if</span> (<span class="kw">is.null</span>(<span class="kw">attr</span>(x, <span class="st">"digits"</span>))) {
      default
    } <span class="cf">else</span> {
      <span class="kw">attr</span>(x, <span class="st">"digits"</span>)
    }
  }
  <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span><span class="fl">10e9</span>) {
    res &lt;-<span class="st"> </span><span class="kw">paste0</span>(pre, <span class="kw">prettyNum</span>(<span class="kw">round</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="kw">d</span>(<span class="dv">0</span>)), <span class="dt">big.mark =</span> <span class="st">","</span>), <span class="st">" billion"</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span><span class="fl">1e9</span>) {
    res &lt;-<span class="st"> </span><span class="kw">paste0</span>(pre, <span class="kw">prettyNum</span>(<span class="kw">round</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="kw">d</span>(<span class="dv">1</span>)), <span class="dt">big.mark =</span> <span class="st">","</span>), <span class="st">" billion"</span>)
  } <span class="cf">else</span> {
    res &lt;-<span class="st"> </span><span class="kw">paste0</span>(pre, <span class="kw">prettyNum</span>(<span class="kw">round</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span>, <span class="kw">d</span>(<span class="dv">0</span>)), <span class="dt">big.mark =</span> <span class="st">","</span>), <span class="st">" million"</span>)
  }
  <span class="kw">print</span>(res)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @details 700ms vs 57ms</span>
get_near_term &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">fy_year =</span> <span class="kw">c</span>(<span class="st">"2016-17"</span>, <span class="st">"2017-18"</span>, <span class="st">"2018-19"</span>)) {
  fy_year &lt;-<span class="st"> </span><span class="kw">match.arg</span>(fy_year)
  h &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year) <span class="op">-</span><span class="st"> </span>2016L)
  syyyy &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="kw">substr</span>(fy_year, <span class="dv">3</span>, <span class="dv">4</span>), <span class="kw">substr</span>(fy_year, <span class="dv">6</span>, <span class="dv">7</span>))
  <span class="cf">if</span> (<span class="kw">file.exists</span>(syyyy.fst &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">"budget-2018_cache/%s.fst"</span>, syyyy)) <span class="op">&amp;&amp;</span><span class="st"> </span>cache) {
    s &lt;-<span class="st"> </span><span class="kw">read_fst</span>(syyyy.fst, <span class="dt">as.data.table =</span> <span class="ot">TRUE</span>)
  } <span class="cf">else</span> {
    s &lt;-<span class="st"> </span>
<span class="st">      </span><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)) {
        sample_file_<span class="dv">1516</span> &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)
        <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> h , <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2015-16"</span>)
      } <span class="cf">else</span> {
        <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_1415_synth, <span class="dt">h =</span> h <span class="op">+</span><span class="st"> </span>1L, <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2014-15"</span>)
      }
    s &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s, <span class="st">"2017-18"</span>)
    s[, Taxable_Income_percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>)]
    <span class="kw">write_fst</span>(s, syyyy.fst)
  }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1617 &lt;-<span class="st"> </span><span class="kw">get_near_term</span>(<span class="st">"2016-17"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1718 &lt;-<span class="st"> </span><span class="kw">get_near_term</span>(<span class="st">"2017-18"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1819 &lt;-<span class="st"> </span><span class="kw">get_near_term</span>(<span class="st">"2018-19"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Used throughout: takes 0.25s of each query, improves consistency</span>
unique_fy_year &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>)</code></pre></div>
<p>These tables come from the Budget papers and will be passed to <code>project</code> so that the uprating can be set with fixed values. (By default <code>project</code> forecasts the series using the <code>forecast</code> package.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_forecasts &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2018</span><span class="op">:</span><span class="dv">2028</span>),
             <span class="dt">r =</span> <span class="kw">c</span>(<span class="fl">2.25</span>, <span class="fl">2.75</span>, <span class="fl">3.25</span>, <span class="fl">3.5</span>, <span class="fl">3.5</span>, <span class="kw">rep</span>(<span class="fl">3.5</span>, <span class="dv">6</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lf_forecasts &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2018</span><span class="op">:</span><span class="dv">2028</span>),
             <span class="dt">r =</span> <span class="kw">c</span>(<span class="fl">2.75</span>, <span class="fl">1.50</span>, <span class="fl">1.50</span>, <span class="fl">1.50</span>, <span class="fl">1.25</span>, <span class="kw">rep</span>(<span class="fl">1.25</span>, <span class="dv">6</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</code></pre></div>
<p>These are functions of years from 2015-16 that return the tax rates and tax thresholds that the Government has proposed in the Budget. They are used so that the out years can be modelled conveniently as a function of the year only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ordinary_tax_rates &lt;-<span class="st"> </span><span class="cf">function</span>(fy_year) {
  <span class="cf">if</span> (fy_year <span class="op">&lt;</span><span class="st"> "2024-25"</span>) {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span>, <span class="fl">0.325</span>, <span class="fl">0.37</span>, <span class="fl">0.45</span>)
  } <span class="cf">else</span> {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span>, <span class="fl">0.325</span>, <span class="fl">0.45</span>)  
  }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ordinary_tax_thresholds &lt;-<span class="st"> </span><span class="cf">function</span>(fy_year) {
  <span class="cf">if</span> (fy_year <span class="op">&lt;</span><span class="st"> "2022-23"</span>) {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="fl">37e3</span>, <span class="fl">90e3</span>, <span class="fl">180e3</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (fy_year <span class="op">&lt;</span><span class="st"> "2024-25"</span>) {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="fl">41e3</span>, <span class="fl">120e3</span>, <span class="fl">180e3</span>)
  } <span class="cf">else</span> {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="fl">41e3</span>, <span class="fl">200e3</span>)
  }
}</code></pre></div>
<p>These functions increase the thresholds for the Medicare levy for low-income earners. Technically such measures have to be approved each financial year, but are as a matter of a routine.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @param x2018 A length-one for the 2018-19 number.</span>
<span class="co">#' @param fy The financial year</span>
.do_medicare_levy &lt;-<span class="st"> </span><span class="cf">function</span>(x2018, fy) {
  <span class="kw">stopifnot</span>(<span class="kw">length</span>(fy) <span class="op">==</span><span class="st"> </span>1L, <span class="kw"><a href="../../reference/is.fy.html">is.fy</a></span>(fy))
  <span class="cf">if</span> (fy <span class="op">==</span><span class="st"> "2018-19"</span>) {
    <span class="kw">return</span>(x2018)
  } <span class="cf">else</span> {
    <span class="kw">return</span>(<span class="kw">round</span>(<span class="kw"><a href="../../reference/cpi_inflator.html">cpi_inflator</a></span>(x2018, <span class="dt">from_fy =</span> <span class="st">"2017-18"</span>, <span class="dt">to_fy =</span> fy), <span class="op">-</span><span class="dv">1</span>))
  }
}

medicare_levy_lower_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">21980</span>, fy)
}

medicare_levy_lower_sapto_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">34758</span>, fy)
}

medicare_levy_lower_family_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">48385</span>, fy)
}

medicare_levy_lower_family_sapto_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">48385</span>, fy)
}

medicare_levy_lower_up_for_each_child &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">3406</span>, fy)
}

.project_to &lt;-<span class="st"> </span><span class="cf">function</span>(h, use.Treasury) {
  <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>,
          <span class="dt">h =</span> h,
          <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2015-16"</span>,
          <span class="dt">wage.series =</span> <span class="cf">if</span> (use.Treasury) wage_forecasts,
          <span class="dt">lf.series =</span> <span class="cf">if</span> (use.Treasury) lf_forecasts) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">setkey</span>(Taxable_Income)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useTreasurys &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, .project_to, <span class="dt">use.Treasury =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useGrattans &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, .project_to, <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># &amp;&amp; cache generally because the filename must be known if cache = FALSE</span>
<span class="cf">if</span> (<span class="kw">file.exists</span>(s2425_Treasury.fst &lt;-<span class="st"> "budget-2018_cache/s2425_Treasury.fst"</span>) <span class="op">&amp;&amp;</span><span class="st"> </span>cache) {
  s2425_Treasury &lt;-<span class="st"> </span><span class="kw">read_fst</span>(s2425_Treasury.fst, 
                             <span class="dt">as.data.table =</span> <span class="ot">TRUE</span>)
} <span class="cf">else</span> {
  s2425_Treasury &lt;-<span class="st"> </span>.project_useTreasurys[[2025L <span class="op">-</span><span class="st"> </span>2016L]]
  <span class="kw">write_fst</span>(s2425_Treasury, s2425_Treasury.fst)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="kw">file.exists</span>(s2728_Treasury.fst &lt;-<span class="st"> "budget-2018_cache/s2728_Treasury.fst"</span>) <span class="op">&amp;&amp;</span><span class="st"> </span>cache) {
  s2728_Treasury &lt;-<span class="st"> </span><span class="kw">read_fst</span>(s2728_Treasury.fst, 
                             <span class="dt">as.data.table =</span> <span class="ot">TRUE</span>)
} <span class="cf">else</span> {
  s2728_Treasury &lt;-<span class="st"> </span>.project_useTreasurys[[2028L <span class="op">-</span><span class="st"> </span>2016L]]
  <span class="kw">write_fst</span>(s2728_Treasury, s2728_Treasury.fst)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_r80 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
             <span class="dt">i =</span> <span class="kw"><a href="../../reference/wage_inflator.html">wage_inflator</a></span>(<span class="dt">from_fy =</span> <span class="st">"2015-16"</span>,
                               <span class="dt">to_fy =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
                               <span class="dt">forecast.level =</span> <span class="dv">80</span>,
                               <span class="dt">forecast.series =</span> <span class="st">"upper"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, r <span class="op">:</span><span class="er">=</span><span class="st"> </span>i <span class="op">/</span><span class="st"> </span><span class="kw">shift</span>(i) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">is.na</span>(r), .(fy_year, r)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_r20 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
             <span class="dt">i =</span> <span class="kw"><a href="../../reference/wage_inflator.html">wage_inflator</a></span>(<span class="dt">from_fy =</span> <span class="st">"2015-16"</span>,
                               <span class="dt">to_fy =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
                               <span class="dt">forecast.level =</span> <span class="dv">80</span>,
                               <span class="dt">forecast.series =</span> <span class="st">"lower"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, r <span class="op">:</span><span class="er">=</span><span class="st"> </span>i <span class="op">/</span><span class="st"> </span><span class="kw">shift</span>(i) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">is.na</span>(r), .(fy_year, r)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useGrattans80 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="cf">function</span>(h) {
  <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> h, <span class="dt">wage.series =</span> wage_r80)
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useGrattans20 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="cf">function</span>(h) {
  <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> h, <span class="dt">wage.series =</span> wage_r20)
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useGrattans2.<span class="dv">75</span> &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, <span class="cf">function</span>(h) {
  <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> h, <span class="dt">wage.series =</span> <span class="fl">0.0275</span>)
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @param level Prediction interval level.</span>
<span class="co">#' @param wage.r A string like "2.75\%", the wage growth as a percentage.</span>
model_Budgets &lt;-<span class="st"> </span><span class="cf">function</span>(fy_year, 
                          <span class="dt">use.Treasury =</span> <span class="ot">TRUE</span>,
                          <span class="dt">.debug =</span> <span class="ot">FALSE</span>,
                          <span class="dt">level =</span> <span class="ot">NULL</span>, 
                          <span class="dt">wage.r =</span> <span class="ot">NULL</span>) { 
  h &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year) <span class="op">-</span><span class="st"> </span>2016L)
  s1920 &lt;-<span class="st"> </span><span class="ot">NULL</span>
  <span class="cf">if</span> (use.Treasury) {
    <span class="cf">if</span> (<span class="kw">missing</span>(level) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">missing</span>(wage.r)) {
      s1920 &lt;-<span class="st"> </span>.project_useTreasurys[[h]]
    } <span class="cf">else</span> {
      <span class="kw">stop</span>(<span class="st">"`use.Treasury = TRUE` yet `level` or `wage.r` are supplied."</span>)
    }
  } <span class="cf">else</span> {
    <span class="cf">if</span> (<span class="kw">is.null</span>(level)) {
      <span class="cf">if</span> (<span class="kw">is.null</span>(wage.r)) {
        s1920 &lt;-<span class="st"> </span>.project_useGrattans[[h]]
      } <span class="cf">else</span> {
        <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.character</span>(wage.r) <span class="op">||</span><span class="st"> </span><span class="kw">length</span>(wage.r) <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) {
          <span class="kw">stop</span>(<span class="st">"`wage.r` must be a string."</span>)
        } 
        <span class="cf">switch</span> (wage.r, 
                <span class="st">"2.75%"</span> =<span class="st"> </span>{
                  s1920 &lt;-<span class="st"> </span>.project_useGrattans2.<span class="dv">75</span>[[h]]
                }, 
                <span class="kw">stop</span>(<span class="st">"`wage.r = "</span>, wage.r, <span class="st">"` not supported."</span>))
      }
    } <span class="cf">else</span> {
      <span class="cf">if</span> (level <span class="op">==</span><span class="st"> </span><span class="dv">20</span>) {
        s1920 &lt;-<span class="st"> </span>.project_useGrattans20[[h]]
      } <span class="cf">else</span> <span class="cf">if</span> (level <span class="op">==</span><span class="st"> </span><span class="dv">80</span>) {
        s1920 &lt;-<span class="st"> </span>.project_useGrattans80[[h]]
      } <span class="cf">else</span> {
        <span class="kw">stop</span>(<span class="st">"Level not supported."</span>)
      }
    }
  }
  model_income_tax &lt;-<span class="st"> </span><span class="cf">function</span>(...,
                               <span class="dt">lamington =</span> <span class="ot">FALSE</span>,
                               <span class="dt">lito_202223 =</span> <span class="ot">FALSE</span>, 
                               <span class="dt">watr =</span> <span class="ot">FALSE</span>) {
    grattan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grattan/topics/model_income_tax">model_income_tax</a></span>(
      <span class="dt">sample_file =</span> s1920, 
      <span class="dt">baseline_fy =</span> <span class="st">"2017-18"</span>,
      <span class="dt">medicare_levy_lower_threshold =</span> <span class="kw">medicare_levy_lower_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_sapto_threshold =</span> <span class="kw">medicare_levy_lower_sapto_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_family_threshold =</span> <span class="kw">medicare_levy_lower_family_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_family_sapto_threshold =</span> <span class="kw">medicare_levy_lower_family_sapto_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_up_for_each_child =</span> <span class="kw">medicare_levy_lower_up_for_each_child</span>(fy_year),
      <span class="dt">warn_upper_thresholds =</span> <span class="ot">FALSE</span>,
      <span class="dt">Budget2018_lamington =</span> lamington,
      <span class="dt">Budget2018_lito_202223 =</span> lito_<span class="dv">202223</span>,
      <span class="dt">Budget2018_watr =</span> watr,
      ...) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(Ind, age_range, Total_PP_BE_amt, Total_NPP_BE_amt, Taxable_Income, new_tax, baseline_tax, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, new_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(new_tax)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span>new_tax <span class="op">-</span><span class="st"> </span>baseline_tax] <span class="op">%&gt;%</span>
<span class="st">      </span>
<span class="st">      </span>.[]
  }
  
  is_lamington &lt;-<span class="st"> </span>fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2019-20"</span>, <span class="st">"2020-21"</span>, <span class="st">"2021-22"</span>)
  
  <span class="kw">list</span>(
    <span class="dt">Budget2018_baseline =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(),
    <span class="dt">Baseline_brackets_cpi =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_thresholds =</span> <span class="kw"><a href="../../reference/cpi_inflator.html">cpi_inflator</a></span>(<span class="kw">ordinary_tax_thresholds</span>(<span class="dv">1</span>),
                                                                                               <span class="dt">from_fy =</span> <span class="st">"2017-18"</span>,
                                                                                               <span class="dt">to_fy =</span> fy_year)),
    <span class="dt">Budget2018_just_rates =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span>  <span class="kw">ordinary_tax_rates</span>(fy_year),
                                             <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(fy_year),
                                             <span class="dt">lito_202223 =</span> <span class="ot">FALSE</span>,
                                             <span class="dt">lamington =</span> <span class="ot">FALSE</span>),
    <span class="dt">Budget2018_lamington_et_LITO =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">lito_202223 =</span> fy_year <span class="op">&gt;=</span><span class="st"> "2022-23"</span>,
                                                      <span class="dt">lamington =</span> is_lamington),
    <span class="dt">Budget2018 =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(fy_year),
                                  <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(fy_year),
                                  <span class="dt">lito_202223 =</span> fy_year <span class="op">&gt;=</span><span class="st"> "2022-23"</span>,
                                  <span class="dt">lamington =</span> is_lamington),
    <span class="dt">Budget2018_Step1and2 =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="kw">pmin</span>(fy_year, <span class="st">"2022-23"</span>)), 
                                            <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="kw">pmin</span>(fy_year, <span class="st">"2022-23"</span>)),
                                            <span class="dt">lito_202223 =</span> fy_year <span class="op">&gt;=</span><span class="st"> "2022-23"</span>, 
                                            <span class="dt">lamington =</span> is_lamington),
    <span class="dt">ALP2018 =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="kw">pmin</span>(fy_year, <span class="st">"2022-23"</span>)), 
                               <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="kw">pmin</span>(fy_year, <span class="st">"2022-23"</span>)),
                               <span class="dt">lamington =</span> <span class="ot">FALSE</span>,
                               <span class="dt">watr =</span> <span class="ot">TRUE</span>))
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.ntile &lt;-<span class="st"> </span><span class="cf">function</span>(x, n) {
  <span class="cf">if</span> (<span class="kw">is.unsorted</span>(x)) {
    <span class="kw">stop</span>(<span class="st">"`x` must be sorted."</span>)
  }
  <span class="kw">as.integer</span>(<span class="kw">floor</span>(n <span class="op">*</span><span class="st"> </span>(<span class="kw">seq_along</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span><span class="kw">length</span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))
}
.ntile2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, n, <span class="dt">N =</span> <span class="kw">length</span>(x)) {
  <span class="cf">if</span> (<span class="kw">is.unsorted</span>(x)) {
    <span class="kw">stop</span>(<span class="st">"`x` must be sorted."</span>)
  }
  <span class="kw">as.integer</span>(<span class="kw">floor</span>(n <span class="op">*</span><span class="st"> </span>(<span class="kw">seq_len</span>(N) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">/</span>N <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">percentile2quintile &lt;-<span class="st"> </span><span class="cf">function</span>(p) {
  {{p <span class="op">-</span><span class="st"> </span>1L} <span class="op">%/%</span><span class="st"> </span>20L} <span class="op">+</span><span class="st"> </span>1L
}
<span class="kw">stopifnot</span>(<span class="kw">identical</span>(<span class="kw">ntile</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>, <span class="dv">5</span>), <span class="kw">percentile2quintile</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>)))
x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1009</span>)
<span class="kw">stopifnot</span>(<span class="kw">identical</span>(<span class="kw">ntile</span>(x, <span class="dv">5</span>), <span class="kw">percentile2quintile</span>(<span class="kw">ntile</span>(x, <span class="dv">100</span>))))
<span class="kw">rm</span>(x)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rowname2column &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">newcol =</span> <span class="st">"id"</span>) {
  <span class="cf">if</span> (<span class="kw">is.data.table</span>(df)) {
    <span class="kw">warning</span>(<span class="st">"`df` is a data.table. No rownames to provide."</span>)
    <span class="kw">return</span>(df)
  } <span class="cf">else</span> {
    rn &lt;-<span class="st"> </span><span class="kw">rownames</span>(<span class="kw">as.matrix</span>(df))
    out &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(<span class="kw">as.matrix</span>(df))
    <span class="kw">cbind</span>(<span class="kw">data.table</span>(<span class="dt">id =</span> rn), out)
  }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bind_Budget2018_models &lt;-<span class="st"> </span><span class="cf">function</span>(chunk, <span class="dt">.cache =</span> cache, ...) {
  <span class="cf">if</span> (<span class="kw">is_knitting</span>()) {
    current_chunk &lt;-<span class="st"> </span>opts_current<span class="op">$</span><span class="kw">get</span>(<span class="dt">name =</span> <span class="st">"label"</span>)
    <span class="cf">if</span> (<span class="op">!</span><span class="kw">identical</span>(chunk, current_chunk)) {
      <span class="kw">stop</span>(<span class="st">"`chunk = "</span>, chunk, <span class="st">"`, yet</span><span class="ch">\n</span><span class="st">"</span>, 
           <span class="st">"current chunk: "</span>, current_chunk, <span class="st">"."</span>)
    }
  }
  
  <span class="cf">if</span> (<span class="kw">file.exists</span>(x.fst &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">"budget-2018_cache/%s.fst"</span>, chunk)) <span class="op">&amp;&amp;</span><span class="st"> </span>.cache) {
    <span class="kw">read_fst</span>(x.fst, <span class="dt">as.data.table =</span> <span class="ot">TRUE</span>)
  } <span class="cf">else</span> {
    Budget_<span class="dv">1922</span> &lt;-<span class="st"> </span><span class="kw">lapply</span>(unique_fy_year, model_Budgets, ...)
    <span class="kw">names</span>(Budget_<span class="dv">1922</span>) &lt;-<span class="st"> </span>unique_fy_year
    
    <span class="cf">if</span> (<span class="kw">is_knitting</span>()) {
      revenue_fy_year &lt;-<span class="st"> </span>
<span class="st">        </span><span class="kw">sapply</span>(Budget_<span class="dv">1922</span>, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">divide_by</span>(<span class="fl">1e9</span>)
      revenue_by_id &lt;-
<span class="st">        </span>revenue_fy_year <span class="op">%&gt;%</span>
<span class="st">        </span>rowSums
      
      revenue_fy_year &lt;-<span class="st"> </span><span class="kw">rowname2column</span>(revenue_fy_year)
      revenue_by_id &lt;-<span class="st"> </span><span class="kw">rowname2column</span>(revenue_by_id)
      <span class="kw">setnames</span>(revenue_by_id, <span class="st">"V1"</span>, <span class="st">"Revenue/$bn"</span>)
      
      file_suffix &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">"bound_models_?"</span>, <span class="st">""</span>, current_chunk)
      <span class="cf">if</span> (<span class="kw">nzchar</span>(file_suffix)) {
        <span class="co"># i.e. -- designates deviation from budget</span>
        file_suffix &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"--"</span>, file_suffix)
      }
      <span class="kw">fwrite</span>(revenue_fy_year, <span class="kw">sprintf</span>(<span class="st">"revenue-by-fy_year-id%s.csv"</span>, file_suffix))
      <span class="kw">fwrite</span>(revenue_by_id, <span class="kw">sprintf</span>(<span class="st">"revenue-by-id%s.csv"</span>, file_suffix))
    }
    
    a &lt;-<span class="st"> </span><span class="kw">lapply</span>(Budget_<span class="dv">1922</span>, rbindlist, <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">idcol =</span> <span class="st">"id"</span>)
    b &lt;-<span class="st"> </span><span class="kw">rbindlist</span>(a, <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">idcol =</span> <span class="st">"fy_year"</span>)
    <span class="kw">setkey</span>(b, fy_year, id, Taxable_Income)
    b[, Taxable_Income_percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">.ntile</span>(Taxable_Income, <span class="dv">100</span>), 
      keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"id"</span>)]
    b[, Quintile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">percentile2quintile</span>(Taxable_Income_percentile)]
    <span class="kw">setkey</span>(b, fy_year, id, Taxable_Income)
    <span class="kw">write_fst</span>(b, x.fst)
    b[]
  } 
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models &lt;-<span class="st"> </span><span class="kw">bind_Budget2018_models</span>(<span class="st">"bound_models"</span>)
<span class="cf">if</span> (<span class="op">!</span>cache) {
  bound_models[id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Budget2018"</span>, <span class="st">"Budget2018_Step1and2"</span>, <span class="st">"Budget2018_baseline"</span>),
               .SD,
               .SDcols =<span class="st"> </span><span class="kw">c</span>(<span class="st">"id"</span>,
                           <span class="st">"fy_year"</span>,
                           <span class="st">"delta"</span>,
                           <span class="st">"WEIGHT"</span>,
                           <span class="st">"Taxable_Income"</span>, 
                           <span class="st">"new_tax"</span>, 
                           <span class="st">"baseline_tax"</span>)] <span class="op">%&gt;%</span>
<span class="st">    </span>fst<span class="op">::</span><span class="kw"><a href="http://www.fstpackage.org/reference/write_fst.html">write_fst</a></span>(<span class="dt">path =</span> <span class="st">"~/Budget-2018-Senate-submission/data/bound-models.fst"</span>, 
                   <span class="dt">compress =</span> <span class="dv">100</span>)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models_Grattan &lt;-<span class="st"> </span><span class="kw">bind_Budget2018_models</span>(<span class="st">"bound_models_Grattan"</span>, <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models_Grattan80 &lt;-<span class="st"> </span><span class="kw">bind_Budget2018_models</span>(<span class="st">"bound_models_Grattan80"</span>, 
                                                 <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>, 
                                                 <span class="dt">level =</span> <span class="dv">80</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models_Grattan20 &lt;-<span class="st"> </span><span class="kw">bind_Budget2018_models</span>(<span class="st">"bound_models_Grattan20"</span>, 
                                                 <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>, 
                                                 <span class="dt">level =</span> <span class="dv">20</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models_Grattan2.<span class="dv">75</span> &lt;-
<span class="st">  </span><span class="kw">bind_Budget2018_models</span>(<span class="st">"bound_models_Grattan2.75"</span>, 
                         <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>, 
                         <span class="dt">wage.r =</span> <span class="st">"2.75%"</span>)</code></pre></div>
<div id="costings-2018-19-to-2027-28-govt-growth-assumptions" class="section level3">
<h3 class="hasAnchor">
<a href="#costings-2018-19-to-2027-28-govt-growth-assumptions" class="anchor"></a>Costings 2018-19 to 2027-28 (Govt growth assumptions)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">fread</span>(<span class="st">"revenue-by-fy_year-id.csv"</span>))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Budget2018_baseline</td>
<td align="right">0.0</td>
<td align="right">-0.1</td>
<td align="right">-0.1</td>
<td align="right">-0.2</td>
<td align="right">-0.2</td>
<td align="right">-0.3</td>
<td align="right">-0.3</td>
<td align="right">-0.3</td>
<td align="right">-0.4</td>
<td align="right">-0.4</td>
</tr>
<tr class="even">
<td align="left">Baseline_brackets_cpi</td>
<td align="right">-2.2</td>
<td align="right">-4.4</td>
<td align="right">-6.6</td>
<td align="right">-9.0</td>
<td align="right">-11.5</td>
<td align="right">-14.1</td>
<td align="right">-16.9</td>
<td align="right">-19.8</td>
<td align="right">-22.9</td>
<td align="right">-26.1</td>
</tr>
<tr class="odd">
<td align="left">Budget2018_just_rates</td>
<td align="right">-0.4</td>
<td align="right">-0.5</td>
<td align="right">-0.6</td>
<td align="right">-0.6</td>
<td align="right">-9.5</td>
<td align="right">-10.0</td>
<td align="right">-17.0</td>
<td align="right">-18.1</td>
<td align="right">-19.3</td>
<td align="right">-20.5</td>
</tr>
<tr class="even">
<td align="left">Budget2018_lamington_et_LITO</td>
<td align="right">-3.7</td>
<td align="right">-3.8</td>
<td align="right">-3.9</td>
<td align="right">-4.0</td>
<td align="right">-0.7</td>
<td align="right">-0.7</td>
<td align="right">-0.8</td>
<td align="right">-0.8</td>
<td align="right">-0.8</td>
<td align="right">-0.8</td>
</tr>
<tr class="odd">
<td align="left">Budget2018</td>
<td align="right">-4.1</td>
<td align="right">-4.2</td>
<td align="right">-4.4</td>
<td align="right">-4.5</td>
<td align="right">-10.0</td>
<td align="right">-10.5</td>
<td align="right">-17.4</td>
<td align="right">-18.5</td>
<td align="right">-19.7</td>
<td align="right">-21.0</td>
</tr>
<tr class="even">
<td align="left">Budget2018_Step1and2</td>
<td align="right">-4.1</td>
<td align="right">-4.2</td>
<td align="right">-4.4</td>
<td align="right">-4.5</td>
<td align="right">-10.0</td>
<td align="right">-10.5</td>
<td align="right">-11.0</td>
<td align="right">-11.5</td>
<td align="right">-12.1</td>
<td align="right">-12.6</td>
</tr>
<tr class="odd">
<td align="left">ALP2018</td>
<td align="right">-6.8</td>
<td align="right">-7.0</td>
<td align="right">-7.2</td>
<td align="right">-7.3</td>
<td align="right">-16.3</td>
<td align="right">-16.8</td>
<td align="right">-17.4</td>
<td align="right">-18.0</td>
<td align="right">-18.5</td>
<td align="right">-19.1</td>
</tr>
</tbody>
</table>
</div>
<div id="costings-2018-19-to-2027-28-grattan-default-forecasts" class="section level3">
<h3 class="hasAnchor">
<a href="#costings-2018-19-to-2027-28-grattan-default-forecasts" class="anchor"></a>Costings 2018-19 to 2027-28 (Grattan default forecasts)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">fread</span>(<span class="st">"revenue-by-fy_year-id--Grattan.csv"</span>))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Budget2018_baseline</td>
<td align="right">0.0</td>
<td align="right">-0.1</td>
<td align="right">-0.1</td>
<td align="right">-0.2</td>
<td align="right">-0.2</td>
<td align="right">-0.3</td>
<td align="right">-0.3</td>
<td align="right">-0.4</td>
<td align="right">-0.4</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">Baseline_brackets_cpi</td>
<td align="right">-2.2</td>
<td align="right">-4.4</td>
<td align="right">-6.6</td>
<td align="right">-8.9</td>
<td align="right">-11.3</td>
<td align="right">-13.9</td>
<td align="right">-16.5</td>
<td align="right">-19.3</td>
<td align="right">-22.2</td>
<td align="right">-25.2</td>
</tr>
<tr class="odd">
<td align="left">Budget2018_just_rates</td>
<td align="right">-0.4</td>
<td align="right">-0.5</td>
<td align="right">-0.6</td>
<td align="right">-0.6</td>
<td align="right">-9.1</td>
<td align="right">-9.6</td>
<td align="right">-15.4</td>
<td align="right">-16.2</td>
<td align="right">-17.0</td>
<td align="right">-17.8</td>
</tr>
<tr class="even">
<td align="left">Budget2018_lamington_et_LITO</td>
<td align="right">-3.7</td>
<td align="right">-3.9</td>
<td align="right">-4.0</td>
<td align="right">-4.1</td>
<td align="right">-0.8</td>
<td align="right">-0.8</td>
<td align="right">-0.9</td>
<td align="right">-0.9</td>
<td align="right">-1.0</td>
<td align="right">-1.0</td>
</tr>
<tr class="odd">
<td align="left">Budget2018</td>
<td align="right">-4.1</td>
<td align="right">-4.3</td>
<td align="right">-4.4</td>
<td align="right">-4.6</td>
<td align="right">-9.7</td>
<td align="right">-10.1</td>
<td align="right">-16.0</td>
<td align="right">-16.7</td>
<td align="right">-17.5</td>
<td align="right">-18.3</td>
</tr>
<tr class="even">
<td align="left">Budget2018_Step1and2</td>
<td align="right">-4.1</td>
<td align="right">-4.3</td>
<td align="right">-4.4</td>
<td align="right">-4.6</td>
<td align="right">-9.7</td>
<td align="right">-10.1</td>
<td align="right">-10.5</td>
<td align="right">-11.0</td>
<td align="right">-11.4</td>
<td align="right">-11.9</td>
</tr>
<tr class="odd">
<td align="left">ALP2018</td>
<td align="right">-6.8</td>
<td align="right">-7.1</td>
<td align="right">-7.3</td>
<td align="right">-7.5</td>
<td align="right">-16.2</td>
<td align="right">-16.7</td>
<td align="right">-17.3</td>
<td align="right">-17.8</td>
<td align="right">-18.4</td>
<td align="right">-19.0</td>
</tr>
</tbody>
</table>
<p><strong>80% wage optimistic</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">fread</span>(<span class="st">"revenue-by-fy_year-id--Grattan80.csv"</span>))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Budget2018_baseline</td>
<td align="right">0.0</td>
<td align="right">-0.1</td>
<td align="right">-0.1</td>
<td align="right">-0.2</td>
<td align="right">-0.2</td>
<td align="right">-0.3</td>
<td align="right">-0.3</td>
<td align="right">-0.4</td>
<td align="right">-0.4</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">Baseline_brackets_cpi</td>
<td align="right">-2.3</td>
<td align="right">-4.4</td>
<td align="right">-6.7</td>
<td align="right">-9.1</td>
<td align="right">-11.6</td>
<td align="right">-14.3</td>
<td align="right">-17.2</td>
<td align="right">-20.2</td>
<td align="right">-23.3</td>
<td align="right">-26.7</td>
</tr>
<tr class="odd">
<td align="left">Budget2018_just_rates</td>
<td align="right">-0.4</td>
<td align="right">-0.5</td>
<td align="right">-0.6</td>
<td align="right">-0.6</td>
<td align="right">-9.5</td>
<td align="right">-10.0</td>
<td align="right">-16.6</td>
<td align="right">-17.7</td>
<td align="right">-18.8</td>
<td align="right">-19.9</td>
</tr>
<tr class="even">
<td align="left">Budget2018_lamington_et_LITO</td>
<td align="right">-3.7</td>
<td align="right">-3.9</td>
<td align="right">-4.0</td>
<td align="right">-4.1</td>
<td align="right">-0.8</td>
<td align="right">-0.8</td>
<td align="right">-0.8</td>
<td align="right">-0.9</td>
<td align="right">-0.9</td>
<td align="right">-1.0</td>
</tr>
<tr class="odd">
<td align="left">Budget2018</td>
<td align="right">-4.1</td>
<td align="right">-4.3</td>
<td align="right">-4.4</td>
<td align="right">-4.6</td>
<td align="right">-10.0</td>
<td align="right">-10.5</td>
<td align="right">-17.1</td>
<td align="right">-18.2</td>
<td align="right">-19.3</td>
<td align="right">-20.4</td>
</tr>
<tr class="even">
<td align="left">Budget2018_Step1and2</td>
<td align="right">-4.1</td>
<td align="right">-4.3</td>
<td align="right">-4.4</td>
<td align="right">-4.6</td>
<td align="right">-10.0</td>
<td align="right">-10.5</td>
<td align="right">-11.1</td>
<td align="right">-11.6</td>
<td align="right">-12.2</td>
<td align="right">-12.7</td>
</tr>
<tr class="odd">
<td align="left">ALP2018</td>
<td align="right">-6.9</td>
<td align="right">-7.1</td>
<td align="right">-7.3</td>
<td align="right">-7.5</td>
<td align="right">-16.5</td>
<td align="right">-17.1</td>
<td align="right">-17.8</td>
<td align="right">-18.4</td>
<td align="right">-19.1</td>
<td align="right">-19.8</td>
</tr>
</tbody>
</table>
<p><strong>20% wage pessimistic</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">fread</span>(<span class="st">"revenue-by-fy_year-id--Grattan20.csv"</span>))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Budget2018_baseline</td>
<td align="right">0.0</td>
<td align="right">-0.1</td>
<td align="right">-0.1</td>
<td align="right">-0.2</td>
<td align="right">-0.2</td>
<td align="right">-0.3</td>
<td align="right">-0.3</td>
<td align="right">-0.4</td>
<td align="right">-0.5</td>
<td align="right">-0.5</td>
</tr>
<tr class="even">
<td align="left">Baseline_brackets_cpi</td>
<td align="right">-2.2</td>
<td align="right">-4.3</td>
<td align="right">-6.5</td>
<td align="right">-8.7</td>
<td align="right">-11.1</td>
<td align="right">-13.4</td>
<td align="right">-15.9</td>
<td align="right">-18.4</td>
<td align="right">-21.0</td>
<td align="right">-23.7</td>
</tr>
<tr class="odd">
<td align="left">Budget2018_just_rates</td>
<td align="right">-0.4</td>
<td align="right">-0.5</td>
<td align="right">-0.5</td>
<td align="right">-0.6</td>
<td align="right">-8.8</td>
<td align="right">-9.1</td>
<td align="right">-14.2</td>
<td align="right">-14.7</td>
<td align="right">-15.2</td>
<td align="right">-15.7</td>
</tr>
<tr class="even">
<td align="left">Budget2018_lamington_et_LITO</td>
<td align="right">-3.7</td>
<td align="right">-3.9</td>
<td align="right">-4.0</td>
<td align="right">-4.1</td>
<td align="right">-0.8</td>
<td align="right">-0.9</td>
<td align="right">-0.9</td>
<td align="right">-1.0</td>
<td align="right">-1.0</td>
<td align="right">-1.1</td>
</tr>
<tr class="odd">
<td align="left">Budget2018</td>
<td align="right">-4.1</td>
<td align="right">-4.3</td>
<td align="right">-4.4</td>
<td align="right">-4.6</td>
<td align="right">-9.4</td>
<td align="right">-9.7</td>
<td align="right">-14.8</td>
<td align="right">-15.3</td>
<td align="right">-15.8</td>
<td align="right">-16.3</td>
</tr>
<tr class="even">
<td align="left">Budget2018_Step1and2</td>
<td align="right">-4.1</td>
<td align="right">-4.3</td>
<td align="right">-4.4</td>
<td align="right">-4.6</td>
<td align="right">-9.4</td>
<td align="right">-9.7</td>
<td align="right">-10.0</td>
<td align="right">-10.3</td>
<td align="right">-10.6</td>
<td align="right">-10.9</td>
</tr>
<tr class="odd">
<td align="left">ALP2018</td>
<td align="right">-6.8</td>
<td align="right">-7.1</td>
<td align="right">-7.3</td>
<td align="right">-7.5</td>
<td align="right">-15.8</td>
<td align="right">-16.3</td>
<td align="right">-16.7</td>
<td align="right">-17.2</td>
<td align="right">-17.6</td>
<td align="right">-18.0</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_individual_impact_by_Quintile_fy &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Quintile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(<span class="kw">.ntile</span>(Taxable_Income, <span class="dv">5</span>), <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>),
    keyby =<span class="st"> </span>.(fy_year, id)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_delta =</span> <span class="kw">mean</span>(delta),
        <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
        <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
        <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
    keyby =<span class="st"> </span>.(id, fy_year, Quintile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_delta, <span class="dv">2</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_individual_impact_by_Quintile_fy.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[] 

avg_individual_impact_by_Quintile_fy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>,
             <span class="dt">y =</span> avg_delta,
             <span class="dt">fill =</span> Quintile),
         <span class="dt">reverse =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average individual impact"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">FALSE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.5</span>),
        <span class="dt">legend.position =</span> <span class="st">"right"</span>)</code></pre></div>
<p><img src="Budget2018-atlas/avg_individual_impact_by_Quintile_fy-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_individual_impact_by_Quintile_fy__<span class="fl">2.75</span> &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models_Grattan2.<span class="dv">75</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>),
    .(<span class="dt">avg_delta =</span> <span class="kw">mean</span>(delta),
      <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
      <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
      <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
    keyby =<span class="st"> </span>.(fy_year, id, Quintile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_delta, <span class="dv">2</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_individual_impact_by_Quintile_fy-2p75.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[] 

avg_individual_impact_by_Quintile_fy__<span class="fl">2.75</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>,
        avg_delta,
        <span class="dt">Quintile =</span> <span class="kw">factor</span>(Quintile))] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>,
             <span class="dt">y =</span> avg_delta,
             <span class="dt">fill =</span> Quintile),
         <span class="dt">reverse =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average individual impact (2.75% wages)"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">FALSE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.5</span>),
        <span class="dt">legend.position =</span> <span class="st">"right"</span>)</code></pre></div>
<p><img src="Budget2018-atlas/avg_individual_impact_by_Quintile_fy__2.75-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Brackets &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(unique_fy_year, <span class="st">"Budget2018"</span>), 
               .(<span class="dt">Breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">37e3</span>, <span class="fl">41e3</span>, <span class="fl">87e3</span>, <span class="fl">90e3</span>, <span class="fl">120e3</span>, <span class="fl">180e3</span>, <span class="fl">200e3</span>)),
               keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"id"</span>)]<span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(Breaks)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, id, Taxable_Income)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_individual_impact_by_Bracket_fy &lt;-
<span class="st">  </span><span class="co"># Match every taxable income with the correct bracket</span>
<span class="st">  </span>Brackets[<span class="kw">setkey</span>(bound_models[.(unique_fy_year, <span class="st">"Budget2018"</span>),
                               .(fy_year, id, Taxable_Income, delta)],
                  fy_year, id, Taxable_Income),
           roll=<span class="ot">TRUE</span>,
           nomatch=0L] <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span>.[, .(<span class="dt">avg_delta =</span> <span class="kw">mean</span>(delta)),
    keyby =<span class="st"> </span>.(fy_year, Breaks)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] 

avg_individual_impact_by_Bracket_fy <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_delta, <span class="dv">2</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Income bracket"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(Breaks,
                                 <span class="dt">levels =</span> <span class="kw">unique</span>(Breaks),
                                 <span class="dt">labels =</span> <span class="kw">grattan_dollar</span>(<span class="kw">unique</span>(Breaks)),
                                 <span class="dt">ordered =</span> <span class="ot">TRUE</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Total-revenue-vs-fy-by-income-bracket.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>, <span class="dt">y =</span> avg_delta, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">Income bracket</span><span class="st">`</span>),
         <span class="dt">reverse =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average individual impact"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)
<span class="co">#&gt; I'm going off-piste: The Palette Of Nine is thine. May John have mercy on your soul.</span></code></pre></div>
<p><img src="Budget2018-atlas/avg_individual_impact_by_Bracket_fy-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Brackets[<span class="kw">setkey</span>(bound_models[.(unique_fy_year, <span class="st">"Budget2018"</span>),
                             .(fy_year, id, Taxable_Income,
                               <span class="dt">total_delta =</span> delta <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)],
                fy_year, id, Taxable_Income),
           roll=<span class="ot">TRUE</span>,
           nomatch=0L] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total_delta =</span> <span class="kw">sum</span>(total_delta)),
    keyby =<span class="st"> </span>.(fy_year, Breaks)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, total_delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total_delta, <span class="dv">2</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">order</span>(<span class="op">-</span>Breaks)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Incomes above"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(Breaks,
                                <span class="dt">levels =</span> <span class="kw">unique</span>(Breaks),
                                <span class="dt">labels =</span> <span class="kw">grattan_dollar</span>(<span class="kw">unique</span>(Breaks)),
                                <span class="dt">ordered =</span> <span class="ot">TRUE</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Total-revenue-vs-fy-by-incomes-above.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>, <span class="dt">y =</span> total_delta, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">Incomes above</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Total revenue"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)
<span class="co">#&gt; I'm going off-piste: The Palette Of Nine is thine. May John have mercy on your soul.</span></code></pre></div>
<p><img src="Budget2018-atlas/Total-revenue-vs-fy-by-incomes-above-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cost_in_<span class="dv">202728</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>)], <span class="ot">FALSE</span>, <span class="dt">digits =</span> <span class="dv">0</span>)
cost_in_202728_top20 &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">80</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(<span class="dt">revenue_positive =</span> <span class="ot">FALSE</span>, <span class="dt">digits =</span> <span class="dv">0</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minIncome_by_decile &lt;-<span class="st"> </span>
<span class="st">  </span>s1718[, .(<span class="dt">minIncome =</span> <span class="kw">min</span>(Taxable_Income)), keyby =<span class="st"> </span>.(<span class="dt">Decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, minIncome <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">round</span>(minIncome, <span class="op">-</span><span class="dv">3</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy &lt;-
{
  <span class="kw">rbindlist</span>(
    <span class="kw">list</span>(
      <span class="st">"Budget2018"</span> =<span class="st"> </span>{
        bound_models <span class="op">%&gt;%</span>
<span class="st">          </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>),
            .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
              <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
              <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
              <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
              <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
              <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
            keyby =<span class="st"> </span>.(fy_year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "Budget 2018"</span>]
      },
      <span class="st">"Grattan 20%"</span> =<span class="st"> </span>{
        bound_models_Grattan20 <span class="op">%&gt;%</span>
<span class="st">          </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>),
            .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
              <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
              <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
              <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
              <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
              <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
            keyby =<span class="st"> </span>.(fy_year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "Budget 2018 (20% wage forecast)"</span>]
      },
      <span class="st">"Grattan 80%"</span> =<span class="st"> </span>{
        bound_models_Grattan80 <span class="op">%&gt;%</span>
<span class="st">          </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>),
            .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
              <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
              <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
              <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
              <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
              <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
            keyby =<span class="st"> </span>.(fy_year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "Budget 2018 (80% wage forecast)"</span>]
      },
      
      <span class="st">"Baseline"</span> =<span class="st"> </span>{
        bound_models[.(unique_fy_year, <span class="st">"Budget2018_baseline"</span>),
          .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
            <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
            <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
            <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
            <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
            <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
          keyby =<span class="st"> </span>.(fy_year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "Baseline"</span>] <span class="op">%&gt;%</span>
<span class="st">          </span>.[]
      },
      <span class="st">"Current"</span> =<span class="st"> </span>{
        s1718[,
              .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
                <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
                <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
                <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
                <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
                <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)), 
              keyby =<span class="st"> </span>.(Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "2017-18"</span>] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, fy_year <span class="op">:</span><span class="er">=</span><span class="st">  "2017-18"</span>]
      }),
      <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, 
    <span class="dt">idcol =</span> <span class="st">"id"</span>)
  } <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, id, Taxable_Income_percentile) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_tax_rate, <span class="dv">3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, total_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total_tax, <span class="dv">3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"total_tax"</span>, <span class="st">"total_tax_bn"</span>) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="dt">file =</span> <span class="st">"avg_tax_rates-by-facet-percentile.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(<span class="kw">c</span>(<span class="st">"2017-18"</span>, <span class="st">"2027-28"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[facet <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Baseline"</span>, <span class="st">"Budget 2018"</span>, <span class="st">"2017-18"</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span>{
    dot &lt;-<span class="st"> </span>.
    dot[, .(facet, fy_year, Taxable_Income_percentile, avg_tax_rate)] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">dcast.data.table</span>(Taxable_Income_percentile <span class="op">~</span><span class="st"> </span>facet <span class="op">+</span><span class="st"> </span>fy_year,
                       <span class="dt">value.var =</span> <span class="st">"avg_tax_rate"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">melt.data.table</span>(<span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">"Taxable_Income_percentile"</span>, <span class="st">"2017-18_2017-18"</span>)) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">setnames</span>(<span class="st">"2017-18_2017-18"</span>, <span class="st">"T201718"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span>value <span class="op">-</span><span class="st"> </span>T201718] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">fwrite</span>(<span class="st">"change-in-tax-rate-vs-201718-by-percentile.csv"</span>)
  } <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income_percentile, <span class="dt">n =</span> <span class="dv">10</span>), by =<span class="st"> "facet"</span>] <span class="op">%T&gt;%</span>
<span class="st">  </span>{
    dot &lt;-<span class="st"> </span>.
    dot <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">total_tax_bn =</span> <span class="kw">sum</span>(total_tax_bn)), keyby =<span class="st"> </span>.(facet, Decile)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, <span class="st">"% tax paid"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>total_tax_bn <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_tax_bn), keyby =<span class="st"> "facet"</span>] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, <span class="kw">lapply</span>(.SD, signif, <span class="dv">3</span>), keyby =<span class="st"> </span>.(facet, Decile)] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">fwrite</span>(<span class="st">"prop-tax-paid-by-facet-decile.csv"</span>)
  } <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_percentile, <span class="dt">y =</span> avg_tax_rate, <span class="dt">color =</span> facet)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Taxable income percentile"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),
        <span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.5</span>),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Budget2018-atlas/avg_tax_rates_by_percentile_Budget_202728_vs_201718-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(<span class="kw">c</span>(<span class="st">"2017-18"</span>, <span class="st">"2027-28"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[facet <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Baseline"</span>, <span class="st">"Budget 2018"</span>, <span class="st">"2017-18"</span>, 
                 <span class="st">"Budget 2018 (20% wage forecast)"</span>, 
                 <span class="st">"Budget 2018 (80% wage forecast)"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[avg_tax_rate <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, labeli <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">which.max</span>(avg_tax_rate <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.15</span>), keyby =<span class="st"> "facet"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, i <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">seq_len</span>(.N), keyby =<span class="st"> "facet"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[labeli <span class="op">==</span><span class="st"> </span>i, label <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(facet)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, label_color <span class="op">:</span><span class="er">=</span><span class="st"> "black"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[facet <span class="op">==</span><span class="st"> "2017-18"</span>, label_color <span class="op">:</span><span class="er">=</span><span class="st"> "white"</span>] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(facet, 
                      <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">"Baseline"</span>,
                                 <span class="st">"Budget 2018"</span>,
                                 <span class="st">"Budget 2018 (80% wage forecast)"</span>, 
                                 <span class="st">"Budget 2018 (20% wage forecast)"</span>,
                                 <span class="st">"2017-18"</span>), 
                      <span class="dt">ordered =</span> <span class="ot">TRUE</span>)
    ] <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_percentile,
             <span class="dt">y =</span> avg_tax_rate,
             <span class="dt">color =</span> facet)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="co"># geom_label_repel(data = dot, </span>
<span class="st">  </span><span class="co">#                  aes(label = label,</span>
<span class="st">  </span><span class="co">#                      fill = facet),</span>
<span class="st">  </span><span class="co">#                  color = "black",</span>
<span class="st">  </span><span class="co">#                  force = 2,</span>
<span class="st">  </span><span class="co">#                  na.rm = TRUE) +</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Taxable income percentile"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.95</span>, <span class="fl">0.05</span>),
        <span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.5</span>),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</code></pre></div>
<p><img src="Budget2018-atlas/avg_tax_rates_by_percentile_Budget_202728_vs_201718_with_PI-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decile2income &lt;-<span class="st"> </span><span class="cf">function</span>(d) {
  d &lt;-<span class="st"> </span><span class="kw">as.integer</span>(d)
  <span class="kw">grattan_dollar</span>(minIncome_by_decile[.(d)][[<span class="st">"minIncome"</span>]])
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">texNumD &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">texNum</span>(x, <span class="dt">dollar =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>New Grattan Institute analysis highlights that most of the revenue reductions from the Turnbull Government’s full Personal Income Tax Plan are the result of lower taxes on high-income earners. Once the three-stage plan – including removing the 37c bracket – is complete, <strong>$15.1~billion</strong> of the annual <strong>$21~billion cost</strong> of the plan will result from collecting less tax from the top 20% of income earners, who currently have a taxable income of $68,000 or more.</p>
<p>The PIT plan will do little to unwind bracket creep’s gradual reduction of the progressivity of the tax system. Even with the PIT plan, average tax rates are forecast to be higher for all taxpayers in 2027-28 – except for very high-income earners who are effectively shielded from bracket creep by the plan. A taxpayer who earns $117,000 today (more than 90% of other taxpayers) will pay an average tax rate of NA per cent in 2027-28, unchanged from today. In contrast, average tax rates for middle-income earners will continue to rise. The average tax rate for a taxpayer who earns $27,000-a-year today (more than 30% of other taxpayers) will increase 6 percentage points (from NA per cent to NA per cent ). As a result, the highest-income taxpayers will bear a lower share of the total tax burden.</p>
<p><strong>Costing and distributional analysis of PIT plan </strong></p>
<p>The 2018-19 budget shows the annual cost of the PIT Plan until 2022. The Treasurer has indicated the ten-year cost of the plan is $140 billion. Grattan’s analysis shows the annual costs of the plan until 2028. The Grattan costing takes into account all elements of the PIT plan.</p>
<p>Most of the revenue reductions until 2021-22 are a result of the Low and Middle Income Tax Offset (“the Lamington”). But once the plan is fully implemented in 2024-25, there are much bigger revenue reductions because the top of the 32.5 cent bracket increases first to $120,000 and then to $200,000 (removing the 37c bracket). In 2028, these bracket changes account for <span class="math inline">\(-\)</span>$20.5~billion of the <span class="math inline">\(-\)</span>$21~billion in lower revenue.</p>
<p>Once fully implemented, most of the reduction in revenue under the PIT is retained by the top 20% of income earners, with a taxable income of $87,000 or more. In 2028, the reduction in tax collected from this group will account for <strong>$15 billion</strong> of the $25 billion cost of the plan.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Quintile and financial year to tax cut</span>
Qfy2Cut &lt;-<span class="st"> </span><span class="cf">function</span>(Quintile, fy) {
  q &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">as.integer</span>(Quintile), <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
  <span class="kw">stopifnot</span>(<span class="kw">haskey</span>(avg_individual_impact_by_Quintile_fy), 
            <span class="kw">identical</span>(<span class="kw">key</span>(avg_individual_impact_by_Quintile_fy), 
                      <span class="kw">c</span>(<span class="st">"id"</span>, <span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)), 
            <span class="kw">length</span>(fy) <span class="op">==</span><span class="st"> </span>1L, 
            <span class="kw">length</span>(q) <span class="op">==</span><span class="st"> </span>1L)
  ans &lt;-<span class="st"> </span><span class="op">-</span><span class="dv">1</span><span class="op">*</span>avg_individual_impact_by_Quintile_fy[.(<span class="st">"Budget2018"</span>, fy, q), avg_delta]
  <span class="kw">grattan_dollar</span>(<span class="kw">round</span>(ans, <span class="op">-</span><span class="dv">2</span>))
}</code></pre></div>
<p>By 2024-25, the income tax cuts are much larger for high-income earners, both in absolute terms and as a proportion of income. Those in the top 20 per cent will get an average tax cut of $4,600 a year, compared to $400 a year for someone in the second income quintile ($9,000 - $19,000).</p>
<p><strong>Impact of the PIT plan on tax system progressivity</strong></p>
<p>Australia’s progressive tax system ensures that people with higher incomes pay higher average rates of personal income tax. Without changes to tax scales, bracket creep gradually increases average tax rates for all taxpayers. Middle-income earners are affected most in terms of higher average tax rates.</p>
<p>The government claims the PIT plan protects middle-income Australians from bracket creep. Certainly the plan reduces average tax rates in 2027-28 for all taxpayers compared to what they would be if there were no changes to rates or brackets over that period.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avgTaxRate50 &lt;-<span class="st"> </span><span class="cf">function</span>(idd, fy) {
  <span class="kw">stopifnot</span>(<span class="kw">identical</span>(<span class="kw">key</span>(avg_tax_rates_by_percentile_facet_fy), 
                      <span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"id"</span>, <span class="st">"Taxable_Income_percentile"</span>)),
            <span class="kw">length</span>(idd) <span class="op">==</span><span class="st"> </span>1L,
            <span class="kw">length</span>(fy) <span class="op">==</span><span class="st"> </span>1L, 
            <span class="st">"avg_tax_rate"</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(avg_tax_rates_by_percentile_facet_fy))
  avg_tax_rates_by_percentile_facet_fy[.(fy, idd, 50L), avg_tax_rate]
}</code></pre></div>
<p>But middle-income earners are not spared from bracket creep under the PIT plan. The average tax rate for a taxpayer at the 50<sup>th</sup> percentile will still increase by 5 percentage points (from 14.6% to 19.1% ) compared to 2017-18. Without further changes, average tax rates will be higher for most taxpayers.</p>
<p>The exception is the top 10% of income earners. Average tax rates for those on the highest incomes are virtually unchanged under this plan.</p>
<p>Once fully implemented, the PIT plan doesn’t change the progressivity of the tax system much. Overall, those on high incomes will pay a similar proportion of total tax revenues with or without the plan. But because of bracket creep, high income earners will be paying a lower proportion than today.</p>
<p><strong>Table 1: Share of personal income tax paid falls for highest income earners under PIT plan</strong></p>
<p>Share of total personal income tax paid by income decile (%)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">to_prop &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (<span class="kw">is.double</span>(x)) {
    <span class="kw">grattan_percent</span>(x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x), <span class="dt">.percent.suffix =</span> <span class="st">"%"</span>, <span class="dt">digits =</span> <span class="dv">1</span>)
  } <span class="cf">else</span> {
    x
  }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (<span class="st">"tax"</span> <span class="op">%notchin%</span><span class="st"> </span><span class="kw">names</span>(s1718)) {
  <span class="cf">if</span> (<span class="st">"new_tax"</span> <span class="op">%chin%</span><span class="st"> </span><span class="kw">names</span>(s1718)) {
    s1718[, tax <span class="op">:</span><span class="er">=</span><span class="st"> </span>new_tax <span class="op">+</span><span class="st"> </span><span class="dv">0</span>]
  } <span class="cf">else</span> {
    s1718[, tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="st">"2017-18"</span>, <span class="dt">.dots.ATO =</span> .SD)]
  }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ShareTaxPaid_by_Decile_id &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">list</span>(<span class="st">"2017-18"</span> =<span class="st"> </span><span class="kw">select_grep</span>(s1718, <span class="st">"^(new_)?tax$"</span>, <span class="dt">.and =</span> <span class="st">"Taxable_Income"</span>),
       <span class="st">"2027-28 baseline"</span> =<span class="st"> </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018_baseline"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)],
       <span class="st">"2027-28 budget"</span> =<span class="st"> </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018_baseline"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)]
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>,
            <span class="dt">idcol =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>), keyby =<span class="st"> "id"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(tax)), keyby =<span class="st"> </span>.(id, Decile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot), keyby =<span class="st"> "id"</span>]

ShareTaxPaid_by_Percentile_id &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">list</span>(<span class="st">"2017-18"</span> =<span class="st"> </span><span class="kw">select_grep</span>(s1718, <span class="st">"^(new_)?tax$"</span>, <span class="dt">.and =</span> <span class="st">"Taxable_Income"</span>),
       <span class="st">"2027-28 baseline"</span> =<span class="st"> </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018_baseline"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)],
       <span class="st">"2027-28 budget"</span> =<span class="st"> </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018_baseline"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)]
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>,
            <span class="dt">idcol =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>), keyby =<span class="st"> "id"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(tax)), keyby =<span class="st"> </span>.(id, Percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot), keyby =<span class="st"> "id"</span>]

<span class="kw">rbindlist</span>(
  <span class="kw">list</span>(ShareTaxPaid_by_Decile_id <span class="op">%&gt;%</span>
<span class="st">         </span>.[Decile <span class="op">!=</span><span class="st"> </span>10L] <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">dcast</span>(Decile <span class="op">~</span><span class="st"> </span>id, <span class="dt">value.var =</span> <span class="st">"share"</span>) <span class="op">%&gt;%</span>
<span class="st">         </span>.[, Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(Decile)], 
       ShareTaxPaid_by_Percentile_id <span class="op">%&gt;%</span>
<span class="st">         </span>.[Percentile <span class="op">&gt;</span><span class="st"> </span>90L] <span class="op">%&gt;%</span>
<span class="st">         </span>.[, .(<span class="dt">share =</span> <span class="kw">sum</span>(share)), 
           <span class="dt">by =</span> .(id, <span class="dt">Decile =</span> 10L <span class="op">*</span><span class="st"> </span>(Percentile <span class="op">%/%</span><span class="st"> </span>10L))] <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">dcast</span>(Decile <span class="op">~</span><span class="st"> </span>id, <span class="dt">value.var =</span> <span class="st">"share"</span>)),
  <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
  <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[Decile <span class="op">%enotin%</span><span class="st"> </span><span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(Decile <span class="op">==</span><span class="st"> </span><span class="dv">100</span>, <span class="st">"1%"</span>, <span class="st">"91-99 perc."</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="kw">lapply</span>(.SD, round, <span class="dv">3</span>), by =<span class="st"> "Decile"</span>] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"share-of-tot-income-tax-by-decile-top1pc-budget-wage-growth.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">"rrrr"</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Decile</th>
<th align="right">2017-18</th>
<th align="right">2027-28 baseline</th>
<th align="right">2027-28 budget</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.004</td>
<td align="right">0.008</td>
<td align="right">0.008</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.016</td>
<td align="right">0.023</td>
<td align="right">0.023</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.034</td>
<td align="right">0.043</td>
<td align="right">0.043</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.058</td>
<td align="right">0.063</td>
<td align="right">0.063</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.085</td>
<td align="right">0.087</td>
<td align="right">0.087</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.121</td>
<td align="right">0.122</td>
<td align="right">0.122</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.178</td>
<td align="right">0.179</td>
<td align="right">0.179</td>
</tr>
<tr class="even">
<td align="right">91-99 perc.</td>
<td align="right">0.329</td>
<td align="right">0.322</td>
<td align="right">0.322</td>
</tr>
<tr class="odd">
<td align="right">1%</td>
<td align="right">0.175</td>
<td align="right">0.153</td>
<td align="right">0.153</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ShareTaxPaid_by_Decile_id &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">list</span>(<span class="st">"2017-18"</span> =<span class="st"> </span>s1718[, .(Taxable_Income, tax)],
       <span class="st">"2027-28 baseline"</span> =<span class="st"> </span>bound_models_Grattan2.<span class="dv">75</span>[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018_baseline"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)],
       <span class="st">"2027-28 budget"</span> =<span class="st"> </span>bound_models_Grattan2.<span class="dv">75</span>[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)]
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>,
            <span class="dt">idcol =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>), keyby =<span class="st"> "id"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(tax)), keyby =<span class="st"> </span>.(id, Decile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot), keyby =<span class="st"> "id"</span>]

ShareTaxPaid_by_Percentile_id &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">list</span>(<span class="st">"2017-18"</span> =<span class="st"> </span>s1718[, .(Taxable_Income, tax)],
       <span class="st">"2027-28 baseline"</span> =<span class="st"> </span>bound_models_Grattan2.<span class="dv">75</span>[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018_baseline"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)],
       <span class="st">"2027-28 budget"</span> =<span class="st"> </span>bound_models_Grattan2.<span class="dv">75</span>[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>), .(Taxable_Income, <span class="dt">tax =</span> new_tax)]
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>,
            <span class="dt">idcol =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>), keyby =<span class="st"> "id"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(tax)), keyby =<span class="st"> </span>.(id, Percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot), keyby =<span class="st"> "id"</span>]

<span class="kw">rbindlist</span>(
  <span class="kw">list</span>(ShareTaxPaid_by_Decile_id <span class="op">%&gt;%</span>
<span class="st">         </span>.[Decile <span class="op">!=</span><span class="st"> </span>10L] <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">dcast</span>(Decile <span class="op">~</span><span class="st"> </span>id, <span class="dt">value.var =</span> <span class="st">"share"</span>) <span class="op">%&gt;%</span>
<span class="st">         </span>.[, Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.character</span>(Decile)], 
       ShareTaxPaid_by_Percentile_id <span class="op">%&gt;%</span>
<span class="st">         </span>.[Percentile <span class="op">&gt;</span><span class="st"> </span>90L] <span class="op">%&gt;%</span>
<span class="st">         </span>.[, .(<span class="dt">share =</span> <span class="kw">sum</span>(share)), 
           <span class="dt">by =</span> .(id, <span class="dt">Decile =</span> 10L <span class="op">*</span><span class="st"> </span>(Percentile <span class="op">%/%</span><span class="st"> </span>10L))] <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">dcast</span>(Decile <span class="op">~</span><span class="st"> </span>id, <span class="dt">value.var =</span> <span class="st">"share"</span>)),
  <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
  <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[Decile <span class="op">%enotin%</span><span class="st"> </span><span class="kw">as.character</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>), Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(Decile <span class="op">==</span><span class="st"> </span><span class="dv">100</span>, <span class="st">"1%"</span>, <span class="st">"91-99 perc."</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="kw">lapply</span>(.SD, round, <span class="dv">3</span>), by =<span class="st"> "Decile"</span>] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"share-of-tot-income-tax-by-decile-top1pc-2-75-wage-growth.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">"rrrr"</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Decile</th>
<th align="right">2017-18</th>
<th align="right">2027-28 baseline</th>
<th align="right">2027-28 budget</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.004</td>
<td align="right">0.008</td>
<td align="right">0.007</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">0.016</td>
<td align="right">0.022</td>
<td align="right">0.021</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">0.034</td>
<td align="right">0.042</td>
<td align="right">0.042</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">0.058</td>
<td align="right">0.062</td>
<td align="right">0.063</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">0.085</td>
<td align="right">0.086</td>
<td align="right">0.089</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">0.121</td>
<td align="right">0.121</td>
<td align="right">0.123</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">0.178</td>
<td align="right">0.178</td>
<td align="right">0.177</td>
</tr>
<tr class="even">
<td align="right">91-99 perc.</td>
<td align="right">0.329</td>
<td align="right">0.323</td>
<td align="right">0.315</td>
</tr>
<tr class="odd">
<td align="right">1%</td>
<td align="right">0.175</td>
<td align="right">0.158</td>
<td align="right">0.163</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot_tax =</span> <span class="kw">sum</span>(total_tax_bn)),
    keyby =<span class="st"> </span>.(id, fy_year, <span class="dt">Decile =</span> <span class="kw">ntile</span>(Taxable_Income_percentile, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2017-18"</span>, <span class="st">"2027-28"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast.data.table</span>(Decile <span class="op">~</span><span class="st"> </span>id <span class="op">+</span><span class="st"> </span>fy_year, <span class="dt">value.var =</span> <span class="st">"tot_tax"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="kw">lapply</span>(.SD, to_prop)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"share-total-personal-income-tax-per-decile.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">"rrrr"</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Decile</th>
<th align="right">Baseline_2027-28</th>
<th align="right">Budget2018_2027-28</th>
<th align="right">Current_2017-18</th>
<th align="right">Grattan 20%_2027-28</th>
<th align="right">Grattan 80%_2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
<td align="right">0.0%</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.8%</td>
<td align="right">0.8%</td>
<td align="right">0.4%</td>
<td align="right">0.4%</td>
<td align="right">0.7%</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2.3%</td>
<td align="right">2.3%</td>
<td align="right">1.6%</td>
<td align="right">1.7%</td>
<td align="right">2.1%</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">4.3%</td>
<td align="right">4.3%</td>
<td align="right">3.4%</td>
<td align="right">3.5%</td>
<td align="right">4.1%</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">6.3%</td>
<td align="right">6.4%</td>
<td align="right">5.8%</td>
<td align="right">5.8%</td>
<td align="right">6.3%</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">8.7%</td>
<td align="right">8.9%</td>
<td align="right">8.5%</td>
<td align="right">8.6%</td>
<td align="right">8.9%</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">12.2%</td>
<td align="right">12.3%</td>
<td align="right">12.1%</td>
<td align="right">12.1%</td>
<td align="right">12.3%</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">17.9%</td>
<td align="right">17.7%</td>
<td align="right">17.8%</td>
<td align="right">17.6%</td>
<td align="right">17.7%</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">47.5%</td>
<td align="right">47.3%</td>
<td align="right">50.4%</td>
<td align="right">50.2%</td>
<td align="right">48.0%</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  (x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))
}
scale10 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">scale01</span>(x)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Grey &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  Alpha &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">scale10</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy))
  out &lt;-<span class="st"> </span><span class="kw">grey</span>(<span class="kw">rep_len</span>(<span class="dv">1</span>, <span class="kw">length</span>(fy)))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(fy)) {
    out[i] &lt;-<span class="st"> </span><span class="kw">grey</span>(<span class="fl">0.7</span>, <span class="dt">alpha =</span> Alpha[i])
  }
  out
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(avg_tax_rate)),
    keyby =<span class="st"> </span>.(fy.year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"fy.year"</span>, <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(avg_tax_rates_by_percentile_facet_fy[<span class="kw">CJ</span>(<span class="kw">unique</span>(fy_year),
                                               <span class="kw">c</span>(<span class="st">"Baseline"</span>, <span class="st">"Budget2018"</span>, <span class="st">"Current"</span>)),
                                             .SD, 
                                             <span class="dt">.SDcols =</span> <span class="kw">c</span>(<span class="st">"id"</span>, <span class="kw">names</span>(.)),
                                             <span class="dt">nomatch=</span>0L],
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, Taxable_Income_percentile) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, z <span class="op">:</span><span class="er">=</span><span class="st"> </span>fy_year <span class="op">%ein%</span><span class="st"> "2017-18"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate_rel <span class="op">:</span><span class="er">=</span><span class="st"> </span>avg_tax_rate <span class="op">-</span><span class="st"> </span><span class="kw">median</span>(avg_tax_rate[z]),
    keyby =<span class="st"> </span>.(Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, is_max_hist <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">and</span>(fy_year <span class="op">&lt;</span><span class="st"> "2017-18"</span>,
                         avg_tax_rate_rel <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(avg_tax_rate_rel[fy_year <span class="op">&lt;</span><span class="st"> "2017-18"</span>]))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, is_min_hist <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">and</span>(fy_year <span class="op">&lt;</span><span class="st"> "2017-18"</span>,
                         avg_tax_rate_rel <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(avg_tax_rate_rel[fy_year <span class="op">&lt;</span><span class="st"> "2017-18"</span>]))] <span class="op">%T&gt;%</span>
<span class="st">  </span>.[, <span class="kw">stopifnot</span>(Taxable_Income_percentile[is_max_hist] <span class="op">&lt;</span><span class="st"> </span>30L,
                fy_year[is_max_hist] <span class="op">==</span><span class="st"> "2004-05"</span>,
                avg_tax_rate_rel[is_max_hist] <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">0.06</span>, <span class="fl">0.07</span>),
                
                Taxable_Income_percentile[is_min_hist] <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">45</span>, <span class="dv">55</span>),
                avg_tax_rate_rel[is_min_hist] <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.05</span>, <span class="op">-</span><span class="fl">0.04</span>),
                fy_year[is_min_hist] <span class="op">==</span><span class="st"> "2009-10"</span>)] <span class="op">%&gt;%</span>

<span class="st">  </span>.[, colour <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id),
                        <span class="kw">grey</span>(<span class="fl">0.5</span>), 
                        <span class="kw">if_else</span>(id <span class="op">==</span><span class="st"> "Baseline"</span> <span class="op">&amp;</span><span class="st"> </span>fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), 
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">4</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">5</span>]),
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">1</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">2</span>])))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, alpha <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id), <span class="fl">1.05</span> <span class="op">*</span><span class="st"> </span><span class="kw">scale01</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)), <span class="dv">1</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2004-05"</span>, <span class="st">"2009-10"</span>), <span class="kw">c</span>(<span class="st">"alpha"</span>, <span class="st">"colour"</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(<span class="fl">0.8</span>, <span class="st">"black"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">implies</span>(<span class="op">!</span><span class="kw">is.na</span>(id), fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">0.8</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2004-05"</span>, <span class="st">"2009-10"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.4</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[Taxable_Income_percentile <span class="op">==</span><span class="st"> </span>50L <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(id),
    label <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(id, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="kw">as.character</span>(fy_year))] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># .[Taxable_Income_percentile == 95L &amp; !is.na(id), label := ""] %&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, group <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, colour)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, text <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, <span class="st">" "</span>, <span class="kw">coalesce</span>(id, <span class="st">""</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Percentile: "</span>, <span class="dt">width =</span> <span class="dv">24</span>), Taxable_Income_percentile, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Avg. tax rate (17-18 = 0):"</span>, <span class="dt">width =</span> <span class="dv">24</span>),
                     <span class="st">" "</span>,
                     <span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(avg_tax_rate_rel, <span class="dv">4</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"Taxable_Income_percentile"</span>, 
           <span class="st">"Taxable income percentile"</span>) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Average-tax-rates-relative-201718-vs-Taxable-income-percentile-by-FY.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.frame <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># .[Over65==FALSE] %&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Taxable income percentile</span><span class="st">`</span>,
             <span class="dt">y =</span> avg_tax_rate_rel,
             <span class="dt">colour =</span> colour,
             <span class="dt">group =</span> group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">"label"</span>,
           <span class="dt">x =</span> <span class="dv">20</span>,
           <span class="dt">y =</span> <span class="fl">0.07</span>, 
           <span class="dt">hjust =</span> <span class="dv">1</span>,
           <span class="dt">label.size =</span> <span class="ot">NA</span>,
           <span class="dt">label =</span> <span class="st">"2004-05"</span>,
           <span class="dt">fontface =</span> <span class="st">"bold"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">"label"</span>,
           <span class="dt">x =</span> <span class="dv">45</span>,
           <span class="dt">y =</span> <span class="op">-</span><span class="fl">0.04</span>,
           <span class="dt">hjust =</span> <span class="dv">1</span>,
           <span class="dt">label.size =</span> <span class="ot">NA</span>,
           <span class="dt">label =</span> <span class="st">"2009-10"</span>,
           <span class="dt">fontface =</span> <span class="st">"bold"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_alpha_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> alpha, <span class="dt">size =</span> size)) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_blank(aes(x = 105, y = 0)) +</span>
<span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label),
                   <span class="dt">nudge_x =</span> <span class="dv">2</span>, <span class="dt">force =</span> <span class="fl">0.8</span>,
                   <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,
                   <span class="dt">fontface =</span> <span class="st">"bold"</span>,
                   <span class="dt">label.size =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average tax rates relative to 2017-18"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour', which will replace the existing</span>
<span class="co">#&gt; scale.</span></code></pre></div>
<p><img src="Budget2018-atlas/Average-tax-rates-relative-201718-vs-Taxable-income-percentile-by-FY-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(avg_tax_rate)), keyby =<span class="st"> </span>.(fy.year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"fy.year"</span>, <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(avg_tax_rates_by_percentile_facet_fy[, .SD, <span class="dt">.SDcols =</span> <span class="kw">c</span>(<span class="st">"id"</span>, <span class="kw">names</span>(.))],
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, Taxable_Income_percentile) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate_rel <span class="op">:</span><span class="er">=</span><span class="st"> </span>avg_tax_rate <span class="op">-</span><span class="st"> </span><span class="kw">first</span>(avg_tax_rate),
    keyby =<span class="st"> </span>.(Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, colour <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id),
                        <span class="kw">grey</span>(<span class="fl">0.5</span>), 
                        <span class="kw">if_else</span>(id <span class="op">==</span><span class="st"> "Baseline"</span> <span class="op">&amp;</span><span class="st"> </span>fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), 
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">4</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">5</span>]),
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">1</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">2</span>])))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, alpha <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id), <span class="fl">1.05</span> <span class="op">*</span><span class="st"> </span><span class="kw">scale01</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)), <span class="dv">1</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># .[fy_year %in% c("2013-14"), c("alpha", "colour") := list(0.8, "black")] %&gt;%</span>
<span class="st">  </span>.[<span class="kw">implies</span>(<span class="op">!</span><span class="kw">is.na</span>(id), fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2017-18"</span>, <span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">0.8</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2004-05"</span>, <span class="st">"2013-14"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.4</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[Taxable_Income_percentile <span class="op">==</span><span class="st"> </span>50L <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(id), label <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(id, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="kw">as.character</span>(fy_year))] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># .[Taxable_Income_percentile == 95L &amp; !is.na(id), label := ""] %&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, group <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, colour)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, text <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, <span class="st">" "</span>, <span class="kw">coalesce</span>(id, <span class="st">""</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Percentile: "</span>, <span class="dt">width =</span> <span class="dv">24</span>), Taxable_Income_percentile, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Avg. tax rate (03-04 = 0):"</span>, <span class="dt">width =</span> <span class="dv">24</span>), <span class="st">" "</span>, <span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(avg_tax_rate_rel, <span class="dv">4</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"Taxable_Income_percentile"</span>, 
           <span class="st">"Taxable income percentile"</span>) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Average-tax-rates-relative-200304-vs-Taxable-income-percentile-by-FY.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.frame <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># .[Over65==FALSE] %&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Taxable income percentile</span><span class="st">`</span>,
             <span class="dt">y =</span> avg_tax_rate_rel,
             <span class="dt">colour =</span> colour,
             <span class="dt">group =</span> group,
             <span class="dt">text =</span> text)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_alpha_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> size)) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_blank(aes(x = 105, y = 0)) +</span>
<span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label),
                   <span class="dt">nudge_x =</span> <span class="dv">2</span>, <span class="dt">force =</span> <span class="fl">0.8</span>,
                   <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,
                   <span class="dt">fontface =</span> <span class="st">"bold"</span>,
                   <span class="dt">label.size =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average tax rates relative to 2003-04"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>fy_year)
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour', which will replace the existing</span>
<span class="co">#&gt; scale.</span></code></pre></div>
<p><img src="Budget2018-atlas/avg_tax_rate_by_percentile_fy_year_rel0304-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(<span class="st">"2019-20"</span>, <span class="st">"ALP2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, tax_saving <span class="op">:</span><span class="er">=</span><span class="st"> </span>baseline_tax <span class="op">-</span><span class="st"> </span>new_tax] <span class="op">%&gt;%</span>
<span class="st">  </span>.[Taxable_Income <span class="op">&lt;=</span><span class="st"> </span><span class="fl">300e3</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[age_range <span class="op">&gt;</span><span class="st"> </span>1L] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tax_saving =</span> <span class="kw">mean</span>(tax_saving)),
    keyby =<span class="st"> </span>.(fy_year, <span class="dt">Taxable_Income =</span> <span class="kw">round</span>(Taxable_Income, <span class="op">-</span><span class="dv">3</span>))] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"ALP-proposal-201920-vs-taxable-income.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[Taxable_Income <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">225e3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income, <span class="dt">y =</span> tax_saving, <span class="dt">color =</span> fy_year)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">"Taxable income"</span>, <span class="dt">labels =</span> grattan_dollar, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">225e3</span>)) </code></pre></div>
<p><img src="Budget2018-atlas/ALP-proposal-201920-vs-taxable-income-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list</span>(
  {
    sample_files_all <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> fy.year, Taxable_Income, <span class="dt">new_tax =</span> tax)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[]
  },
  s1617[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2016-17"</span>, Taxable_Income, new_tax)],
  s1718[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2017-18"</span>, Taxable_Income, new_tax)],
  bound_models[<span class="kw">CJ</span>(unique_fy_year, <span class="kw">c</span>(<span class="st">"Budget2018"</span>, <span class="st">"Budget2018_baseline"</span>, <span class="st">"ALP2018"</span>)),
               .(id, fy_year, Taxable_Income, new_tax)]
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>)  <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">progressivity =</span> <span class="kw"><a href="../../reference/progressivity.html">progressivity</a></span>(Taxable_Income, new_tax)), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"id"</span>, <span class="st">"fy_year"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Budget2018"</span>, <span class="st">"Current"</span>, <span class="st">"Budget2018_baseline"</span>, <span class="st">"ALP2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Year <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">==</span><span class="st"> "Budget2018_baseline"</span>, id <span class="op">:</span><span class="er">=</span><span class="st"> "Baseline"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, progressivity <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(progressivity, <span class="dv">4</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Reynolds-Smolensky-vs-year.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> progressivity, <span class="dt">color =</span> id, <span class="dt">group =</span> id)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">2005</span>, <span class="dv">2010</span>, <span class="dv">2015</span>, <span class="dv">2020</span>, <span class="dv">2025</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>,
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="Budget2018-atlas/progressivities-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">progressivity_<span class="dv">80</span> &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models_Grattan80 <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">progressivity =</span> <span class="kw"><a href="../../reference/progressivity.html">progressivity</a></span>(Taxable_Income, new_tax)), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">progressivity_<span class="dv">20</span> &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models_Grattan20 <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">progressivity =</span> <span class="kw"><a href="../../reference/progressivity.html">progressivity</a></span>(Taxable_Income, new_tax)), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">progressivity2.<span class="dv">75</span> &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models_Grattan2.<span class="dv">75</span> <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>),
    .(<span class="dt">progressivity =</span> <span class="kw"><a href="../../reference/progressivity.html">progressivity</a></span>(Taxable_Income, new_tax)),
    keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, id <span class="op">:</span><span class="er">=</span><span class="st"> "Wages @ 2.75%"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rbindlist</span>(<span class="kw">list</span>(progressivity2.<span class="dv">75</span>,
               <span class="kw">fread</span>(<span class="st">"Reynolds-Smolensky-vs-year.csv"</span>)), 
          <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
          <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Current"</span>, <span class="st">"Baseline"</span>), id <span class="op">:</span><span class="er">=</span><span class="st"> "Current/Baseline"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setorder</span>(<span class="op">-</span>fy_year, <span class="op">-</span>progressivity) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, id <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(id, <span class="dt">levels =</span> <span class="kw">unique</span>(id), <span class="dt">ordered =</span> <span class="ot">TRUE</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Year <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(Year, <span class="kw">as.integer</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year))), keyby =<span class="st"> "fy_year"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> progressivity,
             <span class="dt">color =</span> id, 
             <span class="dt">group =</span> id)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>,
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="Budget2018-atlas/progressivity2-75-plot-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy_historical &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">list</span>(
  {
    sample_files_all <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">fy_year =</span> fy.year, Taxable_Income, Taxable_Income_percentile, <span class="dt">new_tax =</span> tax)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, id <span class="op">:</span><span class="er">=</span><span class="st"> "Current"</span>] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">set_cols_first</span>(<span class="st">"id"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>.[]
  },
  s1718[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2017-18"</span>, Taxable_Income, Taxable_Income_percentile, new_tax)],
  s1617[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2016-17"</span>, Taxable_Income, Taxable_Income_percentile, new_tax)],
  bound_models[, .(id, fy_year, Taxable_Income, Taxable_Income_percentile, new_tax)]
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, new_avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">new_avg_tax_rate =</span> <span class="kw">mean</span>(new_avg_tax_rate)), 
    keyby =<span class="st"> </span>.(fy_year, id, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">implies</span>(id <span class="op">%pin%</span><span class="st"> "_"</span>, <span class="kw">endsWith</span>(id, <span class="st">"baseline"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">%pin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"aseline"</span>, <span class="st">"urrent"</span>), id <span class="op">:</span><span class="er">=</span><span class="st"> "Baseline/Current"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">order</span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast</span>(fy_year <span class="op">+</span><span class="st"> </span>id <span class="op">~</span><span class="st"> </span>Taxable_Income_percentile, <span class="dt">value.var =</span> <span class="st">"new_avg_tax_rate"</span>, <span class="dt">FUN =</span> identity) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg-tax-rate-wide-by-model-fy_year.tsv"</span>, <span class="dt">quote =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s202728_in_<span class="dv">1920</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1819,
                   <span class="st">"2017-18"</span>, 
                   <span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="dv">10</span>), 
                   <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="dv">10</span>),
                   <span class="dt">Budget2018_lamington =</span> <span class="ot">TRUE</span>,
                   <span class="dt">Budget2018_lito_202223 =</span> <span class="ot">TRUE</span>)
alternative &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1819, 
                   <span class="st">"2017-18"</span>, 
                   <span class="dt">ordinary_tax_rates =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span>, <span class="fl">0.325</span>, <span class="fl">0.37</span>, <span class="fl">0.45</span>), 
                   <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="dv">37000</span>, <span class="dv">90000</span>, <span class="dv">180000</span>))

r1 &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="cf">while</span> (r1 <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(alternative) <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(s202728_in_<span class="dv">1920</span>)) {
  <span class="kw">print</span>(<span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(alternative))
  r1 &lt;-<span class="st"> </span>r1 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
  alternative &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1819, 
                     <span class="st">"2017-18"</span>, 
                     <span class="dt">ordinary_tax_rates =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span> <span class="op">-</span><span class="st"> </span>r1<span class="op">/</span><span class="dv">200</span>, <span class="fl">0.325</span> <span class="op">-</span><span class="st"> </span>r1<span class="op">/</span><span class="dv">200</span>, <span class="fl">0.37</span>, <span class="fl">0.45</span>), 
                     <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="dv">37000</span>, <span class="dv">90000</span>, <span class="dv">180000</span>))
}
<span class="co">#&gt; [1] "-\\$375 million"</span>
<span class="co">#&gt; [1] "-\\$2.7 billion"</span>

alternative <span class="op">%&gt;%</span>
<span class="st">  </span>.[, new_avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, old_avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(baseline_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span>new_tax <span class="op">-</span><span class="st"> </span>baseline_tax] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">old_avg_tax_rate =</span> <span class="kw">mean</span>(old_avg_tax_rate),
        <span class="dt">new_avg_tax_rate =</span> <span class="kw">mean</span>(new_avg_tax_rate),
        <span class="dt">avg_delta =</span> <span class="kw">mean</span>(delta)),
    keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">"Taxable_Income_percentile"</span>, <span class="st">"avg_delta"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, variable <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(variable, <span class="dt">levels =</span> <span class="kw">unique</span>(.<span class="op">$</span>variable), <span class="dt">ordered =</span> <span class="ot">TRUE</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_percentile, <span class="dt">y =</span> value, <span class="dt">color =</span> variable)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="Budget2018-atlas/s202728_in_1920-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
baseline_share &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018_baseline"</span>),
               .(<span class="dt">total_delta =</span> <span class="kw">sum</span>(delta)),
               keyby =<span class="st"> </span>.(Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>total_delta <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_delta)] 

govt_share &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>),
   .(<span class="dt">total_delta =</span> <span class="kw">sum</span>(delta)),
   keyby =<span class="st"> </span>.(<span class="dt">Decile =</span> <span class="kw">.ntile</span>(Taxable_Income_percentile, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>total_delta <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_delta)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"prop-share-tax-benefit-govt-by-decile.csv"</span>)

alternative_share &lt;-<span class="st"> </span>
<span class="st">  </span>alternative <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total_delta =</span> <span class="kw">sum</span>(delta)), keyby =<span class="st"> </span>.(<span class="dt">Decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>total_delta <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_delta)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"prop-share-tax-benefit-alternative-by-decile.csv"</span>)

alternative <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">old_tot_tax_paid =</span> <span class="kw">sum</span>(baseline_tax <span class="op">*</span><span class="st"> </span>WEIGHT), 
        <span class="dt">new_tot_tax_paid =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT)), 
    keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt.data.table</span>(<span class="dt">id.vars =</span> <span class="kw">key</span>(.)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_decile, <span class="dt">y =</span> value, <span class="dt">fill =</span> variable)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">paste0</span>(<span class="kw">grattan_dollar</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>), <span class="st">" bn"</span>))</code></pre></div>
<p><img src="Budget2018-atlas/s202728_in_1920-2.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models <span class="op">%&gt;%</span>
<span class="st">  </span>.[.(unique_fy_year, <span class="st">"Budget2018"</span>),  
    .(<span class="dt">total_delta_bn =</span> <span class="kw">sum</span>((new_tax <span class="op">-</span><span class="st"> </span>baseline_tax) <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>), 
      <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
      <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income), 
      <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income)), 
    keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(.BY[[<span class="dv">1</span>]]), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, total_delta_bn <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total_delta_bn, <span class="dv">2</span>), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_income <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_income, <span class="dv">2</span>), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setorder</span>(fy_year, <span class="op">-</span>Quintile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"budget2018-total-revenue-vs-fy-by-quintile.csv"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(bound_models[.(<span class="st">"2018-19"</span>, <span class="st">"Baseline_brackets_cpi"</span>)]))
<span class="co">#&gt; [1] "-\\$2.2 billion"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rate_by_percentile_brackets_cpi &lt;-
<span class="st">  </span>bound_models[.(unique_fy_year, <span class="st">"Baseline_brackets_cpi"</span>),
               .(fy_year, Taxable_Income, new_tax, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(avg_tax_rate)), 
    keyby =<span class="st"> </span>.(fy_year, Taxable_Income_percentile)]
<span class="kw">fwrite</span>(avg_tax_rate_by_percentile_brackets_cpi,
       <span class="st">"avg_tax_rate_by_percentile_brackets_cpi.csv"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">total_population_<span class="dv">1516</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/aus_pop_qtr_age.html">aus_pop_qtr_age</a></span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(<span class="st">"2016-01-01"</span>),
                  <span class="dt">age =</span> <span class="dv">15</span><span class="op">:</span><span class="dv">100</span>,
                  <span class="dt">tbl =</span> <span class="ot">TRUE</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(Value) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">multiply_by</span>(s1718[<span class="dv">1</span>][[<span class="st">"WEIGHT"</span>]] <span class="op">/</span><span class="st"> </span><span class="dv">50</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxable_individuals_<span class="dv">1718</span> &lt;-<span class="st"> </span>s1718[, <span class="kw">sum</span>(WEIGHT)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_decile_allpersons201718 &lt;-<span class="st"> </span>
<span class="st">  </span>s1718[, .(new_tax, <span class="dt">baseline_tax =</span> <span class="kw">as.double</span>(baseline_tax), Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(new_tax), 
        <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
        <span class="dt">tot_adults =</span> <span class="kw">sum</span>(WEIGHT)), keyby =<span class="st"> "Taxable_Income_decile"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total), <span class="dv">3</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_decile_allpersons201718.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wt_rel1718v202425 &lt;-<span class="st"> </span>s2425_Treasury[, <span class="kw">first</span>(WEIGHT)] <span class="op">/</span><span class="st"> </span>s1718[, <span class="kw">first</span>(WEIGHT)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wt_rel1718v202728 &lt;-<span class="st"> </span>s2728_Treasury[, <span class="kw">first</span>(WEIGHT)] <span class="op">/</span><span class="st"> </span>s1718[, <span class="kw">first</span>(WEIGHT)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_decile_allpersons202425 &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>),
               .(new_tax, baseline_tax, Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202425 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(new_tax), 
        <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
        <span class="dt">tot_adults =</span> <span class="kw">sum</span>(WEIGHT)),
    keyby =<span class="st"> "Taxable_Income_decile"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total), <span class="dv">3</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_decile_allpersons202425.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_decile_allpersons202728 &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>),
                .(new_tax, baseline_tax, Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202728 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(new_tax), 
        <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
        <span class="dt">tot_adults =</span> <span class="kw">sum</span>(WEIGHT)), keyby =<span class="st"> "Taxable_Income_decile"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total), <span class="dv">3</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_decile_allpersons202728.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_quintile_allpersons201718 &lt;-<span class="st"> </span>
<span class="st">  </span>avg_tax_by_decile_allpersons201718 <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(total)), keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> <span class="kw">ceiling</span>(Taxable_Income_decile <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span>total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_quintile_allpersons201718.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_quintile_allpersons202425 &lt;-<span class="st"> </span>
<span class="st">  </span>avg_tax_by_decile_allpersons202425 <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(total)), keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> <span class="kw">ceiling</span>(Taxable_Income_decile <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span>total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_quintile_allpersons202425.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decile201718 &lt;-<span class="st"> </span>
<span class="st">  </span>s1718[, .(new_tax, <span class="dt">baseline_tax =</span> <span class="kw">as.double</span>(baseline_tax), Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>sample_files_all[.(<span class="st">"2015-16"</span>), <span class="kw">sum</span>(WEIGHT)]), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">Taxable_Income =</span> <span class="kw">min</span>(Taxable_Income),
        <span class="dt">tot =</span> <span class="kw">sum</span>(baseline_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)),
    keyby =<span class="st"> </span>.(Taxable_Income_decile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, min_Taxable_Income <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(Taxable_Income, <span class="op">-</span><span class="dv">3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models[.(<span class="st">"2024-25"</span>, <span class="st">"Budget2018"</span>),
              .(new_tax, baseline_tax, Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202728 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">  </span>decile201718[., roll =<span class="st"> </span><span class="ot">TRUE</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)), keyby =<span class="st"> </span>.(Taxable_Income_decile, min_Taxable_Income)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">Decile =</span> Taxable_Income_decile, 
        <span class="st">`</span><span class="dt">Min income</span><span class="st">`</span> =<span class="st"> </span><span class="kw">grattan_dollar</span>(min_Taxable_Income),
        <span class="st">`</span><span class="dt">Tax paid ($bn)</span><span class="st">`</span> =<span class="st"> </span>tot,
        <span class="st">`</span><span class="dt">% paid</span><span class="st">`</span> =<span class="st"> </span>prop)] <span class="op">%&gt;%</span>
<span class="st">  </span>kable</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Decile</th>
<th align="left">Min income</th>
<th align="right">Tax paid ($bn)</th>
<th align="right">% paid</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">$0</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">$0</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">$11,000</td>
<td align="right">0.0442389</td>
<td align="right">0.0001509</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">$24,000</td>
<td align="right">3.5035860</td>
<td align="right">0.0119476</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">$37,000</td>
<td align="right">10.6512998</td>
<td align="right">0.0363220</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">$50,000</td>
<td align="right">25.3818279</td>
<td align="right">0.0865546</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">$68,000</td>
<td align="right">48.0562017</td>
<td align="right">0.1638765</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">$98,000</td>
<td align="right">205.6092365</td>
<td align="right">0.7011484</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>),
             .(new_tax, baseline_tax, Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202728 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(new_tax, baseline_tax, Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">  </span>decile201718[., roll =<span class="st"> </span><span class="ot">TRUE</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(new_tax)), keyby =<span class="st"> </span>.(Taxable_Income_decile, min_Taxable_Income)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">Decile =</span> Taxable_Income_decile, 
        <span class="st">`</span><span class="dt">Min income</span><span class="st">`</span> =<span class="st"> </span><span class="kw">grattan_dollar</span>(min_Taxable_Income),
        <span class="st">`</span><span class="dt">Tax paid ($bn)</span><span class="st">`</span> =<span class="st"> </span>tot,
        <span class="st">`</span><span class="dt">% paid</span><span class="st">`</span> =<span class="st"> </span>prop)] <span class="op">%&gt;%</span>
<span class="st">  </span>kable</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Decile</th>
<th align="left">Min income</th>
<th align="right">Tax paid ($bn)</th>
<th align="right">% paid</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">$0</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">$0</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">$11,000</td>
<td align="right">675356</td>
<td align="right">0.0001150</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">$24,000</td>
<td align="right">55572723</td>
<td align="right">0.0094620</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">$37,000</td>
<td align="right">167619563</td>
<td align="right">0.0285395</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">$50,000</td>
<td align="right">438633192</td>
<td align="right">0.0746833</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">$68,000</td>
<td align="right">855676748</td>
<td align="right">0.1456906</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">$98,000</td>
<td align="right">4355068347</td>
<td align="right">0.7415096</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s2728_various_wages &lt;-
<span class="st">  </span><span class="cf">if</span> (<span class="kw">file.exists</span>(s2728_various_wages.fst &lt;-<span class="st"> "budget-2018_cache/s2728_various_wages.fst"</span>) <span class="op">&amp;&amp;</span><span class="st"> </span>cache) {
    <span class="kw">read_fst</span>(s2728_various_wages.fst, <span class="dt">as.data.table =</span> <span class="ot">TRUE</span>)
  } <span class="cf">else</span> {
    <span class="kw">lapply</span>(<span class="kw">c</span>(<span class="fl">0.02</span>, <span class="fl">0.025</span>, <span class="fl">0.03</span>, <span class="fl">0.035</span>), <span class="cf">function</span>(wage_r) {
      <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> 12L, <span class="dt">wage.series =</span> wage_r) <span class="op">%&gt;%</span>
<span class="st">        </span>grattan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grattan/topics/model_income_tax">model_income_tax</a></span>(
          <span class="dt">baseline_fy =</span> <span class="st">"2017-18"</span>,
          <span class="dt">medicare_levy_lower_threshold =</span> <span class="kw">medicare_levy_lower_threshold</span>(<span class="st">"2027-28"</span>),
          <span class="dt">medicare_levy_lower_sapto_threshold =</span> <span class="kw">medicare_levy_lower_sapto_threshold</span>(<span class="st">"2027-28"</span>),
          <span class="dt">medicare_levy_lower_family_threshold =</span> <span class="kw">medicare_levy_lower_family_threshold</span>(<span class="st">"2027-28"</span>),
          <span class="dt">medicare_levy_lower_family_sapto_threshold =</span> <span class="kw">medicare_levy_lower_family_sapto_threshold</span>(<span class="st">"2027-28"</span>),
          <span class="dt">medicare_levy_lower_up_for_each_child =</span> <span class="kw">medicare_levy_lower_up_for_each_child</span>(<span class="st">"2027-28"</span>),
          <span class="dt">warn_upper_thresholds =</span> <span class="ot">FALSE</span>,
          <span class="dt">Budget2018_lamington =</span> <span class="ot">FALSE</span>,
          <span class="dt">Budget2018_lito_202223 =</span> <span class="ot">TRUE</span>,
          <span class="dt">Budget2018_watr =</span> <span class="ot">FALSE</span>,
          <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="st">"2027-28"</span>),
          <span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="st">"2027-28"</span>)) <span class="op">%&gt;%</span>
<span class="st">        </span>.[, .(Ind, age_range, Total_PP_BE_amt, Total_NPP_BE_amt,
              Taxable_Income, new_tax, baseline_tax, WEIGHT,
              <span class="dt">id =</span> wage_r)] 
    }) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, new_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(new_tax)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span>new_tax <span class="op">-</span><span class="st"> </span>baseline_tax] <span class="op">%T&gt;%</span>
<span class="st">      </span><span class="kw">write_fst</span>(s2728_various_wages.fst) <span class="op">%&gt;%</span>
<span class="st">      </span>.[]
  }</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../../reference/compare_avg_tax_rates.html">compare_avg_tax_rates</a></span>(s2728_various_wages, s1718[, baseline_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax]) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Wage assumption"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(<span class="kw">percent</span>(id))] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"compare-avg-tax-rates-2027-28-wage-assumptions.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_percentile,
             <span class="dt">y =</span> delta_avgTaxRate,
             <span class="dt">color =</span> <span class="st">`</span><span class="dt">Wage assumption</span><span class="st">`</span>,
             <span class="dt">group =</span> <span class="st">`</span><span class="dt">Wage assumption</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Taxable Income percentile"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), 
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Budget2018-atlas/comparison-wage-assumptions-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models[.(<span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2025</span>), <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, new_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.double</span>(new_tax)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot_tax =</span> <span class="kw">sum</span>(new_tax)),
    keyby =<span class="st"> </span>.(<span class="dt">fy2018 =</span> id,<span class="co">#  if_else(fy_year == "2018-19", "2018-19", "2019-20 - 2024-25"),</span>
              <span class="dt">Quintile =</span> <span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">5</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, p <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot_tax <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot_tax), keyby =<span class="st"> "fy2018"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]
<span class="co">#&gt;        fy2018 Quintile     tot_tax          p</span>
<span class="co">#&gt; 1: Budget2018        1           0 0.00000000</span>
<span class="co">#&gt; 2: Budget2018        2   726293117 0.02243683</span>
<span class="co">#&gt; 3: Budget2018        3  3074742262 0.09498570</span>
<span class="co">#&gt; 4: Budget2018        4  6675273641 0.20621421</span>
<span class="co">#&gt; 5: Budget2018        5 21894270578 0.67636325</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">adult_population_projections &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">lapply</span>(<span class="kw">as.Date</span>(<span class="kw">paste0</span>(<span class="dv">2001</span><span class="op">:</span><span class="dv">2016</span>, <span class="st">"-06-30"</span>)), aus_pop_qtr_age, <span class="dt">age =</span> <span class="dv">18</span><span class="op">:</span><span class="dv">100</span>, <span class="dt">tbl =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>rbindlist <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[, .(<span class="dt">pop =</span> <span class="kw">sum</span>(Value)), keyby =<span class="st"> "Date"</span>] <span class="op">%$%</span><span class="st"> </span>
<span class="st">  </span>forecast<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/forecast/topics/forecast">forecast</a></span>(pop, <span class="dt">h =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.frame <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">YR =</span> <span class="kw">as.integer</span>(<span class="kw">rownames</span>(.)) <span class="op">+</span><span class="st"> </span>2000L) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="st">"YR"</span>)

adult_population_projections <span class="op">%&gt;%</span>
<span class="st">  </span>{
    dot &lt;-<span class="st"> </span>.
    ribbon &lt;-<span class="st"> </span>
<span class="st">      </span>dot[variable <span class="op">%enotin%</span><span class="st"> "Point Forecast"</span>] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, <span class="kw">c</span>(<span class="st">"LowHi"</span>, <span class="st">"Level"</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">tstrsplit</span>(variable, <span class="dt">split =</span> <span class="st">" "</span>)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, variable <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">dcast</span>(... <span class="op">~</span><span class="st"> </span>LowHi, <span class="dt">value.var =</span> <span class="st">"value"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, Level <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(Level)]
    
    <span class="kw">grplot</span>(dot) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> ribbon[Level <span class="op">==</span><span class="st"> </span>80L], 
                  <span class="kw">aes</span>(<span class="dt">x =</span> YR, <span class="dt">ymin =</span> Lo, <span class="dt">ymax =</span> Hi), 
                  <span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> ribbon[Level <span class="op">==</span><span class="st"> </span>95L], 
                  <span class="kw">aes</span>(<span class="dt">x =</span> YR, <span class="dt">ymin =</span> Lo, <span class="dt">ymax =</span> Hi), 
                  <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_line</span>(<span class="dt">data =</span> dot[variable <span class="op">%ein%</span><span class="st"> "Point Forecast"</span>], 
                <span class="kw">aes</span>(<span class="dt">x =</span> YR, <span class="dt">y =</span> value, <span class="dt">color =</span> variable)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">22.37e6</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">2024</span>) <span class="op">+</span>
<span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">label =</span> <span class="cf">function</span>(x) <span class="kw">paste0</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span>, <span class="st">"M"</span>))
  }</code></pre></div>
<p><img src="Budget2018-atlas/adult_population_projections-1.svg" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s1516 &lt;-<span class="st"> </span><span class="kw">copy</span>(sample_file_<span class="dv">1516</span>)[, tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="st">"2015-16"</span>, <span class="dt">.dots.ATO =</span> .SD)]
n_taxpayers_<span class="dv">1516</span> &lt;-<span class="st"> </span>s1516[tax <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>, .N <span class="op">*</span><span class="st"> </span><span class="dv">50</span>]
n_taxpayers_<span class="dv">1718</span> &lt;-<span class="st"> </span>s1718[tax <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">sum</span>(WEIGHT)]


v &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2025</span> <span class="op">-</span><span class="st"> </span><span class="dv">2016</span>))
deloitte_wage_r &lt;-<span class="st"> </span>(<span class="fl">11.6e6</span> <span class="op">/</span><span class="st"> </span>n_taxpayers_<span class="dv">1516</span>) <span class="op">^</span><span class="st"> </span>v
budget_wage_r &lt;-<span class="st"> </span>
<span class="st">  </span>(bound_models[.(<span class="st">"2024-25"</span>, <span class="st">"Budget2018"</span>)][new_tax <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">sum</span>(WEIGHT)] <span class="op">/</span><span class="st"> </span>n_taxpayers_<span class="dv">1516</span>) <span class="op">^</span><span class="st"> </span>v</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">adultpop2016 &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw"><a href="../../reference/aus_pop_qtr_age.html">aus_pop_qtr_age</a></span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(<span class="st">"2016-06-30"</span>), <span class="dt">age =</span> <span class="dv">18</span><span class="op">:</span><span class="dv">100</span>))
deloitte_pop_r &lt;-<span class="st"> </span>(<span class="fl">22.37e6</span> <span class="op">/</span><span class="st"> </span>adultpop2016) <span class="op">^</span><span class="st"> </span>v
budget_pop_r &lt;-<span class="st"> </span>
<span class="st">  </span>adult_population_projections <span class="op">%&gt;%</span>
<span class="st">  </span>.[YR <span class="op">==</span><span class="st"> </span><span class="dv">2025</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[variable <span class="op">==</span><span class="st"> "Point Forecast"</span>, (value <span class="op">/</span><span class="st"> </span>adultpop2016) <span class="op">^</span><span class="st"> </span>v]
  </code></pre></div>
<p>Growth assumptions:</p>
<ul>
<li>Number of taxpayers:
<ul>
<li>Deloitte: 1.46%</li>
<li>Budget: 2.04%</li>
</ul>
</li>
<li>Number of adults:
<ul>
<li>Deloitte: 1.98%</li>
<li>Grattan: 1.45%</li>
</ul>
</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s2425_Deloitte_LF_growth &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> 9L) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">baseline_fy =</span> <span class="st">"2017-18"</span>, 
                   <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="st">"2024-25"</span>), 
                   <span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="st">"2024-25"</span>),
                   <span class="dt">Budget2018_lito_202223 =</span> <span class="ot">TRUE</span>,
                   <span class="co"># medicare_levy_rate = 0.02,</span>
                   <span class="co"># medicare_levy_taper = 0.1,</span>
                   <span class="dt">medicare_levy_lower_threshold =</span> <span class="kw">medicare_levy_lower_threshold</span>(<span class="st">"2024-25"</span>), <span class="co"># 24950</span>
                   <span class="dt">medicare_levy_upper_threshold =</span> <span class="dv">31188</span>,
                   <span class="dt">medicare_levy_lower_sapto_threshold =</span> <span class="kw">medicare_levy_lower_sapto_threshold</span>(<span class="st">"2024-25"</span>), <span class="co"># 39460</span>
                   <span class="dt">medicare_levy_upper_sapto_threshold =</span> <span class="dv">49325</span>,
                   <span class="dt">medicare_levy_lower_family_threshold =</span> <span class="kw">medicare_levy_lower_family_threshold</span>(<span class="st">"2024-25"</span>), <span class="co"># 54930</span>
                   <span class="dt">medicare_levy_lower_family_sapto_threshold =</span> <span class="kw">medicare_levy_lower_family_sapto_threshold</span>(<span class="st">"2024-25"</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 54930</span>
<span class="st">  </span><span class="co"># Ensure number of taxpayers = 11.6 million</span>
<span class="st">  </span>.[new_tax <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>, WEIGHT <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">11.6e6</span> <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(new_tax <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>
<span class="st">  </span><span class="co"># Ensure total population is 22.37 million</span>
<span class="st">  </span>.[, WEIGHT <span class="op">:</span><span class="er">=</span><span class="st"> </span>WEIGHT <span class="op">*</span><span class="st"> </span><span class="kw">if_else</span>(new_tax <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>,
                                 <span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="fl">22.37e6</span> <span class="op">-</span><span class="st"> </span><span class="fl">11.6e6</span> <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(WEIGHT[new_tax <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>])) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(WEIGHT[new_tax <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>]),
                                 <span class="dv">1</span>)]

<span class="kw">stopifnot</span>(s2425_Deloitte_LF_growth[new_tax <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>, <span class="kw">sum</span>(WEIGHT)] <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">11.5e6</span>, <span class="fl">11.7e6</span>))
<span class="kw">stopifnot</span>(s2425_Deloitte_LF_growth[, <span class="kw">sum</span>(WEIGHT)] <span class="op">%between%</span><span class="st"> </span><span class="kw">c</span>(<span class="fl">22.2e6</span>, <span class="fl">22.4e6</span>))

s2425_Deloitte_LF_growth <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total_tax_paid =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT)),
    keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> <span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">weights =</span> WEIGHT, <span class="dt">n =</span> <span class="dv">5</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, p <span class="op">:</span><span class="er">=</span><span class="st"> </span>total_tax_paid <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_tax_paid)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]
<span class="co">#&gt;    Quintile total_tax_paid          p</span>
<span class="co">#&gt; 1:        1              0 0.00000000</span>
<span class="co">#&gt; 2:        2              0 0.00000000</span>
<span class="co">#&gt; 3:        3     5703774729 0.02266607</span>
<span class="co">#&gt; 4:        4    46373304104 0.18428157</span>
<span class="co">#&gt; 5:        5   199566665197 0.79305236</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minIncome_by_Quintile_Deloitte_method201718 &lt;-
<span class="st">  </span>avg_tax_by_decile_allpersons201718 <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">minIncome =</span> <span class="kw">round</span>(<span class="kw">min</span>(min_income), <span class="op">-</span><span class="dv">3</span>)),
    keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> {{Taxable_Income_decile <span class="op">-</span><span class="st"> </span>1L} <span class="op">%/%</span><span class="st"> </span>2L} <span class="op">+</span><span class="st"> </span>1L)]
<span class="kw">fwrite</span>(minIncome_by_Quintile_Deloitte_method201718, 
       <span class="st">"minIncome_by_Quintile_Deloitte_method201718.csv"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minIncome_by_Quintile_Deloitte_method202425 &lt;-
<span class="st">  </span>avg_tax_by_decile_allpersons202425 <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">minIncome =</span> <span class="kw">round</span>(<span class="kw">min</span>(min_income), <span class="op">-</span><span class="dv">3</span>)),
    keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> {{Taxable_Income_decile <span class="op">-</span><span class="st"> </span>1L} <span class="op">%/%</span><span class="st"> </span>2L} <span class="op">+</span><span class="st"> </span>1L)]
<span class="kw">fwrite</span>(minIncome_by_Quintile_Deloitte_method202425, 
       <span class="st">"minIncome_by_Quintile_Deloitte_method202425.csv"</span>)</code></pre></div>
</div>
</div>
<div id="jd-how-not-to-sell-a-tax-cut" class="section level2">
<h2 class="hasAnchor">
<a href="#jd-how-not-to-sell-a-tax-cut" class="anchor"></a>JD ‘How not to sell a tax cut’</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_geq_120k_<span class="dv">202728</span> &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>)] <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(Taxable_Income <span class="op">&gt;</span><span class="st"> </span><span class="fl">120e3</span>)
<span class="kw">stopifnot</span>(<span class="kw">round</span>(p_geq_120k_<span class="dv">202728</span>, <span class="dv">1</span>) <span class="op">==</span><span class="st"> </span><span class="fl">0.2</span>)</code></pre></div>
<p>Of course, a tax cut of $14 billion a year is a tricky sell when it benefits less than 2 in 10 of income earners in 2027-28. But the government has made its own life harder by using misleading statistics and not providing the numbers that could support its best argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">current_tax_paid_geq_180k &lt;-<span class="st"> </span>
<span class="st">  </span>s1718 <span class="op">%&gt;%</span>
<span class="st">  </span>.[, tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="st">"2017-18"</span>, <span class="dt">.dots.ATO =</span> s1718)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(Taxable_Income, tax)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(tax)), keyby =<span class="st"> </span>.(<span class="dt">Over180k =</span> Taxable_Income <span class="op">&gt;</span><span class="st"> </span><span class="fl">180e3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[(Over180k)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[[<span class="st">"prop"</span>]] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grattan_percent</span>(<span class="dt">.percent.suffix =</span> <span class="st">" per cent"</span>)

tax_paid_geq180k_Budget202728 &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(Taxable_Income, <span class="dt">tax =</span> <span class="kw">as.double</span>(new_tax))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(tax)), keyby =<span class="st"> </span>.(<span class="dt">Over180k =</span> Taxable_Income <span class="op">&gt;</span><span class="st"> </span><span class="fl">180e3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[(Over180k)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[[<span class="st">"prop"</span>]] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grattan_percent</span>(<span class="dt">.percent.suffix =</span> <span class="st">" per cent"</span>)

prop_persons_geq180k_<span class="dv">201718</span> &lt;-
<span class="st">  </span>s1718[, .(<span class="dt">n =</span> .N), keyby =<span class="st"> </span>.(<span class="dt">Over180k =</span> Taxable_Income <span class="op">&gt;</span><span class="st"> </span><span class="fl">180e3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[(Over180k)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[[<span class="st">"prop"</span>]]

prop_persons_geq180k_Budget202728 &lt;-<span class="st"> </span>
<span class="st">   </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(WEIGHT)), keyby =<span class="st"> </span>.(<span class="dt">Over180k =</span> Taxable_Income <span class="op">&gt;</span><span class="st"> </span><span class="fl">180e3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[(Over180k)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[[<span class="st">"prop"</span>]]

<span class="kw">stopifnot</span>(<span class="op">!</span><span class="kw">exists</span>(<span class="st">"twice1"</span>))
twice1 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">if</span> (prop_persons_geq180k_Budget202728 <span class="op">/</span><span class="st"> </span>prop_persons_geq180k_<span class="dv">201718</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) {
    <span class="st">"twice"</span>
  } <span class="cf">else</span> {
    twice1
  }</code></pre></div>
<p>Another tricky claim is that without change those earning over $180,000 will go from paying 32.0 per cent to 43.0 per cent of income tax. But this is sleight of hand: twice as many people could be expected to be earning this income – so of course they will collectively pay a greater share of income tax.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prop_tax_earnt_by_quintile_<span class="dv">201718</span> &lt;-<span class="st"> </span>
<span class="st">  </span>s1718[,
        .(<span class="dt">tax_earnt_bn =</span> <span class="kw">sum</span>(Taxable_Income <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)),
        keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">5</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax_earnt_bn <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tax_earnt_bn)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]

prop_tax_paid_by_quintile_202728_baseline &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tax_paid =</span> <span class="kw">sum</span>(<span class="kw">as.numeric</span>(new_tax))), keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">5</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax_paid <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tax_paid)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]

prop_tax_paid_by_quintile_202728_Budget &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[.(<span class="st">"2027-28"</span>, <span class="st">"Budget2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tax_paid =</span> <span class="kw">sum</span>(<span class="kw">as.numeric</span>(new_tax))), keyby =<span class="st"> </span>.(<span class="dt">Quintile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">5</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tax_paid <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tax_paid)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<p>The government’s best and most honest argument is that the tax package as a whole won’t materially change the progressivity of the income tax system. Without change, the top 20% of income earners – who earn 50.8 per cent per cent of taxable income – will pay 64.989 per cent of income tax. And under the package they will pay 64.9890 per cent.</p>
</div>
<div id="applying-timings" class="section level2">
<h2 class="hasAnchor">
<a href="#applying-timings" class="anchor"></a>Applying timings</h2>
<p>We can apply timing issues: 85% revenue is tax revenue and 15% at the time of assessment for those under $180,000; 75% and 25% at time of assessment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># setindex(bound_models, id)</span>
bound_models_with_timings &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">lapply</span>(<span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>), <span class="cf">function</span>(x) {
    bound_models[.(unique_fy_year, <span class="st">"Budget2018"</span>),
                 .(id,
                   <span class="dt">YearOfAssessment =</span> x,
                   <span class="dt">fy_year2 =</span> <span class="cf">if</span> (x) <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(.BY[[1L]]) <span class="op">+</span><span class="st"> </span>x) <span class="cf">else</span> .BY[[1L]],
                   Ind,
                   Taxable_Income,
                   delta,
                   WEIGHT), 
                 keyby =<span class="st"> "fy_year"</span>][, fy_year <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]
  }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>() <span class="op">%&gt;%</span>
<span class="st">  </span>.[(Taxable_Income <span class="op">&gt;</span><span class="st"> </span><span class="fl">180e3</span>), WEIGHT <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(YearOfAssessment, <span class="fl">0.25</span>, <span class="fl">0.75</span>) <span class="op">*</span><span class="st"> </span>WEIGHT] <span class="op">%&gt;%</span>
<span class="st">  </span>.[(Taxable_Income <span class="op">&lt;=</span><span class="st"> </span><span class="fl">180e3</span>), WEIGHT <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(YearOfAssessment, <span class="fl">0.15</span>, <span class="fl">0.85</span>) <span class="op">*</span><span class="st"> </span>WEIGHT] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(delta <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)), keyby =<span class="st"> "fy_year2"</span>]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/session_info">session_info</a></span>()
<span class="co">#&gt; Session info ------------------------------------------------------------------------------------------------</span>
<span class="co">#&gt;  setting  value                       </span>
<span class="co">#&gt;  version  R version 3.5.1 (2018-07-02)</span>
<span class="co">#&gt;  system   x86_64, mingw32             </span>
<span class="co">#&gt;  ui       RTerm                       </span>
<span class="co">#&gt;  language (EN)                        </span>
<span class="co">#&gt;  collate  English_Australia.1252      </span>
<span class="co">#&gt;  tz       Australia/Sydney            </span>
<span class="co">#&gt;  date     2018-08-29</span>
<span class="co">#&gt; Packages ----------------------------------------------------------------------------------------------------</span>
<span class="co">#&gt;  package        * version    date       source                                      </span>
<span class="co">#&gt;  assertthat       0.2.0      2017-04-11 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  backports        1.1.2      2017-12-13 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  base           * 3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  bindr            0.1.1      2018-03-13 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  bindrcpp       * 0.2.2      2018-03-29 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  codetools        0.2-15     2016-10-05 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  colorspace       1.3-2      2016-12-14 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  commonmark       1.5        2018-04-28 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  compiler         3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  crayon           1.3.4      2017-09-16 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  curl             3.2        2018-03-28 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  data.table     * 1.11.5     2018-08-11 local                                       </span>
<span class="co">#&gt;  datasets       * 3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  desc             1.2.0      2018-05-01 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  devtools         1.13.6     2018-06-27 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  digest           0.6.16     2018-08-22 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  dplyr            0.7.6      2018-06-29 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  evaluate         0.11       2018-07-17 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  fastmatch      * 1.1-0      2017-01-28 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  forecast         8.4        2018-06-21 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  fracdiff         1.4-2      2012-12-02 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  fs               1.2.6      2018-08-23 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  fst            * 0.8.8      2018-06-07 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  ggplot2        * 3.0.0      2018-07-03 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  ggrepel        * 0.8.0      2018-05-09 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  glue             1.3.0      2018-07-17 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  graphics       * 3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  grattan        * 1.6.4.0    2018-08-29 local                                       </span>
<span class="co">#&gt;  grattanCharts  * 0.9.1      2018-08-27 Github (hughparsonage/grattanCharts@57bfd19)</span>
<span class="co">#&gt;  grDevices      * 3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  grid             3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  gridExtra        2.3        2017-09-09 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  gtable           0.2.0      2016-02-26 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  highr            0.7        2018-06-09 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  htmltools        0.3.6      2017-04-28 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  hutils         * 1.2.0      2018-08-27 local                                       </span>
<span class="co">#&gt;  ineq             0.2-13     2014-07-21 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  knitr          * 1.20       2018-02-20 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  labeling         0.3        2014-08-23 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  lattice          0.20-35    2017-03-25 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  lazyeval         0.2.1      2017-10-29 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  lmtest           0.9-36     2018-04-04 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  magrittr       * 1.5        2014-11-22 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  MASS             7.3-50     2018-04-30 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  memoise          1.1.0      2017-04-21 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  methods        * 3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  munsell          0.5.0      2018-06-12 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  nlme             3.1-137    2018-04-07 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  nnet             7.3-12     2016-02-02 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  parallel         3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  pillar           1.3.0      2018-07-14 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  pkgconfig        2.0.2      2018-08-16 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  pkgdown          1.1.0.9000 2018-08-29 Github (r-lib/pkgdown@b279865)              </span>
<span class="co">#&gt;  plyr             1.8.4      2016-06-08 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  purrr            0.2.5      2018-05-29 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  quadprog         1.5-5      2013-04-17 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  quantmod         0.4-13     2018-04-13 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  R6               2.2.2      2017-06-17 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  Rcpp             0.12.18    2018-07-23 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  rlang            0.2.2      2018-08-16 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  rmarkdown        1.10       2018-06-11 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  roxygen2         6.1.0      2018-07-27 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  rprojroot        1.3-2      2018-01-03 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  rstudioapi       0.7        2017-09-07 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  SampleFile1415   1.0        2018-07-06 local                                       </span>
<span class="co">#&gt;  scales         * 1.0.0      2018-08-09 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  stats          * 3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  stringi          1.1.7      2018-03-12 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  stringr          1.3.1      2018-05-10 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  sysfonts         0.7.2      2018-01-16 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  taxstats       * 0.0.5.1415 2018-05-23 local                                       </span>
<span class="co">#&gt;  tibble           1.4.2      2018-01-22 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  tidyselect       0.2.4      2018-02-26 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  timeDate         3043.102   2018-02-21 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  tools            3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  tseries          0.10-45    2018-06-04 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  TTR              0.23-3     2018-01-24 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  urca             1.3-0      2016-09-06 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  uroot            2.0-9      2017-01-29 CRAN (R 3.5.0)                              </span>
<span class="co">#&gt;  utils          * 3.5.1      2018-07-02 local                                       </span>
<span class="co">#&gt;  viridis        * 0.5.1      2018-03-29 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  viridisLite    * 0.3.0      2018-02-01 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  withr            2.1.2      2018-03-15 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  xml2             1.2.0      2018-01-24 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  xts              0.11-0     2018-07-16 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  yaml             2.2.0      2018-07-25 CRAN (R 3.5.1)                              </span>
<span class="co">#&gt;  zoo              1.8-3      2018-07-16 CRAN (R 3.5.1)</span></code></pre></div>
<p>Finished in 245.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#jd-how-not-to-sell-a-tax-cut">JD ‘How not to sell a tax cut’</a></li>
      <li><a href="#applying-timings">Applying timings</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hugh Parsonage, Tim Cameron, Brendan Coates, Matthew Katzen, William Young.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
