<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget 2018 modelling • grattan</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../jquery.sticky-kit.min.js"></script><script src="../../pkgdown.js"></script><meta property="og:title" content="Budget 2018 modelling">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">grattan</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.6.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/grattan.html">Get started</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/long-vignettes/budget-2018.html">Budget 2018 modelling</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HughParsonage/grattan">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Budget 2018 modelling</h1>
                        <h4 class="author">Hugh Parsonage</h4>
            
            <h4 class="date">2018-05-25</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HughParsonage/grattan/blob/master/vignettes/long-vignettes/budget-2018.Rmd"><code>vignettes/long-vignettes/budget-2018.Rmd</code></a></small>
      <div class="hidden name"><code>budget-2018.Rmd</code></div>

    </div>

    
    
<p>Width: 75.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">options</span>(<span class="dt">width =</span> <span class="dv">100</span>)</code></pre></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This article outlines the calculations used in Grattan Institute’s tax modelling. The model is simple:</p>
<ol style="list-style-type: decimal">
<li>Project (“uprate”) the latest sample files to the years required</li>
<li>Use <code>model_income_tax</code> with the required parameters.</li>
</ol>
<p>First load the packages we’ll need.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fastmatch)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(scales)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(ggrepel)
<span class="kw">library</span>(viridis)
<span class="co">#&gt; Loading required package: viridisLite</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'viridis'</span>
<span class="co">#&gt; The following object is masked from 'package:scales':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     viridis_pal</span>
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(hutils)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'hutils'</span>
<span class="co">#&gt; The following object is masked from 'package:fastmatch':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     coalesce</span>
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(data.table)
<span class="kw">library</span>(grattanCharts)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'grattanCharts'</span>
<span class="co">#&gt; The following object is masked from 'package:datasets':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Orange</span>
templib &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/provide.dir">provide.dir</a></span>(templib)</code></pre></div>
<p>We also load the <code>taxstats</code> package. The other packages are private as the ATO has suppressed the information from the public: unfortunately, only approved institutions can use this data sets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(taxstats)

sample_file_<span class="dv">1415</span> &lt;-<span class="st"> </span>SampleFile1415<span class="op">::</span>sample_file_<span class="dv">1415</span>
sample_file_<span class="dv">1516</span> &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>, <span class="dt">logical01 =</span> <span class="ot">FALSE</span>)

sample_files_all &lt;-
<span class="st">    </span><span class="kw">rbindlist</span>(<span class="kw">lapply</span>(<span class="kw">list</span>(<span class="st">`</span><span class="dt">2003-04</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0304</span>, 
                          <span class="st">`</span><span class="dt">2004-05</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0405</span>,
                          <span class="st">`</span><span class="dt">2005-06</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0506</span>, 
                          <span class="st">`</span><span class="dt">2006-07</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0607</span>,
                          <span class="st">`</span><span class="dt">2007-08</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0708</span>, 
                          <span class="st">`</span><span class="dt">2008-09</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0809</span>,
                          <span class="st">`</span><span class="dt">2009-10</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">0910</span>, 
                          <span class="st">`</span><span class="dt">2010-11</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1011</span>,
                          <span class="st">`</span><span class="dt">2011-12</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1112</span>, 
                          <span class="st">`</span><span class="dt">2012-13</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1213</span>,
                          <span class="st">`</span><span class="dt">2013-14</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1314</span>,
                          <span class="st">`</span><span class="dt">2014-15</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1415</span>,
                          <span class="st">`</span><span class="dt">2015-16</span><span class="st">`</span> =<span class="st"> </span>sample_file_<span class="dv">1516</span>), 
                     data.table<span class="op">::</span>as.data.table),
              <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
              <span class="dt">fill =</span> <span class="ot">TRUE</span>, 
              <span class="dt">idcol =</span> <span class="st">"fy.year"</span>)
sample_files_all[, WEIGHT <span class="op">:</span><span class="er">=</span><span class="st"> </span>hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/if_else">if_else</a></span>(fy.year <span class="op">&gt;</span><span class="st"> '2010-11'</span>, 50L, 100L)]
sample_files_all[<span class="kw">is.na</span>(age_range), age_range <span class="op">:</span><span class="er">=</span><span class="st"> </span>Birth_year]
sample_files_all[<span class="kw">is.na</span>(Othr_pnsn_amt), Othr_pnsn_amt <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]
sample_files_all[<span class="kw">is.na</span>(Med_Exp_TO_amt), Med_Exp_TO_amt <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]
sample_files_all[<span class="kw">is.na</span>(Spouse_adjusted_taxable_inc), Spouse_adjusted_taxable_inc <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]
age_range_decoder &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(age_range_decoder)

## ----load-grattan--------------------------------------------------------
<span class="kw">library</span>(grattan)
<span class="co">#&gt; Last change: NAMESPACE at 2018-05-23 13:56:23 (1 days ago).</span>

ntile &lt;-<span class="st"> </span><span class="cf">function</span>(x, n) {
  <span class="cf">if</span> (<span class="kw">requireNamespace</span>(<span class="st">"dplyr"</span>, <span class="dt">quietly =</span> <span class="ot">TRUE</span>)) {
    dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/ranking.html">ntile</a></span>(x, n)
  } <span class="cf">else</span> {
    grattan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grattan/topics/weighted_ntile">weighted_ntile</a></span>(x, <span class="dt">n =</span> n)
  }
}
coalesce &lt;-<span class="st"> </span>hutils<span class="op">::</span>coalesce

sample_files_all[, Taxable_Income_percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span>.[, tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/income_tax.html">income_tax</a></span>(Taxable_Income, <span class="dt">fy.year =</span> .BY[[1L]], <span class="dt">.dots.ATO =</span> .SD), keyby =<span class="st"> "fy.year"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">revenue_foregone &lt;-<span class="st"> </span><span class="cf">function</span>(dt, <span class="dt">revenue_positive =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="ot">NULL</span>) {
  out &lt;-<span class="st"> </span>dt[, <span class="kw">sum</span>((<span class="kw">as.integer</span>(new_tax) <span class="op">-</span><span class="st"> </span>baseline_tax) <span class="op">*</span><span class="st"> </span>WEIGHT)]
  <span class="kw">class</span>(out) &lt;-<span class="st"> "revenue_foregone"</span>
  <span class="kw">setattr</span>(out, <span class="st">"digits"</span>, digits)
  out
}

.revenue_foregone &lt;-<span class="st"> </span><span class="cf">function</span>(dt, <span class="dt">revenue_positive =</span> <span class="ot">TRUE</span>, <span class="dt">digits =</span> <span class="ot">NULL</span>) {
  out &lt;-<span class="st"> </span>dt[, <span class="kw">sum</span>((<span class="kw">as.integer</span>(new_tax) <span class="op">-</span><span class="st"> </span>baseline_tax) <span class="op">*</span><span class="st"> </span>WEIGHT)]
  <span class="kw">class</span>(out) &lt;-<span class="st"> "revenue_foregone"</span>
  <span class="kw">setattr</span>(out, <span class="st">"digits"</span>, digits)
  
  <span class="cf">if</span> (<span class="kw">is_knitting</span>()) {
    <span class="kw">return</span>(<span class="kw">print.revenue_foregone</span>(out))
  }
  out
}

print.revenue_foregone &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {
  <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {
    pre &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"\u2212"</span>, <span class="cf">if</span> (<span class="kw">is_knitting</span>()) <span class="st">"</span><span class="ch">\\</span><span class="st">$"</span> <span class="cf">else</span> <span class="st">"$"</span>)
    x &lt;-<span class="st"> </span><span class="op">-</span>x
  } <span class="cf">else</span> {
    pre &lt;-<span class="st"> "$"</span>
  }
  d &lt;-<span class="st"> </span><span class="cf">function</span>(default) {
    <span class="cf">if</span> (<span class="kw">is.null</span>(<span class="kw">attr</span>(x, <span class="st">"digits"</span>))) {
      default
    } <span class="cf">else</span> {
      <span class="kw">attr</span>(x, <span class="st">"digits"</span>)
    }
  }
  <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span><span class="fl">10e9</span>) {
    res &lt;-<span class="st"> </span><span class="kw">paste0</span>(pre, <span class="kw">prettyNum</span>(<span class="kw">round</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="kw">d</span>(<span class="dv">0</span>)), <span class="dt">big.mark =</span> <span class="st">","</span>), <span class="st">" billion"</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span><span class="fl">1e9</span>) {
    res &lt;-<span class="st"> </span><span class="kw">paste0</span>(pre, <span class="kw">prettyNum</span>(<span class="kw">round</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="kw">d</span>(<span class="dv">1</span>)), <span class="dt">big.mark =</span> <span class="st">","</span>), <span class="st">" billion"</span>)
  } <span class="cf">else</span> {
    res &lt;-<span class="st"> </span><span class="kw">paste0</span>(pre, <span class="kw">prettyNum</span>(<span class="kw">round</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e6</span>, <span class="kw">d</span>(<span class="dv">0</span>)), <span class="dt">big.mark =</span> <span class="st">","</span>), <span class="st">" million"</span>)
  }
  <span class="kw">print</span>(res)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ------------------------------------------------------------------------
s1617 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)) {
    sample_file_<span class="dv">1516</span> &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)
    <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> 1L, <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2015-16"</span>)
  } <span class="cf">else</span> {
    <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_1415_synth, <span class="dt">h =</span> 2L)
  }
s1617 &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1617, <span class="st">"2016-17"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ------------------------------------------------------------------------
s1718 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)) {
    sample_file_<span class="dv">1516</span> &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)
    <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> 2L, <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2015-16"</span>)
  } <span class="cf">else</span> {
    <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_1415_synth, <span class="dt">h =</span> 3L)
  }
s1718 &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1718, <span class="st">"2017-18"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## ------------------------------------------------------------------------
s1819 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)) {
    sample_file_<span class="dv">1516</span> &lt;-<span class="st"> </span><span class="kw">fread</span>(<span class="st">"~/ozTaxData/data-raw/2016_sample_file.csv"</span>)
    <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> 3L, <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2015-16"</span>)
  } <span class="cf">else</span> {
    <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_1415_synth, <span class="dt">h =</span> 4L)
  } <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="st">"2018-19"</span>)</code></pre></div>
<p>These tables come from the Budget papers and will be passed to <code>project</code> so that the uprating can be set with fixed values. (By default <code>project</code> forecasts the series using the <code>forecast</code> package.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_forecasts &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2018</span><span class="op">:</span><span class="dv">2028</span>),
             <span class="dt">r =</span> <span class="kw">c</span>(<span class="fl">2.25</span>, <span class="fl">2.75</span>, <span class="fl">3.25</span>, <span class="fl">3.5</span>, <span class="fl">3.5</span>, <span class="kw">rep</span>(<span class="fl">3.5</span>, <span class="dv">6</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lf_forecasts &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2018</span><span class="op">:</span><span class="dv">2028</span>),
             <span class="dt">r =</span> <span class="kw">c</span>(<span class="fl">2.75</span>, <span class="fl">1.50</span>, <span class="fl">1.50</span>, <span class="fl">1.50</span>, <span class="fl">1.25</span>, <span class="kw">rep</span>(<span class="fl">1.25</span>, <span class="dv">6</span>)) <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</code></pre></div>
<p>These are functions of years from 2015-16 that return the tax rates and tax thresholds that the Government has proposed in the Budget. They are used so that the out years can be modelled conveniently as a function of the year only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ordinary_tax_rates &lt;-<span class="st"> </span><span class="cf">function</span>(h) {
  <span class="cf">if</span> (h <span class="op">&lt;</span><span class="st"> </span><span class="dv">9</span>) {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span>, <span class="fl">0.325</span>, <span class="fl">0.37</span>, <span class="fl">0.45</span>)
  } <span class="cf">else</span> {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span>, <span class="fl">0.325</span>, <span class="fl">0.45</span>)  
  }
}

ordinary_tax_thresholds &lt;-<span class="st"> </span><span class="cf">function</span>(h) {
  <span class="cf">if</span> (h <span class="op">&lt;</span><span class="st"> </span><span class="dv">7</span>) {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="fl">37e3</span>, <span class="fl">90e3</span>, <span class="fl">180e3</span>)
  } <span class="cf">else</span> <span class="cf">if</span> (h <span class="op">&lt;</span><span class="st"> </span><span class="dv">9</span>) {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="fl">41e3</span>, <span class="fl">90e3</span>, <span class="fl">180e3</span>)
  } <span class="cf">else</span> {
    <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="fl">41e3</span>, <span class="fl">200e3</span>)
  }
}</code></pre></div>
<p>These functions increase the thresholds for the Medicare levy for low-income earners. Technically such measures have to be approved each financial year, but are as a matter of a routine.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @param x2018 A length-one for the 2018-19 number.</span>
<span class="co">#' @param fy The financial year</span>
.do_medicare_levy &lt;-<span class="st"> </span><span class="cf">function</span>(x2018, fy) {
  <span class="kw">stopifnot</span>(<span class="kw">length</span>(fy) <span class="op">==</span><span class="st"> </span>1L, <span class="kw"><a href="../../reference/is.fy.html">is.fy</a></span>(fy))
  <span class="cf">if</span> (fy <span class="op">==</span><span class="st"> "2018-19"</span>) {
    <span class="kw">return</span>(x2018)
  } <span class="cf">else</span> {
    <span class="kw">return</span>(<span class="kw">round</span>(<span class="kw"><a href="../../reference/cpi_inflator.html">cpi_inflator</a></span>(x2018, <span class="dt">from_fy =</span> <span class="st">"2018-19"</span>, <span class="dt">to_fy =</span> fy), <span class="op">-</span><span class="dv">1</span>))
  }
}

medicare_levy_lower_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">21980</span>, fy)
}

medicare_levy_lower_sapto_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">34758</span>, fy)
}

medicare_levy_lower_family_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">48385</span>, fy)
}

medicare_levy_lower_family_sapto_threshold &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">48385</span>, fy)
}

medicare_levy_lower_up_for_each_child &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  <span class="kw">.do_medicare_levy</span>(<span class="dv">3406</span>, fy)
}

.project_to &lt;-<span class="st"> </span><span class="cf">function</span>(h, use.Treasury) {
  <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>,
          <span class="dt">h =</span> h,
          <span class="dt">wage.series =</span> <span class="cf">if</span> (use.Treasury) wage_forecasts,
          <span class="dt">lf.series =</span> <span class="cf">if</span> (use.Treasury) lf_forecasts) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">setkey</span>(Taxable_Income)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useTreasurys &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>, .project_to, <span class="dt">use.Treasury =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useGrattans &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>, .project_to, <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_r80 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
             <span class="dt">i =</span> <span class="kw"><a href="../../reference/wage_inflator.html">wage_inflator</a></span>(<span class="dt">from_fy =</span> <span class="st">"2015-16"</span>,
                               <span class="dt">to_fy =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
                               <span class="dt">forecast.level =</span> <span class="dv">80</span>,
                               <span class="dt">forecast.series =</span> <span class="st">"upper"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, r <span class="op">:</span><span class="er">=</span><span class="st"> </span>i <span class="op">/</span><span class="st"> </span><span class="kw">shift</span>(i) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">is.na</span>(r), .(fy_year, r)]
  
wage_r20 &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">fy_year =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
             <span class="dt">i =</span> <span class="kw"><a href="../../reference/wage_inflator.html">wage_inflator</a></span>(<span class="dt">from_fy =</span> <span class="st">"2015-16"</span>,
                               <span class="dt">to_fy =</span> <span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="kw">c</span>(<span class="dv">2017</span><span class="op">:</span><span class="dv">2028</span>)),
                               <span class="dt">forecast.level =</span> <span class="dv">80</span>,
                               <span class="dt">forecast.series =</span> <span class="st">"lower"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, r <span class="op">:</span><span class="er">=</span><span class="st"> </span>i <span class="op">/</span><span class="st"> </span><span class="kw">shift</span>(i) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">is.na</span>(r), .(fy_year, r)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useGrattans80 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>, <span class="cf">function</span>(h) {
  <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> h, <span class="dt">wage.series =</span> wage_r80)
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">.project_useGrattans20 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>, <span class="cf">function</span>(h) {
  <span class="kw"><a href="../../reference/project.html">project</a></span>(sample_file_<span class="dv">1516</span>, <span class="dt">h =</span> h, <span class="dt">wage.series =</span> wage_r20)
})</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_Budgets &lt;-<span class="st"> </span><span class="cf">function</span>(fy_year, <span class="dt">use.Treasury =</span> <span class="ot">TRUE</span>, <span class="dt">.debug =</span> <span class="ot">FALSE</span>, <span class="dt">level =</span> <span class="ot">NULL</span>) { 
  h &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year) <span class="op">-</span><span class="st"> </span>2016L)
  
  <span class="cf">if</span> (use.Treasury) {
    s1920 &lt;-<span class="st"> </span>.project_useTreasurys[[h]]
  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.null</span>(level)) {
    s1920 &lt;-<span class="st"> </span>.project_useGrattans[[h]]
  } <span class="cf">else</span> <span class="cf">if</span> (level <span class="op">==</span><span class="st"> </span><span class="dv">20</span>) {
    s1920 &lt;-<span class="st"> </span>.project_useGrattans20[[h]]
  } <span class="cf">else</span> <span class="cf">if</span> (level <span class="op">==</span><span class="st"> </span><span class="dv">80</span>) {
    s1920 &lt;-<span class="st"> </span>.project_useGrattans80[[h]]
  }
  
  model_income_tax &lt;-<span class="st"> </span><span class="cf">function</span>(...,
                               <span class="dt">lamington =</span> <span class="ot">FALSE</span>,
                               <span class="dt">lito_202223 =</span> <span class="ot">FALSE</span>, 
                               <span class="dt">watr =</span> <span class="ot">FALSE</span>) {
    grattan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/grattan/topics/model_income_tax">model_income_tax</a></span>(
      <span class="dt">sample_file =</span> s1920, 
      <span class="dt">baseline_fy =</span> <span class="st">"2017-18"</span>,
      <span class="dt">medicare_levy_lower_threshold =</span> <span class="kw">medicare_levy_lower_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_sapto_threshold =</span> <span class="kw">medicare_levy_lower_sapto_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_family_threshold =</span> <span class="kw">medicare_levy_lower_family_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_family_sapto_threshold =</span> <span class="kw">medicare_levy_lower_family_sapto_threshold</span>(fy_year),
      <span class="dt">medicare_levy_lower_up_for_each_child =</span> <span class="kw">medicare_levy_lower_up_for_each_child</span>(fy_year),
      <span class="dt">warn_upper_thresholds =</span> <span class="ot">FALSE</span>,
      <span class="dt">Budget2018_lamington =</span> lamington,
      <span class="dt">Budget2018_lito_202223 =</span> lito_<span class="dv">202223</span>,
      <span class="dt">Budget2018_watr =</span> watr,
      ...) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, new_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(new_tax)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span>new_tax <span class="op">-</span><span class="st"> </span>baseline_tax] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">      </span>.[]
  }
  
  <span class="kw">list</span>(<span class="dt">Budget2018_baseline =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(),
       <span class="dt">Budget2018_baseline_brackets_cpi =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_thresholds =</span> <span class="kw"><a href="../../reference/cpi_inflator.html">cpi_inflator</a></span>(<span class="kw">ordinary_tax_thresholds</span>(<span class="dv">1</span>), <span class="dt">from_fy =</span> <span class="st">"2017-18"</span>, <span class="dt">to_fy =</span> fy_year)),
       <span class="dt">Budget2018_baseline_no_SBTO =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">sbto_discount =</span> <span class="dv">0</span>),
       <span class="dt">Budget2018_just_rates =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span>  <span class="kw">ordinary_tax_rates</span>(h),
                                                <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(h),
                                                <span class="dt">lito_202223 =</span> <span class="ot">FALSE</span>,
                                                <span class="dt">lamington =</span> <span class="ot">FALSE</span>),
       <span class="dt">Budget2018_just_LITO =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">lito_202223 =</span> h <span class="op">&gt;</span><span class="st"> </span><span class="dv">6</span>,
                                               <span class="dt">lamington =</span> <span class="ot">FALSE</span>),
       <span class="dt">Budget2018_just_LITO_and_rates =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span>  <span class="kw">ordinary_tax_rates</span>(h),
                                                         <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(h),
                                                         <span class="dt">lito_202223 =</span> h <span class="op">&gt;</span><span class="st"> </span><span class="dv">6</span>,
                                                         <span class="dt">lamington =</span> <span class="ot">FALSE</span>),
       <span class="dt">Budget2018_just_lamington =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">lamington =</span> <span class="ot">TRUE</span>),
       <span class="dt">Budget2018_lamington_plus_LITO =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">lito_202223 =</span> h <span class="op">&gt;</span><span class="st"> </span><span class="dv">6</span>,
                                                         <span class="dt">lamington =</span> fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2019-20"</span>, <span class="st">"2020-21"</span>, <span class="st">"2021-22"</span>)),
       <span class="dt">Budget2018_no_SBTO =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(h),
                                             <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(h),
                                             <span class="dt">lito_202223 =</span> h <span class="op">&gt;</span><span class="st"> </span><span class="dv">6</span>,
                                             <span class="dt">lamington =</span> fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2019-20"</span>, <span class="st">"2020-21"</span>, <span class="st">"2021-22"</span>), 
                                             <span class="dt">sbto_discount =</span> <span class="dv">0</span>),
       <span class="dt">Budget2018 =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(h),
                                     <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(h),
                                     <span class="dt">lito_202223 =</span> h <span class="op">&gt;</span><span class="st"> </span><span class="dv">6</span>,
                                     <span class="dt">lamington =</span> fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2019-20"</span>, <span class="st">"2020-21"</span>, <span class="st">"2021-22"</span>)),
       <span class="dt">ALP2018_no_SBTO =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="dv">3</span>), 
                                          <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="dv">3</span>),
                                          <span class="dt">sbto_discount =</span> <span class="dv">0</span>,
                                          <span class="dt">watr =</span> fy_year <span class="op">&gt;=</span><span class="st"> "2019-20"</span>),
       <span class="dt">ALP2018 =</span> <span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="dv">3</span>), 
                                  <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="dv">3</span>),
                                  <span class="dt">lamington =</span> fy_year <span class="op">&lt;</span><span class="st"> "2019-02"</span>,
                                  <span class="dt">watr =</span> fy_year <span class="op">&gt;=</span><span class="st"> "2019-20"</span>))
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Budget_<span class="dv">1922</span> &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>), model_Budgets)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Budget_1922_Grattan &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>), model_Budgets, <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Budget_1922_Grattan80 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>), model_Budgets, <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>, 
                                <span class="dt">level =</span> <span class="dv">80</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Budget_1922_Grattan20 &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>), model_Budgets, <span class="dt">use.Treasury =</span> <span class="ot">FALSE</span>, 
                                <span class="dt">level =</span> <span class="dv">20</span>)</code></pre></div>
<div id="costings-2018-19-to-2027-28-govt-and-grattan-forecasts" class="section level3">
<h3 class="hasAnchor">
<a href="#costings-2018-19-to-2027-28-govt-and-grattan-forecasts" class="anchor"></a>Costings 2018-19 to 2027-28 (Govt and Grattan forecasts)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(Budget_<span class="dv">1922</span>) &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>)
<span class="kw">names</span>(Budget_1922_Grattan) &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>)
{<span class="kw">sapply</span>(Budget_<span class="dv">1922</span>, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>} <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">round</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">caption =</span> <span class="st">"Budget costing under various settings, using the Budget paper's assumptions"</span>)</code></pre></div>
<table class="table">
<caption>Budget costing under various settings, using the Budget paper’s assumptions</caption>
<thead><tr class="header">
<th></th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Budget2018_baseline</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.13</td>
<td align="right">-0.18</td>
<td align="right">-0.22</td>
<td align="right">-0.25</td>
<td align="right">-0.29</td>
<td align="right">-0.32</td>
<td align="right">-0.35</td>
</tr>
<tr class="even">
<td>Budget2018_baseline_brackets_cpi</td>
<td align="right">-2.28</td>
<td align="right">-4.44</td>
<td align="right">-6.75</td>
<td align="right">-9.17</td>
<td align="right">-11.74</td>
<td align="right">-14.44</td>
<td align="right">-17.29</td>
<td align="right">-20.29</td>
<td align="right">-23.45</td>
<td align="right">-26.78</td>
</tr>
<tr class="odd">
<td>Budget2018_baseline_no_SBTO</td>
<td align="right">0.19</td>
<td align="right">0.15</td>
<td align="right">0.11</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">-0.01</td>
<td align="right">-0.05</td>
<td align="right">-0.08</td>
<td align="right">-0.11</td>
<td align="right">-0.14</td>
</tr>
<tr class="even">
<td>Budget2018_just_rates</td>
<td align="right">-0.39</td>
<td align="right">-0.46</td>
<td align="right">-0.54</td>
<td align="right">-0.62</td>
<td align="right">-5.89</td>
<td align="right">-6.11</td>
<td align="right">-17.42</td>
<td align="right">-18.58</td>
<td align="right">-19.80</td>
<td align="right">-21.08</td>
</tr>
<tr class="odd">
<td>Budget2018_just_LITO</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.13</td>
<td align="right">-0.68</td>
<td align="right">-0.71</td>
<td align="right">-0.74</td>
<td align="right">-0.77</td>
<td align="right">-0.79</td>
<td align="right">-0.81</td>
</tr>
<tr class="even">
<td>Budget2018_just_LITO_and_rates</td>
<td align="right">-0.39</td>
<td align="right">-0.46</td>
<td align="right">-0.54</td>
<td align="right">-0.62</td>
<td align="right">-6.39</td>
<td align="right">-6.61</td>
<td align="right">-17.90</td>
<td align="right">-19.05</td>
<td align="right">-20.27</td>
<td align="right">-21.54</td>
</tr>
<tr class="odd">
<td>Budget2018_just_lamington</td>
<td align="right">-3.79</td>
<td align="right">-3.90</td>
<td align="right">-4.00</td>
<td align="right">-4.09</td>
<td align="right">-4.17</td>
<td align="right">-4.24</td>
<td align="right">-4.30</td>
<td align="right">-4.35</td>
<td align="right">-4.40</td>
<td align="right">-4.44</td>
</tr>
<tr class="even">
<td>Budget2018_lamington_plus_LITO</td>
<td align="right">-3.79</td>
<td align="right">-3.90</td>
<td align="right">-4.00</td>
<td align="right">-4.09</td>
<td align="right">-0.68</td>
<td align="right">-0.71</td>
<td align="right">-0.74</td>
<td align="right">-0.77</td>
<td align="right">-0.79</td>
<td align="right">-0.81</td>
</tr>
<tr class="odd">
<td>Budget2018_no_SBTO</td>
<td align="right">-4.00</td>
<td align="right">-4.13</td>
<td align="right">-4.27</td>
<td align="right">-4.38</td>
<td align="right">-6.20</td>
<td align="right">-6.42</td>
<td align="right">-17.71</td>
<td align="right">-18.85</td>
<td align="right">-20.07</td>
<td align="right">-21.33</td>
</tr>
<tr class="even">
<td>Budget2018</td>
<td align="right">-4.18</td>
<td align="right">-4.32</td>
<td align="right">-4.45</td>
<td align="right">-4.57</td>
<td align="right">-6.39</td>
<td align="right">-6.61</td>
<td align="right">-17.90</td>
<td align="right">-19.05</td>
<td align="right">-20.27</td>
<td align="right">-21.54</td>
</tr>
<tr class="odd">
<td>ALP2018_no_SBTO</td>
<td align="right">-0.20</td>
<td align="right">-7.01</td>
<td align="right">-7.19</td>
<td align="right">-7.33</td>
<td align="right">-7.47</td>
<td align="right">-7.60</td>
<td align="right">-7.71</td>
<td align="right">-7.81</td>
<td align="right">-7.91</td>
<td align="right">-7.99</td>
</tr>
<tr class="even">
<td>ALP2018</td>
<td align="right">-4.18</td>
<td align="right">-7.19</td>
<td align="right">-7.37</td>
<td align="right">-7.52</td>
<td align="right">-7.66</td>
<td align="right">-7.79</td>
<td align="right">-7.90</td>
<td align="right">-8.01</td>
<td align="right">-8.10</td>
<td align="right">-8.19</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">round</span>(<span class="kw">sapply</span>(Budget_1922_Grattan, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>), 
      <span class="dt">caption =</span> <span class="st">"Budget costing under various settings, using the default Grattan forecasts"</span>)</code></pre></div>
<table class="table">
<caption>Budget costing under various settings, using the default Grattan forecasts</caption>
<thead><tr class="header">
<th></th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Budget2018_baseline</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.14</td>
<td align="right">-0.18</td>
<td align="right">-0.23</td>
<td align="right">-0.28</td>
<td align="right">-0.33</td>
<td align="right">-0.38</td>
<td align="right">-0.43</td>
</tr>
<tr class="even">
<td>Budget2018_baseline_brackets_cpi</td>
<td align="right">-2.20</td>
<td align="right">-4.27</td>
<td align="right">-6.45</td>
<td align="right">-8.73</td>
<td align="right">-11.12</td>
<td align="right">-13.62</td>
<td align="right">-16.23</td>
<td align="right">-18.94</td>
<td align="right">-21.77</td>
<td align="right">-24.69</td>
</tr>
<tr class="odd">
<td>Budget2018_baseline_no_SBTO</td>
<td align="right">0.18</td>
<td align="right">0.14</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">-0.03</td>
<td align="right">-0.07</td>
<td align="right">-0.12</td>
<td align="right">-0.16</td>
<td align="right">-0.21</td>
</tr>
<tr class="even">
<td>Budget2018_just_rates</td>
<td align="right">-0.37</td>
<td align="right">-0.44</td>
<td align="right">-0.51</td>
<td align="right">-0.57</td>
<td align="right">-5.64</td>
<td align="right">-5.85</td>
<td align="right">-15.16</td>
<td align="right">-15.90</td>
<td align="right">-16.66</td>
<td align="right">-17.43</td>
</tr>
<tr class="odd">
<td>Budget2018_just_LITO</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.14</td>
<td align="right">-0.72</td>
<td align="right">-0.77</td>
<td align="right">-0.82</td>
<td align="right">-0.87</td>
<td align="right">-0.92</td>
<td align="right">-0.97</td>
</tr>
<tr class="even">
<td>Budget2018_just_LITO_and_rates</td>
<td align="right">-0.37</td>
<td align="right">-0.44</td>
<td align="right">-0.51</td>
<td align="right">-0.57</td>
<td align="right">-6.17</td>
<td align="right">-6.39</td>
<td align="right">-15.70</td>
<td align="right">-16.44</td>
<td align="right">-17.20</td>
<td align="right">-17.97</td>
</tr>
<tr class="odd">
<td>Budget2018_just_lamington</td>
<td align="right">-3.70</td>
<td align="right">-3.82</td>
<td align="right">-3.94</td>
<td align="right">-4.06</td>
<td align="right">-4.18</td>
<td align="right">-4.29</td>
<td align="right">-4.41</td>
<td align="right">-4.52</td>
<td align="right">-4.63</td>
<td align="right">-4.74</td>
</tr>
<tr class="even">
<td>Budget2018_lamington_plus_LITO</td>
<td align="right">-3.70</td>
<td align="right">-3.82</td>
<td align="right">-3.94</td>
<td align="right">-4.06</td>
<td align="right">-0.72</td>
<td align="right">-0.77</td>
<td align="right">-0.82</td>
<td align="right">-0.87</td>
<td align="right">-0.92</td>
<td align="right">-0.97</td>
</tr>
<tr class="odd">
<td>Budget2018_no_SBTO</td>
<td align="right">-3.89</td>
<td align="right">-4.03</td>
<td align="right">-4.17</td>
<td align="right">-4.31</td>
<td align="right">-5.98</td>
<td align="right">-6.19</td>
<td align="right">-15.50</td>
<td align="right">-16.24</td>
<td align="right">-16.99</td>
<td align="right">-17.76</td>
</tr>
<tr class="even">
<td>Budget2018</td>
<td align="right">-4.07</td>
<td align="right">-4.21</td>
<td align="right">-4.36</td>
<td align="right">-4.50</td>
<td align="right">-6.17</td>
<td align="right">-6.39</td>
<td align="right">-15.70</td>
<td align="right">-16.44</td>
<td align="right">-17.20</td>
<td align="right">-17.97</td>
</tr>
<tr class="odd">
<td>ALP2018_no_SBTO</td>
<td align="right">-0.19</td>
<td align="right">-6.85</td>
<td align="right">-7.04</td>
<td align="right">-7.24</td>
<td align="right">-7.43</td>
<td align="right">-7.61</td>
<td align="right">-7.80</td>
<td align="right">-7.98</td>
<td align="right">-8.16</td>
<td align="right">-8.34</td>
</tr>
<tr class="even">
<td>ALP2018</td>
<td align="right">-4.07</td>
<td align="right">-7.03</td>
<td align="right">-7.23</td>
<td align="right">-7.42</td>
<td align="right">-7.61</td>
<td align="right">-7.80</td>
<td align="right">-7.99</td>
<td align="right">-8.18</td>
<td align="right">-8.36</td>
<td align="right">-8.55</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(Budget_1922_Grattan80) &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>)
<span class="kw">kable</span>(<span class="kw">round</span>(<span class="kw">sapply</span>(Budget_1922_Grattan80, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>), 
      <span class="dt">caption =</span> <span class="st">"Budget costing under various settings, using Grattan's 80% optimistic wage forecasts"</span>)</code></pre></div>
<table class="table">
<caption>Budget costing under various settings, using Grattan’s 80% optimistic wage forecasts</caption>
<thead><tr class="header">
<th></th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Budget2018_baseline</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.13</td>
<td align="right">-0.18</td>
<td align="right">-0.22</td>
<td align="right">-0.27</td>
<td align="right">-0.31</td>
<td align="right">-0.35</td>
<td align="right">-0.39</td>
</tr>
<tr class="even">
<td>Budget2018_baseline_brackets_cpi</td>
<td align="right">-2.21</td>
<td align="right">-4.31</td>
<td align="right">-6.54</td>
<td align="right">-8.90</td>
<td align="right">-11.41</td>
<td align="right">-14.06</td>
<td align="right">-16.85</td>
<td align="right">-19.79</td>
<td align="right">-22.89</td>
<td align="right">-26.13</td>
</tr>
<tr class="odd">
<td>Budget2018_baseline_no_SBTO</td>
<td align="right">0.18</td>
<td align="right">0.14</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">-0.02</td>
<td align="right">-0.06</td>
<td align="right">-0.10</td>
<td align="right">-0.14</td>
<td align="right">-0.18</td>
</tr>
<tr class="even">
<td>Budget2018_just_rates</td>
<td align="right">-0.38</td>
<td align="right">-0.45</td>
<td align="right">-0.52</td>
<td align="right">-0.59</td>
<td align="right">-5.75</td>
<td align="right">-6.00</td>
<td align="right">-16.40</td>
<td align="right">-17.42</td>
<td align="right">-18.49</td>
<td align="right">-19.60</td>
</tr>
<tr class="odd">
<td>Budget2018_just_LITO</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.13</td>
<td align="right">-0.70</td>
<td align="right">-0.74</td>
<td align="right">-0.78</td>
<td align="right">-0.82</td>
<td align="right">-0.86</td>
<td align="right">-0.89</td>
</tr>
<tr class="even">
<td>Budget2018_just_LITO_and_rates</td>
<td align="right">-0.38</td>
<td align="right">-0.45</td>
<td align="right">-0.52</td>
<td align="right">-0.59</td>
<td align="right">-6.27</td>
<td align="right">-6.51</td>
<td align="right">-16.91</td>
<td align="right">-17.93</td>
<td align="right">-19.00</td>
<td align="right">-20.10</td>
</tr>
<tr class="odd">
<td>Budget2018_just_lamington</td>
<td align="right">-3.70</td>
<td align="right">-3.82</td>
<td align="right">-3.94</td>
<td align="right">-4.05</td>
<td align="right">-4.16</td>
<td align="right">-4.27</td>
<td align="right">-4.37</td>
<td align="right">-4.46</td>
<td align="right">-4.55</td>
<td align="right">-4.64</td>
</tr>
<tr class="even">
<td>Budget2018_lamington_plus_LITO</td>
<td align="right">-3.70</td>
<td align="right">-3.82</td>
<td align="right">-3.94</td>
<td align="right">-4.05</td>
<td align="right">-0.70</td>
<td align="right">-0.74</td>
<td align="right">-0.78</td>
<td align="right">-0.82</td>
<td align="right">-0.86</td>
<td align="right">-0.89</td>
</tr>
<tr class="odd">
<td>Budget2018_no_SBTO</td>
<td align="right">-3.90</td>
<td align="right">-4.04</td>
<td align="right">-4.19</td>
<td align="right">-4.32</td>
<td align="right">-6.08</td>
<td align="right">-6.32</td>
<td align="right">-16.71</td>
<td align="right">-17.73</td>
<td align="right">-18.79</td>
<td align="right">-19.89</td>
</tr>
<tr class="even">
<td>Budget2018</td>
<td align="right">-4.08</td>
<td align="right">-4.22</td>
<td align="right">-4.37</td>
<td align="right">-4.51</td>
<td align="right">-6.27</td>
<td align="right">-6.51</td>
<td align="right">-16.91</td>
<td align="right">-17.93</td>
<td align="right">-19.00</td>
<td align="right">-20.10</td>
</tr>
<tr class="odd">
<td>ALP2018_no_SBTO</td>
<td align="right">-0.19</td>
<td align="right">-6.86</td>
<td align="right">-7.06</td>
<td align="right">-7.25</td>
<td align="right">-7.44</td>
<td align="right">-7.62</td>
<td align="right">-7.79</td>
<td align="right">-7.95</td>
<td align="right">-8.11</td>
<td align="right">-8.26</td>
</tr>
<tr class="even">
<td>ALP2018</td>
<td align="right">-4.08</td>
<td align="right">-7.04</td>
<td align="right">-7.24</td>
<td align="right">-7.43</td>
<td align="right">-7.62</td>
<td align="right">-7.81</td>
<td align="right">-7.98</td>
<td align="right">-8.15</td>
<td align="right">-8.31</td>
<td align="right">-8.46</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(Budget_1922_Grattan20) &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">yr2fy</a></span>(<span class="dv">2019</span><span class="op">:</span><span class="dv">2028</span>)
<span class="kw">kable</span>(<span class="kw">round</span>(<span class="kw">sapply</span>(Budget_1922_Grattan20, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>), 
      <span class="dt">caption =</span> <span class="st">"Budget costing under various settings, using Grattan's 20% pessimistic wage forecasts"</span>)</code></pre></div>
<table class="table">
<caption>Budget costing under various settings, using Grattan’s 20% pessimistic wage forecasts</caption>
<thead><tr class="header">
<th></th>
<th align="right">2018-19</th>
<th align="right">2019-20</th>
<th align="right">2020-21</th>
<th align="right">2021-22</th>
<th align="right">2022-23</th>
<th align="right">2023-24</th>
<th align="right">2024-25</th>
<th align="right">2025-26</th>
<th align="right">2026-27</th>
<th align="right">2027-28</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Budget2018_baseline</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.14</td>
<td align="right">-0.19</td>
<td align="right">-0.24</td>
<td align="right">-0.29</td>
<td align="right">-0.34</td>
<td align="right">-0.39</td>
<td align="right">-0.45</td>
</tr>
<tr class="even">
<td>Budget2018_baseline_brackets_cpi</td>
<td align="right">-2.19</td>
<td align="right">-4.23</td>
<td align="right">-6.36</td>
<td align="right">-8.55</td>
<td align="right">-10.83</td>
<td align="right">-13.17</td>
<td align="right">-15.58</td>
<td align="right">-18.04</td>
<td align="right">-20.57</td>
<td align="right">-23.15</td>
</tr>
<tr class="odd">
<td>Budget2018_baseline_no_SBTO</td>
<td align="right">0.18</td>
<td align="right">0.14</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">0.01</td>
<td align="right">-0.03</td>
<td align="right">-0.08</td>
<td align="right">-0.13</td>
<td align="right">-0.18</td>
<td align="right">-0.23</td>
</tr>
<tr class="even">
<td>Budget2018_just_rates</td>
<td align="right">-0.37</td>
<td align="right">-0.43</td>
<td align="right">-0.49</td>
<td align="right">-0.56</td>
<td align="right">-5.51</td>
<td align="right">-5.69</td>
<td align="right">-13.95</td>
<td align="right">-14.41</td>
<td align="right">-14.86</td>
<td align="right">-15.30</td>
</tr>
<tr class="odd">
<td>Budget2018_just_LITO</td>
<td align="right">0.00</td>
<td align="right">-0.05</td>
<td align="right">-0.09</td>
<td align="right">-0.14</td>
<td align="right">-0.74</td>
<td align="right">-0.79</td>
<td align="right">-0.85</td>
<td align="right">-0.91</td>
<td align="right">-0.97</td>
<td align="right">-1.03</td>
</tr>
<tr class="even">
<td>Budget2018_just_LITO_and_rates</td>
<td align="right">-0.37</td>
<td align="right">-0.43</td>
<td align="right">-0.49</td>
<td align="right">-0.56</td>
<td align="right">-6.06</td>
<td align="right">-6.25</td>
<td align="right">-14.52</td>
<td align="right">-14.98</td>
<td align="right">-15.44</td>
<td align="right">-15.88</td>
</tr>
<tr class="odd">
<td>Budget2018_just_lamington</td>
<td align="right">-3.70</td>
<td align="right">-3.82</td>
<td align="right">-3.94</td>
<td align="right">-4.06</td>
<td align="right">-4.18</td>
<td align="right">-4.30</td>
<td align="right">-4.42</td>
<td align="right">-4.55</td>
<td align="right">-4.67</td>
<td align="right">-4.80</td>
</tr>
<tr class="even">
<td>Budget2018_lamington_plus_LITO</td>
<td align="right">-3.70</td>
<td align="right">-3.82</td>
<td align="right">-3.94</td>
<td align="right">-4.06</td>
<td align="right">-0.74</td>
<td align="right">-0.79</td>
<td align="right">-0.85</td>
<td align="right">-0.91</td>
<td align="right">-0.97</td>
<td align="right">-1.03</td>
</tr>
<tr class="odd">
<td>Budget2018_no_SBTO</td>
<td align="right">-3.89</td>
<td align="right">-4.02</td>
<td align="right">-4.16</td>
<td align="right">-4.29</td>
<td align="right">-5.87</td>
<td align="right">-6.05</td>
<td align="right">-14.32</td>
<td align="right">-14.77</td>
<td align="right">-15.23</td>
<td align="right">-15.67</td>
</tr>
<tr class="even">
<td>Budget2018</td>
<td align="right">-4.07</td>
<td align="right">-4.20</td>
<td align="right">-4.34</td>
<td align="right">-4.48</td>
<td align="right">-6.06</td>
<td align="right">-6.25</td>
<td align="right">-14.52</td>
<td align="right">-14.98</td>
<td align="right">-15.44</td>
<td align="right">-15.88</td>
</tr>
<tr class="odd">
<td>ALP2018_no_SBTO</td>
<td align="right">-0.18</td>
<td align="right">-6.84</td>
<td align="right">-7.03</td>
<td align="right">-7.21</td>
<td align="right">-7.40</td>
<td align="right">-7.59</td>
<td align="right">-7.78</td>
<td align="right">-7.96</td>
<td align="right">-8.15</td>
<td align="right">-8.34</td>
</tr>
<tr class="even">
<td>ALP2018</td>
<td align="right">-4.07</td>
<td align="right">-7.01</td>
<td align="right">-7.21</td>
<td align="right">-7.40</td>
<td align="right">-7.59</td>
<td align="right">-7.78</td>
<td align="right">-7.97</td>
<td align="right">-8.16</td>
<td align="right">-8.35</td>
<td align="right">-8.54</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(Budget_<span class="dv">1922</span>, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>rowSums <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">divide_by</span>(<span class="fl">1e9</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>kable</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Budget2018_baseline</td>
<td align="right">-1.8812235</td>
</tr>
<tr class="even">
<td>Budget2018_baseline_brackets_cpi</td>
<td align="right">-136.6171602</td>
</tr>
<tr class="odd">
<td>Budget2018_baseline_no_SBTO</td>
<td align="right">0.1334656</td>
</tr>
<tr class="even">
<td>Budget2018_just_rates</td>
<td align="right">-90.8877016</td>
</tr>
<tr class="odd">
<td>Budget2018_just_LITO</td>
<td align="right">-4.7745694</td>
</tr>
<tr class="even">
<td>Budget2018_just_LITO_and_rates</td>
<td align="right">-93.7811173</td>
</tr>
<tr class="odd">
<td>Budget2018_just_lamington</td>
<td align="right">-41.6702567</td>
</tr>
<tr class="even">
<td>Budget2018_lamington_plus_LITO</td>
<td align="right">-20.2884170</td>
</tr>
<tr class="odd">
<td>Budget2018_no_SBTO</td>
<td align="right">-107.3579413</td>
</tr>
<tr class="even">
<td>Budget2018</td>
<td align="right">-109.2950203</td>
</tr>
<tr class="odd">
<td>ALP2018_no_SBTO</td>
<td align="right">-68.2179170</td>
</tr>
<tr class="even">
<td>ALP2018</td>
<td align="right">-73.9072620</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(Budget_1922_Grattan, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>rowSums <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">divide_by</span>(<span class="fl">1e9</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>kable</code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">x</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Budget2018_baseline</td>
<td align="right">-2.0965981</td>
</tr>
<tr class="even">
<td>Budget2018_baseline_brackets_cpi</td>
<td align="right">-128.0254601</td>
</tr>
<tr class="odd">
<td>Budget2018_baseline_no_SBTO</td>
<td align="right">-0.0773124</td>
</tr>
<tr class="even">
<td>Budget2018_just_rates</td>
<td align="right">-78.5322580</td>
</tr>
<tr class="odd">
<td>Budget2018_just_LITO</td>
<td align="right">-5.3234925</td>
</tr>
<tr class="even">
<td>Budget2018_just_LITO_and_rates</td>
<td align="right">-81.7592156</td>
</tr>
<tr class="odd">
<td>Budget2018_just_lamington</td>
<td align="right">-42.2930845</td>
</tr>
<tr class="even">
<td>Budget2018_lamington_plus_LITO</td>
<td align="right">-20.5694087</td>
</tr>
<tr class="odd">
<td>Budget2018_no_SBTO</td>
<td align="right">-95.0640352</td>
</tr>
<tr class="even">
<td>Budget2018</td>
<td align="right">-97.0051962</td>
</tr>
<tr class="odd">
<td>ALP2018_no_SBTO</td>
<td align="right">-68.6390267</td>
</tr>
<tr class="even">
<td>ALP2018</td>
<td align="right">-74.2376411</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">write.csv</span>(<span class="kw">round</span>(<span class="kw">sapply</span>(Budget_<span class="dv">1922</span>, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>), 
          <span class="st">"Budget201718-summaries-2.csv"</span>)
<span class="kw">write.csv</span>(<span class="kw">round</span>(<span class="kw">sapply</span>(Budget_1922_Grattan, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>), 
          <span class="st">"Budget201718-Grattan-summaries.csv"</span>)
<span class="kw">write.csv</span>(<span class="kw">round</span>(<span class="kw">sapply</span>(Budget_1922_Grattan80, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>), 
          <span class="st">"Budget201718-Grattan-summaries-80pc.csv"</span>)
<span class="kw">write.csv</span>(<span class="kw">round</span>(<span class="kw">sapply</span>(Budget_1922_Grattan20, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>, <span class="dv">2</span>), 
          <span class="st">"Budget201718-Grattan-summaries-20pc.csv"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_individual_impact_by_Quintile_fy &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">lapply</span>(Budget_<span class="dv">1922</span>, <span class="cf">function</span>(x) {
    x[[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, Quintile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(<span class="kw">ceiling</span>(<span class="dv">5</span> <span class="op">*</span><span class="st"> </span>.I <span class="op">/</span><span class="st"> </span>.N),
                             <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">avg_delta =</span> <span class="kw">mean</span>(delta),
            <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
            <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
            <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
        keyby =<span class="st"> </span>.(Quintile)]
  }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">idcol =</span> <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, Quintile) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_delta, <span class="dv">2</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_individual_impact_by_Quintile_fy.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[] 

avg_individual_impact_by_Quintile_fy <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>,
             <span class="dt">y =</span> avg_delta,
             <span class="dt">fill =</span> Quintile),
         <span class="dt">reverse =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average individual impact"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">FALSE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.5</span>),
        <span class="dt">legend.position =</span> <span class="st">"right"</span>)</code></pre></div>
<p><img src="Budget2018-atlas/avg_individual_impact_by_Quintile_fy-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
Brackets &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">Breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">37e3</span>, <span class="fl">41e3</span>, <span class="fl">87e3</span>, <span class="fl">90e3</span>, <span class="fl">120e3</span>, <span class="fl">180e3</span>, <span class="fl">200e3</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(Breaks)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(Taxable_Income)

avg_individual_impact_by_Bracket_fy &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">lapply</span>(Budget_<span class="dv">1922</span>, <span class="cf">function</span>(x) {
    x[[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">      </span>Brackets[., roll=<span class="ot">TRUE</span>] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">avg_delta =</span> <span class="kw">mean</span>(delta),
            <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
            <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
        keyby =<span class="st"> </span>.(Breaks)]
  }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">idcol =</span> <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, Breaks) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] 

avg_individual_impact_by_Bracket_fy <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_delta, <span class="dv">2</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Income bracket"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(Breaks,
                                 <span class="dt">levels =</span> <span class="kw">unique</span>(Breaks),
                                 <span class="dt">labels =</span> <span class="kw">grattan_dollar</span>(<span class="kw">unique</span>(Breaks)),
                                 <span class="dt">ordered =</span> <span class="ot">TRUE</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>, <span class="dt">y =</span> avg_delta, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">Income bracket</span><span class="st">`</span>),
         <span class="dt">reverse =</span> <span class="ot">TRUE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average individual impact"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)
<span class="co">#&gt; I'm going off-piste: The Palette Of Nine is thine. May John have mercy on your soul.</span></code></pre></div>
<p><img src="Budget2018-atlas/avg_individual_impact_by_Quintile_fy-2.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">lapply</span>(Budget_<span class="dv">1922</span>, <span class="cf">function</span>(x) {
  x[[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">    </span>Brackets[., roll=<span class="ot">TRUE</span>] <span class="op">%&gt;%</span>
<span class="st">    </span>.[, .(<span class="dt">avg_delta =</span> <span class="kw">sum</span>(delta <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
          <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
          <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
      keyby =<span class="st"> </span>.(Breaks)]
}) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">idcol =</span> <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_delta, <span class="dv">2</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">order</span>(<span class="op">-</span>Breaks)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Incomes above"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(Breaks,
                                <span class="dt">levels =</span> <span class="kw">unique</span>(Breaks),
                                <span class="dt">labels =</span> <span class="kw">grattan_dollar</span>(<span class="kw">unique</span>(Breaks)),
                                <span class="dt">ordered =</span> <span class="ot">TRUE</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Financial year ending</span><span class="st">`</span>, <span class="dt">y =</span> avg_delta, <span class="dt">fill =</span> <span class="st">`</span><span class="dt">Incomes above</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Total revenue"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> grattan_dollar) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse =</span> <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)
<span class="co">#&gt; I'm going off-piste: The Palette Of Nine is thine. May John have mercy on your soul.</span></code></pre></div>
<p><img src="Budget2018-atlas/avg_individual_impact_by_Quintile_fy-3.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cost_by_policy &lt;-
<span class="st">  </span><span class="kw">sapply</span>(Budget_<span class="dv">1922</span>, sapply, revenue_foregone, <span class="dt">USE.NAMES =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>rowSums <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">divide_by</span>(<span class="fl">1e9</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cost_in_<span class="dv">202728</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(Budget_<span class="dv">1922</span>[[<span class="st">"2027-28"</span>]][[<span class="st">"Budget2018"</span>]], <span class="ot">FALSE</span>, <span class="dt">digits =</span> <span class="dv">0</span>)
cost_in_202728_top20 &lt;-<span class="st"> </span>
<span class="st">  </span>Budget_<span class="dv">1922</span>[[<span class="st">"2027-28"</span>]][[<span class="st">"Budget2018"</span>]][<span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">80</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(<span class="dt">revenue_positive =</span> <span class="ot">FALSE</span>, <span class="dt">digits =</span> <span class="dv">0</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">minIncome_by_decile &lt;-<span class="st"> </span>
<span class="st">  </span>s1718[, .(<span class="dt">minIncome =</span> <span class="kw">min</span>(Taxable_Income)), keyby =<span class="st"> </span>.(<span class="dt">Decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, minIncome <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">round</span>(minIncome, <span class="op">-</span><span class="dv">3</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy &lt;-<span class="st"> </span>
{
  <span class="kw">rbindlist</span>(
    <span class="kw">list</span>(
      <span class="st">"Budget2018"</span> =<span class="st"> </span>{
        <span class="kw">lapply</span>(Budget_<span class="dv">1922</span>, <span class="cf">function</span>(x) {
          x[[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">            </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">            </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
                  <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
                  <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
                  <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
                  <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
                  <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
              keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">100</span>))] <span class="op">%&gt;%</span>
<span class="st">            </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "Budget 2018"</span>]
        }) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">          </span><span class="kw">rbindlist</span>(<span class="dt">idcol =</span> <span class="st">"fy_year"</span>,
                    <span class="dt">use.names =</span> <span class="ot">TRUE</span>)
      },
      <span class="st">"Baseline"</span> =<span class="st"> </span>{
        <span class="kw">lapply</span>(Budget_<span class="dv">1922</span>, <span class="cf">function</span>(x) {
          x[[<span class="st">"Budget2018_baseline"</span>]] <span class="op">%&gt;%</span>
<span class="st">            </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">            </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
                  <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
                  <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
                  <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
                  <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
                  <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)),
              keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">100</span>))] <span class="op">%&gt;%</span>
<span class="st">            </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "Baseline"</span>]
        }) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">          </span><span class="kw">rbindlist</span>(<span class="dt">idcol =</span> <span class="st">"fy_year"</span>,
                    <span class="dt">use.names =</span> <span class="ot">TRUE</span>)
      },
      <span class="st">"Current"</span> =<span class="st"> </span>{
        sample_file_<span class="dv">1516</span> <span class="op">%&gt;%</span>
<span class="st">          </span><span class="kw"><a href="../../reference/project.html">project</a></span>(<span class="dt">h =</span> 2L, 
                  <span class="dt">fy.year.of.sample.file =</span> <span class="st">"2015-16"</span>) <span class="op">%&gt;%</span>
<span class="st">          </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(<span class="st">"2017-18"</span>) <span class="op">%&gt;%</span>
<span class="st">          </span><span class="co"># .[, tax := income_tax(Taxable_Income, "2017-18", .dots.ATO = .)] %&gt;%</span>
<span class="st">          </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(<span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)),
                <span class="dt">avg_tax_bill =</span> <span class="kw">mean</span>(new_tax),
                <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income),
                <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
                <span class="dt">total_tax =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>),
                <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income <span class="op">+</span><span class="st"> </span><span class="dv">0</span>)), 
            keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, <span class="dt">n =</span> <span class="dv">100</span>))] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, facet <span class="op">:</span><span class="er">=</span><span class="st"> "2017-18"</span>] <span class="op">%&gt;%</span>
<span class="st">          </span>.[, fy_year <span class="op">:</span><span class="er">=</span><span class="st">  "2017-18"</span>]
      }),
      <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, 
    <span class="dt">idcol =</span> <span class="st">"id"</span>)
  } <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(id, fy_year, Taxable_Income_percentile) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_tax_rate, <span class="dv">3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, total_tax <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total_tax, <span class="dv">3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"total_tax"</span>, <span class="st">"total_tax_bn"</span>) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="dt">file =</span> <span class="st">"avg_tax_rates-by-facet-percentile.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]


avg_tax_rates_by_percentile_facet_fy <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">range</span>(fy_year)] <span class="op">%T&gt;%</span>
<span class="st">  </span>{
    dot &lt;-<span class="st"> </span>.
    dot[, .(facet, fy_year, Taxable_Income_percentile, avg_tax_rate)] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">dcast.data.table</span>(Taxable_Income_percentile <span class="op">~</span><span class="st"> </span>facet <span class="op">+</span><span class="st"> </span>fy_year,
                       <span class="dt">value.var =</span> <span class="st">"avg_tax_rate"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">melt.data.table</span>(<span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">"Taxable_Income_percentile"</span>, <span class="st">"2017-18_2017-18"</span>)) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">setnames</span>(<span class="st">"2017-18_2017-18"</span>, <span class="st">"T201718"</span>) <span class="op">%&gt;%</span>
<span class="st">      </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span>value <span class="op">-</span><span class="st"> </span>T201718] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">fwrite</span>(<span class="st">"change-in-tax-rate-vs-201718-by-percentile.csv"</span>)
  } <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># dumb don't care</span>
<span class="st">  </span>.[, Decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income_percentile, <span class="dt">n =</span> <span class="dv">10</span>), by =<span class="st"> "facet"</span>] <span class="op">%T&gt;%</span>
<span class="st">  </span>{
    dot &lt;-<span class="st"> </span>.
    dot <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">total_tax_bn =</span> <span class="kw">sum</span>(total_tax_bn)), keyby =<span class="st"> </span>.(facet, Decile)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, <span class="st">"% tax paid"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>total_tax_bn <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_tax_bn), keyby =<span class="st"> "facet"</span>] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, <span class="kw">lapply</span>(.SD, signif, <span class="dv">3</span>), keyby =<span class="st"> </span>.(facet, Decile)] <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">fwrite</span>(<span class="st">"prop-tax-paid-by-facet-decile.csv"</span>)
  } <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_percentile, <span class="dt">y =</span> avg_tax_rate, <span class="dt">color =</span> facet)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Taxable income percentile"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),
        <span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">size =</span> <span class="fl">0.5</span>),
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Budget2018-atlas/unnamed-chunk-12-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decile2income &lt;-<span class="st"> </span><span class="cf">function</span>(d) {
  d &lt;-<span class="st"> </span><span class="kw">as.integer</span>(d)
  <span class="kw">grattan_dollar</span>(minIncome_by_decile[.(d)][[<span class="st">"minIncome"</span>]])
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cost_decile_fy &lt;-<span class="st"> </span><span class="cf">function</span>(decile, fy) {
  
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">texNumD &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">texNum</span>(x, <span class="dt">dollar =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>New Grattan Institute analysis highlights that most of the revenue reductions from the Turnbull Government’s full Personal Income Tax Plan are the result of lower taxes on high-income earners. Once the three-stage plan – including removing the 37c bracket – is complete, <strong>$15.5~billion</strong> of the annual <strong>$21.5~billion cost</strong> of the plan will result from collecting less tax from the top 20% of income earners, who currently have a taxable income of $68,000 or more.</p>
<p>The PIT plan will do little to unwind bracket creep’s gradual reduction of the progressivity of the tax system. Even with the PIT plan, average tax rates are forecast to be higher for all taxpayers in 2027-28 – except for very high-income earners who are effectively shielded from bracket creep by the plan. A taxpayer who earns $117,000 today (more than 90% of other taxpayers) will pay an average tax rate of 28.9% in 2027-28, unchanged from today. In contrast, average tax rates for middle-income earners will continue to rise. The average tax rate for a taxpayer who earns $27,000-a-year today (more than 30% of other taxpayers) will increase 6 percentage points (from 9.2% to 14.7% ). As a result, the highest-income taxpayers will bear a lower share of the total tax burden.</p>
<p><strong>Costing and distributional analysis of PIT plan </strong></p>
<p>The 2018-19 budget shows the annual cost of the PIT Plan until 2022. The Treasurer has indicated the ten-year cost of the plan is $140 billion. Grattan’s analysis shows the annual costs of the plan until 2028. The Grattan costing takes into account all elements of the PIT plan.</p>
<p>Most of the revenue reductions until 2021-22 are a result of the Low and Middle Income Tax Offset (“the Lamington”). But once the plan is fully implemented in 2024-25, there are much bigger revenue reductions because the top of the 32.5 cent bracket increases first to $120,000 and then to $200,000 (removing the 37c bracket). In 2028, these bracket changes account for <span class="math inline">\(-\)</span>$21.1~billion of the <span class="math inline">\(-\)</span>$21.5~billion in lower revenue.</p>
<p>Once fully implemented, most of the reduction in revenue under the PIT is retained by the top 20% of income earners, with a taxable income of $87,000 or more. In 2028, the reduction in tax collected from this group will account for <strong>$15 billion</strong> of the $25 billion cost of the plan.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Quintile and financial year to tax cut</span>
Qfy2Cut &lt;-<span class="st"> </span><span class="cf">function</span>(Quintile, fy) {
  q &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">as.integer</span>(Quintile), <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
  ans &lt;-<span class="st"> </span><span class="op">-</span><span class="dv">1</span><span class="op">*</span>avg_individual_impact_by_Quintile_fy[.(fy, q)][[<span class="st">"avg_delta"</span>]]
  <span class="kw">grattan_dollar</span>(<span class="kw">round</span>(ans, <span class="op">-</span><span class="dv">2</span>))
}</code></pre></div>
<p>By 2024-25, the income tax cuts are much larger for high-income earners, both in absolute terms and as a proportion of income. Those in the top 20 per cent will get an average tax cut of $4,600 a year, compared to $400 a year for someone in the second income quintile ($9,000 - $19,000).</p>
<p><strong>Impact of the PIT plan on tax system progressivity</strong></p>
<p>Australia’s progressive tax system ensures that people with higher incomes pay higher average rates of personal income tax. Without changes to tax scales, bracket creep gradually increases average tax rates for all taxpayers. Middle-income earners are affected most in terms of higher average tax rates.</p>
<p>The government claims the PIT plan protects middle-income Australians from bracket creep. Certainly the plan reduces average tax rates in 2027-28 for all taxpayers compared to what they would be if there were no changes to rates or brackets over that period.</p>
<p>But middle-income earners are not spared from bracket creep under the PIT plan. The average tax rate for a taxpayer at the 50<sup>th</sup> percentile will still increase by 5 percentage points (from 14.6% to 19.1% ) compared to 2017-18. Without further changes, average tax rates will be higher for most taxpayers.</p>
<p>The exception is the top 10% of income earners. Average tax rates for those on the highest incomes are virtually unchanged under this plan.</p>
<p>Once fully implemented, the PIT plan doesn’t change the progressivity of the tax system much. Overall, those on high incomes will pay a similar proportion of total tax revenues with or without the plan. But because of bracket creep, high income earners will be paying a lower proportion than today.</p>
<p><strong>Table 1: Share of personal income tax paid falls for highest income earners under PIT plan </strong></p>
<p>Share of total personal income tax paid by income decile (%)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">to_prop &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="cf">if</span> (<span class="kw">is.double</span>(x)) {
    <span class="kw">grattan_percent</span>(x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x), <span class="dt">.percent.suffix =</span> <span class="st">"%"</span>, <span class="dt">digits =</span> <span class="dv">1</span>)
  } <span class="cf">else</span> {
    x
  }
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot_tax =</span> <span class="kw">sum</span>(total_tax_bn)),
    keyby =<span class="st"> </span>.(id, fy_year, <span class="dt">Decile =</span> <span class="kw">ntile</span>(Taxable_Income_percentile, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2017-18"</span>, <span class="st">"2027-28"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast.data.table</span>(Decile <span class="op">~</span><span class="st"> </span>id <span class="op">+</span><span class="st"> </span>fy_year, <span class="dt">value.var =</span> <span class="st">"tot_tax"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="kw">lapply</span>(.SD, to_prop)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"share-total-personal-income-tax-per-decile.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">"rrrr"</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Decile</th>
<th align="right">Baseline_2027-28</th>
<th align="right">Budget2018_2027-28</th>
<th align="right">Current_2017-18</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.00%</td>
<td align="right">0.00%</td>
<td align="right">0.0%</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">0.04%</td>
<td align="right">0.02%</td>
<td align="right">0.0%</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">0.84%</td>
<td align="right">0.81%</td>
<td align="right">0.4%</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2.33%</td>
<td align="right">2.26%</td>
<td align="right">1.6%</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">4.29%</td>
<td align="right">4.30%</td>
<td align="right">3.4%</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">6.25%</td>
<td align="right">6.38%</td>
<td align="right">5.8%</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">8.67%</td>
<td align="right">8.92%</td>
<td align="right">8.5%</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">12.20%</td>
<td align="right">12.33%</td>
<td align="right">12.1%</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">17.88%</td>
<td align="right">17.65%</td>
<td align="right">17.8%</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">47.49%</td>
<td align="right">47.33%</td>
<td align="right">50.4%</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  (x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x))
}
scale10 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">scale01</span>(x)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Grey &lt;-<span class="st"> </span><span class="cf">function</span>(fy) {
  Alpha &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="kw">scale10</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy))
  out &lt;-<span class="st"> </span><span class="kw">grey</span>(<span class="kw">rep_len</span>(<span class="dv">1</span>, <span class="kw">length</span>(fy)))
  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(fy)) {
    out[i] &lt;-<span class="st"> </span><span class="kw">grey</span>(<span class="fl">0.7</span>, <span class="dt">alpha =</span> Alpha[i])
  }
  out
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Over65 <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(age_range <span class="op">&lt;=</span><span class="st"> </span>1L, Birth_year <span class="op">&lt;=</span><span class="st"> </span>1L)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(avg_tax_rate)), keyby =<span class="st"> </span>.(fy.year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"fy.year"</span>, <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(avg_tax_rates_by_percentile_facet_fy[, .SD, <span class="dt">.SDcols =</span> <span class="kw">c</span>(<span class="st">"id"</span>, <span class="kw">names</span>(.))],
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, Taxable_Income_percentile) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, z <span class="op">:</span><span class="er">=</span><span class="st"> </span>fy_year <span class="op">%ein%</span><span class="st"> "2017-18"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate_rel <span class="op">:</span><span class="er">=</span><span class="st"> </span>avg_tax_rate <span class="op">-</span><span class="st"> </span><span class="kw">median</span>(avg_tax_rate[z]),
    keyby =<span class="st"> </span>.(Taxable_Income_percentile)] <span class="op">%&gt;%</span>

<span class="st">  </span>.[, colour <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id),
                        <span class="kw">grey</span>(<span class="fl">0.5</span>), 
                        <span class="kw">if_else</span>(id <span class="op">==</span><span class="st"> "Baseline"</span> <span class="op">&amp;</span><span class="st"> </span>fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), 
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">4</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">5</span>]),
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">1</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">2</span>])))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, alpha <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id), <span class="fl">1.05</span> <span class="op">*</span><span class="st"> </span><span class="kw">scale01</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)), <span class="dv">1</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2004-05"</span>, <span class="st">"2013-14"</span>), <span class="kw">c</span>(<span class="st">"alpha"</span>, <span class="st">"colour"</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">list</span>(<span class="fl">0.8</span>, <span class="st">"black"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">implies</span>(<span class="op">!</span><span class="kw">is.na</span>(id), fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">0.8</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2004-05"</span>, <span class="st">"2013-14"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.4</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[Taxable_Income_percentile <span class="op">==</span><span class="st"> </span>50L <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(id), label <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(id, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="kw">as.character</span>(fy_year))] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># .[Taxable_Income_percentile == 95L &amp; !is.na(id), label := ""] %&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, group <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, colour)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, text <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, <span class="st">" "</span>, <span class="kw">coalesce</span>(id, <span class="st">""</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Percentile: "</span>, <span class="dt">width =</span> <span class="dv">24</span>), Taxable_Income_percentile, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Avg. tax rate (03-04 = 0):"</span>, <span class="dt">width =</span> <span class="dv">24</span>), <span class="st">" "</span>, <span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(avg_tax_rate_rel, <span class="dv">4</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"Taxable_Income_percentile"</span>, 
           <span class="st">"Taxable income percentile"</span>) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Average-tax-rates-relative-201718-vs-Taxable-income-percentile-by-FY.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.frame <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># .[Over65==FALSE] %&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Taxable income percentile</span><span class="st">`</span>,
             <span class="dt">y =</span> avg_tax_rate_rel,
             <span class="dt">colour =</span> colour,
             <span class="dt">group =</span> group,
             <span class="dt">text =</span> text)) <span class="op">+</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">"label"</span>,
           <span class="dt">x =</span> <span class="dv">20</span>,
           <span class="dt">y =</span> <span class="fl">0.09</span>, 
           <span class="dt">hjust =</span> <span class="dv">1</span>,
           <span class="dt">label.size =</span> <span class="ot">NA</span>,
           <span class="dt">label =</span> <span class="st">"2003-04"</span>,
           <span class="dt">fontface =</span> <span class="st">"bold"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">"label"</span>,
           <span class="dt">x =</span> <span class="dv">25</span>,
           <span class="dt">y =</span> <span class="op">-</span><span class="fl">0.04</span>,
           <span class="dt">hjust =</span> <span class="dv">1</span>,
           <span class="dt">label.size =</span> <span class="ot">NA</span>,
           <span class="dt">label =</span> <span class="st">"2013-14"</span>,
           <span class="dt">fontface =</span> <span class="st">"bold"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_alpha_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> alpha, <span class="dt">size =</span> size)) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_blank(aes(x = 105, y = 0)) +</span>
<span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label),
                   <span class="dt">nudge_x =</span> <span class="dv">2</span>, <span class="dt">force =</span> <span class="fl">0.8</span>,
                   <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,
                   <span class="dt">fontface =</span> <span class="st">"bold"</span>,
                   <span class="dt">label.size =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average tax rates relative to 2017-18"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>)
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour', which will replace the</span>
<span class="co">#&gt; existing scale.</span></code></pre></div>
<p><img src="Budget2018-atlas/unnamed-chunk-20-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sample_files_all <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(avg_tax_rate)), keyby =<span class="st"> </span>.(fy.year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"fy.year"</span>, <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(avg_tax_rates_by_percentile_facet_fy[, .SD, <span class="dt">.SDcols =</span> <span class="kw">c</span>(<span class="st">"id"</span>, <span class="kw">names</span>(.))],
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(fy_year, Taxable_Income_percentile) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate_rel <span class="op">:</span><span class="er">=</span><span class="st"> </span>avg_tax_rate <span class="op">-</span><span class="st"> </span><span class="kw">first</span>(avg_tax_rate),
    keyby =<span class="st"> </span>.(Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, colour <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id),
                        <span class="kw">grey</span>(<span class="fl">0.5</span>), 
                        <span class="kw">if_else</span>(id <span class="op">==</span><span class="st"> "Baseline"</span> <span class="op">&amp;</span><span class="st"> </span>fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), 
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">4</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">5</span>]),
                                <span class="kw">if_else</span>(fy_year <span class="op">==</span><span class="st"> "2018-19"</span>, 
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">1</span>],
                                        <span class="kw">gpal</span>(<span class="dv">6</span>)[<span class="dv">2</span>])))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, alpha <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">is.na</span>(id), <span class="fl">1.05</span> <span class="op">*</span><span class="st"> </span><span class="kw">scale01</span>(<span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)), <span class="dv">1</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># .[fy_year %in% c("2013-14"), c("alpha", "colour") := list(0.8, "black")] %&gt;%</span>
<span class="st">  </span>.[<span class="kw">implies</span>(<span class="op">!</span><span class="kw">is.na</span>(id), fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2017-18"</span>, <span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">0.8</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2004-05"</span>, <span class="st">"2013-14"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"2018-19"</span>, <span class="st">"2027-28"</span>), size <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="fl">1.4</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[Taxable_Income_percentile <span class="op">==</span><span class="st"> </span>50L <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(id), label <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(id, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>, <span class="kw">as.character</span>(fy_year))] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># .[Taxable_Income_percentile == 95L &amp; !is.na(id), label := ""] %&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, group <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, colour)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, text <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">paste0</span>(fy_year, <span class="st">" "</span>, <span class="kw">coalesce</span>(id, <span class="st">""</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Percentile: "</span>, <span class="dt">width =</span> <span class="dv">24</span>), Taxable_Income_percentile, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,
                     <span class="kw">formatC</span>(<span class="st">"Avg. tax rate (03-04 = 0):"</span>, <span class="dt">width =</span> <span class="dv">24</span>), <span class="st">" "</span>, <span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="kw">round</span>(avg_tax_rate_rel, <span class="dv">4</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setnames</span>(<span class="st">"Taxable_Income_percentile"</span>, 
           <span class="st">"Taxable income percentile"</span>) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Average-tax-rates-relative-200304-vs-Taxable-income-percentile-by-FY.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.frame <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># .[Over65==FALSE] %&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">Taxable income percentile</span><span class="st">`</span>,
             <span class="dt">y =</span> avg_tax_rate_rel,
             <span class="dt">colour =</span> colour,
             <span class="dt">group =</span> group,
             <span class="dt">text =</span> text)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_alpha_identity</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">size =</span> size)) <span class="op">+</span>
<span class="st">  </span><span class="co"># geom_blank(aes(x = 105, y = 0)) +</span>
<span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="kw">aes</span>(<span class="dt">label =</span> label),
                   <span class="dt">nudge_x =</span> <span class="dv">2</span>, <span class="dt">force =</span> <span class="fl">0.8</span>,
                   <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,
                   <span class="dt">fontface =</span> <span class="st">"bold"</span>,
                   <span class="dt">label.size =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">"Average tax rates relative to 2003-04"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>fy_year)
<span class="co">#&gt; Scale for 'colour' is already present. Adding another scale for 'colour', which will replace the</span>
<span class="co">#&gt; existing scale.</span></code></pre></div>
<p><img src="Budget2018-atlas/avg_tax_rate_by_percentile_fy_year_rel0304-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models &lt;-<span class="st"> </span>
<span class="st">  </span>Budget_<span class="dv">1922</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">lapply</span>(rbindlist, <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">idcol =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">idcol =</span> <span class="st">"fy_year"</span>)
bound_models_Grattan &lt;-<span class="st"> </span>
<span class="st">  </span>Budget_1922_Grattan <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">lapply</span>(rbindlist, <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">idcol =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">idcol =</span> <span class="st">"fy_year"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">==</span><span class="st"> "ALP2018"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, tax_saving <span class="op">:</span><span class="er">=</span><span class="st"> </span>baseline_tax <span class="op">-</span><span class="st"> </span>new_tax] <span class="op">%&gt;%</span>
<span class="st">  </span>.[Taxable_Income <span class="op">&lt;=</span><span class="st"> </span><span class="fl">300e3</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[fy_year <span class="op">%ein%</span><span class="st"> "2019-20"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[age_range <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tax_saving =</span> <span class="kw">mean</span>(tax_saving)),
    keyby =<span class="st"> </span>.(fy_year, <span class="dt">Taxable_Income =</span> <span class="kw">round</span>(Taxable_Income, <span class="op">-</span><span class="dv">3</span>))] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"ALP-proposal-201920-vs-taxable-income.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income, <span class="dt">y =</span> tax_saving, <span class="dt">color =</span> fy_year)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">"Taxable income"</span>, <span class="dt">labels =</span> grattan_dollar, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">225e3</span>)) 
<span class="co">#&gt; Warning: Removed 75 rows containing missing values (geom_path).</span></code></pre></div>
<p><img src="Budget2018-atlas/unnamed-chunk-22-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list</span>(
  {
    sample_files_all <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">new_tax =</span> tax), keyby =<span class="st"> </span>.(<span class="dt">fy_year =</span> fy.year, Taxable_Income)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, id <span class="op">:</span><span class="er">=</span><span class="st"> "Current"</span>] <span class="op">%&gt;%</span>
<span class="st">      </span>.[]
  },
  bound_models[, .(id, fy_year, Taxable_Income, new_tax)],
  s1718[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2017-18"</span>, Taxable_Income, new_tax)],
  s1617[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2016-17"</span>, Taxable_Income, new_tax)]
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>)  <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">progressivity =</span> <span class="kw"><a href="../../reference/progressivity.html">progressivity</a></span>(Taxable_Income, new_tax)), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"id"</span>, <span class="st">"fy_year"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">%chin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Budget2018"</span>, <span class="st">"Current"</span>, <span class="st">"Budget2018_baseline"</span>, <span class="st">"ALP2018"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Year <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">==</span><span class="st"> "Budget2018_baseline"</span>, id <span class="op">:</span><span class="er">=</span><span class="st"> "Baseline"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, progressivity <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(progressivity, <span class="dv">4</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"Reynolds-Smolensky-vs-year.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">grplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Year, <span class="dt">y =</span> progressivity, <span class="dt">color =</span> id, <span class="dt">group =</span> id)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">2005</span>, <span class="dv">2010</span>, <span class="dv">2015</span>, <span class="dv">2020</span>, <span class="dv">2025</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"right"</span>,
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="Budget2018-atlas/progressivities-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rates_by_percentile_facet_fy_historical &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">list</span>(
  {
    sample_files_all <span class="op">%&gt;%</span>
<span class="st">      </span>.[, .(<span class="dt">new_tax =</span> tax), keyby =<span class="st"> </span>.(<span class="dt">fy_year =</span> fy.year, Taxable_Income)] <span class="op">%&gt;%</span>
<span class="st">      </span>.[, id <span class="op">:</span><span class="er">=</span><span class="st"> "Current"</span>] <span class="op">%&gt;%</span>
<span class="st">      </span>.[]
  },
  bound_models[, .(id, fy_year, Taxable_Income, new_tax)],
  s1718[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2017-18"</span>, Taxable_Income, new_tax)],
  s1617[, .(<span class="dt">id =</span> <span class="st">"Current"</span>, <span class="dt">fy_year =</span> <span class="st">"2016-17"</span>, Taxable_Income, new_tax)]
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>,
            <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>),
    keyby =<span class="st"> </span>.(id, fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, new_avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">new_avg_tax_rate =</span> <span class="kw">mean</span>(new_avg_tax_rate)), 
    keyby =<span class="st"> </span>.(fy_year, id, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">implies</span>(id <span class="op">%pin%</span><span class="st"> "_"</span>, <span class="kw">endsWith</span>(id, <span class="st">"baseline"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">%pin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"aseline"</span>, <span class="st">"urrent"</span>), id <span class="op">:</span><span class="er">=</span><span class="st"> "Baseline/Current"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[<span class="kw">order</span>(fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast</span>(fy_year <span class="op">+</span><span class="st"> </span>id <span class="op">~</span><span class="st"> </span>Taxable_Income_percentile, <span class="dt">value.var =</span> <span class="st">"new_avg_tax_rate"</span>, <span class="dt">FUN =</span> identity) <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg-tax-rate-wide-by-model-fy_year.tsv"</span>, <span class="dt">quote =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
</div>
</div>
<div id="effect-of-sbto" class="section level2">
<h2 class="hasAnchor">
<a href="#effect-of-sbto" class="anchor"></a>Effect of SBTO</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fastmatch)
bound_models[id <span class="op">%ein%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Budget2018"</span>, <span class="st">"ALP2018"</span>,
                        <span class="st">"Budget2018_no_SBTO"</span>, <span class="st">"ALP2018_no_SBTO"</span>,
                        <span class="st">"Budget2018_baseline"</span>, <span class="st">"Budget2018_baseline_no_SBTO"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">revenue =</span> <span class="kw">sum</span>(delta), <span class="dt">WEIGHT =</span> <span class="kw">first</span>(WEIGHT)), keyby =<span class="st"> </span>.(id, fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, SBTO <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">if_else</span>(<span class="kw">endsWith</span>(id, <span class="st">"no_SBTO"</span>), <span class="st">"No SBTO"</span>, <span class="st">"With SBTO"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, policy <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">sub</span>(<span class="st">"_no_SBTO"</span>, <span class="st">""</span>, id)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, revenue_bn <span class="op">:</span><span class="er">=</span><span class="st"> </span>revenue <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, revenue <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(policy, fy_year, SBTO, revenue_bn)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast</span>(policy <span class="op">+</span><span class="st"> </span>fy_year <span class="op">~</span><span class="st"> </span>SBTO, <span class="dt">value.var =</span> <span class="st">"revenue_bn"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> `</span><span class="dt">With SBTO</span><span class="st">`</span> <span class="op">-</span><span class="st"> `</span><span class="dt">No SBTO</span><span class="st">`</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> fy_year, <span class="dt">y =</span> delta, <span class="dt">fill =</span> policy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">"dodge"</span>)</code></pre></div>
<p><img src="Budget2018-atlas/unnamed-chunk-24-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models[id <span class="op">%ein%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Budget2018"</span>, <span class="st">"ALP2018"</span>,
                        <span class="st">"Budget2018_no_SBTO"</span>, <span class="st">"ALP2018_no_SBTO"</span>,
                        <span class="st">"Budget2018_baseline"</span>, <span class="st">"Budget2018_baseline_no_SBTO"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[,
    Taxable_Income_percentile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income <span class="op">+</span><span class="st"> </span>Total_PP_BE_amt <span class="op">+</span><span class="st"> </span>Total_NPP_BE_amt, <span class="dv">100</span>),
    keyby =<span class="st"> </span>.(id, fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">delta =</span> <span class="kw">sum</span>(delta)), keyby =<span class="st"> </span>.(id, fy_year, Taxable_Income_percentile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, p <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(delta <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(delta), <span class="dv">0</span>), keyby =<span class="st"> </span>.(id, fy_year)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, SBTO <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">tolower</span>(<span class="kw">endsWith</span>(id, <span class="st">"_no_SBTO"</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, policy <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">sub</span>(<span class="st">"_no_SBTO"</span>, <span class="st">""</span>, .BY[[1L]], <span class="dt">fixed =</span> <span class="ot">TRUE</span>), by =<span class="st"> "id"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dcast</span>(Taxable_Income_percentile <span class="op">+</span><span class="st"> </span>policy <span class="op">+</span><span class="st"> </span>fy_year <span class="op">~</span><span class="st"> </span>SBTO, <span class="dt">value.var =</span> <span class="st">"p"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, revi <span class="op">:</span><span class="er">=</span><span class="st"> </span>true <span class="op">-</span><span class="st"> </span>false] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_percentile, <span class="dt">y =</span> revi, <span class="dt">color =</span> fy_year)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>policy) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() </code></pre></div>
<p><img src="Budget2018-atlas/unnamed-chunk-25-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s202728_in_<span class="dv">1920</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1819,
                   <span class="st">"2017-18"</span>, 
                   <span class="dt">ordinary_tax_rates =</span> <span class="kw">ordinary_tax_rates</span>(<span class="dv">10</span>), 
                   <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">ordinary_tax_thresholds</span>(<span class="dv">10</span>),
                   <span class="dt">Budget2018_lamington =</span> <span class="ot">TRUE</span>,
                   <span class="dt">Budget2018_lito_202223 =</span> <span class="ot">TRUE</span>)
alternative &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1819, 
                   <span class="st">"2017-18"</span>, 
                   <span class="dt">ordinary_tax_rates =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span>, <span class="fl">0.325</span>, <span class="fl">0.37</span>, <span class="fl">0.45</span>), 
                   <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="dv">37000</span>, <span class="dv">90000</span>, <span class="dv">180000</span>))

r1 &lt;-<span class="st"> </span><span class="dv">0</span>
<span class="cf">while</span> (r1 <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(alternative) <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(s202728_in_<span class="dv">1920</span>)) {
  <span class="kw">print</span>(<span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(alternative))
  r1 &lt;-<span class="st"> </span>r1 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
  alternative &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="../../reference/model_income_tax.html">model_income_tax</a></span>(s1819, 
                     <span class="st">"2017-18"</span>, 
                     <span class="dt">ordinary_tax_rates =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.19</span> <span class="op">-</span><span class="st"> </span>r1<span class="op">/</span><span class="dv">200</span>, <span class="fl">0.325</span> <span class="op">-</span><span class="st"> </span>r1<span class="op">/</span><span class="dv">200</span>, <span class="fl">0.37</span>, <span class="fl">0.45</span>), 
                     <span class="dt">ordinary_tax_thresholds =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">18200</span>, <span class="dv">37000</span>, <span class="dv">90000</span>, <span class="dv">180000</span>))
}
<span class="co">#&gt; [1] "-\\$373 million"</span>
<span class="co">#&gt; [1] "-\\$2.7 billion"</span>
<span class="co">#&gt; [1] "-\\$4.9 billion"</span>
<span class="co">#&gt; [1] "-\\$7.2 billion"</span>
<span class="co">#&gt; [1] "-\\$9.5 billion"</span>
<span class="co">#&gt; [1] "-\\$12 billion"</span>
<span class="co">#&gt; [1] "-\\$14 billion"</span>

alternative <span class="op">%&gt;%</span>
<span class="st">  </span>.[, new_avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, old_avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(baseline_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, delta <span class="op">:</span><span class="er">=</span><span class="st"> </span>new_tax <span class="op">-</span><span class="st"> </span>baseline_tax] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">old_avg_tax_rate =</span> <span class="kw">mean</span>(old_avg_tax_rate),
        <span class="dt">new_avg_tax_rate =</span> <span class="kw">mean</span>(new_avg_tax_rate),
        <span class="dt">avg_delta =</span> <span class="kw">mean</span>(delta)),
    keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt</span>(<span class="dt">id.vars =</span> <span class="kw">c</span>(<span class="st">"Taxable_Income_percentile"</span>, <span class="st">"avg_delta"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, variable <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(variable, <span class="dt">levels =</span> <span class="kw">unique</span>(.<span class="op">$</span>variable), <span class="dt">ordered =</span> <span class="ot">TRUE</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_percentile, <span class="dt">y =</span> value, <span class="dt">color =</span> variable)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="Budget2018-atlas/unnamed-chunk-26-1.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
baseline_share &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[id <span class="op">==</span><span class="st"> "Budget2018_baseline"</span> <span class="op">&amp;</span><span class="st"> </span>fy_year <span class="op">==</span><span class="st"> "2027-28"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total_delta =</span> <span class="kw">sum</span>(delta)), keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>total_delta <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_delta)] 

govt_share &lt;-<span class="st"> </span>
<span class="st">  </span>bound_models[id <span class="op">==</span><span class="st"> "Budget2018"</span> <span class="op">&amp;</span><span class="st"> </span>fy_year <span class="op">==</span><span class="st"> "2027-28"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total_delta =</span> <span class="kw">sum</span>(delta)), keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>total_delta <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_delta)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"prop-share-tax-benefit-govt-by-decile.csv"</span>)

alternative_share &lt;-<span class="st"> </span>
<span class="st">  </span>alternative <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total_delta =</span> <span class="kw">sum</span>(delta)), keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_percentile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>total_delta <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total_delta)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"prop-share-tax-benefit-alternative-by-decile.csv"</span>)

alternative <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">old_tot_tax_paid =</span> <span class="kw">sum</span>(baseline_tax <span class="op">*</span><span class="st"> </span>WEIGHT), 
        <span class="dt">new_tot_tax_paid =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT)), 
    keyby =<span class="st"> </span>.(<span class="dt">Taxable_Income_decile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">10</span>))] <span class="op">%&gt;%</span>
<span class="st">  </span>.[] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">melt.data.table</span>(<span class="dt">id.vars =</span> <span class="kw">key</span>(.)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Taxable_Income_decile, <span class="dt">y =</span> value, <span class="dt">fill =</span> variable)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">"dodge"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">paste0</span>(<span class="kw">grattan_dollar</span>(x <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>), <span class="st">" bn"</span>))</code></pre></div>
<p><img src="Budget2018-atlas/unnamed-chunk-26-2.png" width="864"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bound_models <span class="op">%&gt;%</span>
<span class="st">  </span>.[id <span class="op">==</span><span class="st"> "Budget2018"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Quintile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">ntile</span>(Taxable_Income, <span class="dv">5</span>), keyby =<span class="st"> "fy_year"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total_delta_bn =</span> <span class="kw">sum</span>((new_tax <span class="op">-</span><span class="st"> </span>baseline_tax) <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>), 
        <span class="dt">max_income =</span> <span class="kw">max</span>(Taxable_Income),
        <span class="dt">min_income =</span> <span class="kw">min</span>(Taxable_Income), 
        <span class="dt">avg_income =</span> <span class="kw">mean</span>(Taxable_Income)), 
    keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, <span class="st">"Financial year ending"</span> <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/is.fy.html">fy2yr</a></span>(.BY[[<span class="dv">1</span>]]), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, total_delta_bn <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total_delta_bn, <span class="dv">2</span>), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_income <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(avg_income, <span class="dv">2</span>), keyby =<span class="st"> </span><span class="kw">c</span>(<span class="st">"fy_year"</span>, <span class="st">"Quintile"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setorder</span>(fy_year, <span class="op">-</span>Quintile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"budget2018-total-revenue-vs-fy-by-quintile.csv"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw"><a href="../../reference/revenue_foregone.html">revenue_foregone</a></span>(Budget_<span class="dv">1922</span>[[<span class="st">"2018-19"</span>]][[<span class="st">"Budget2018_baseline_brackets_cpi"</span>]]))
<span class="co">#&gt; [1] "-\\$2.3 billion"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_rate_by_percentile_brackets_cpi &lt;-
<span class="st">  </span><span class="kw">lapply</span>(Budget_<span class="dv">1922</span>, <span class="cf">function</span>(x) {
    x[[<span class="st">"Budget2018_baseline_brackets_cpi"</span>]][, .(Taxable_Income, new_tax)]
    }) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbindlist</span>(<span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>, <span class="dt">idcol =</span> <span class="st">"fy_year"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, avg_tax_rate <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">coalesce</span>(new_tax <span class="op">/</span><span class="st"> </span>Taxable_Income, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avg_tax_rate =</span> <span class="kw">mean</span>(avg_tax_rate)), 
    keyby =<span class="st"> </span>.(fy_year, <span class="dt">Taxable_Income_percentile =</span> <span class="kw">ntile</span>(Taxable_Income, <span class="dv">100</span>))]
<span class="kw">fwrite</span>(avg_tax_rate_by_percentile_brackets_cpi,
       <span class="st">"avg_tax_rate_by_percentile_brackets_cpi.csv"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">total_population_<span class="dv">1516</span> &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../../reference/aus_pop_qtr_age.html">aus_pop_qtr_age</a></span>(<span class="dt">date =</span> <span class="kw">as.Date</span>(<span class="st">"2016-01-01"</span>),
                  <span class="dt">age =</span> <span class="dv">15</span><span class="op">:</span><span class="dv">100</span>,
                  <span class="dt">tbl =</span> <span class="ot">TRUE</span>) <span class="op">%$%</span>
<span class="st">  </span><span class="kw">sum</span>(Value) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">multiply_by</span>(s1718[<span class="dv">1</span>][[<span class="st">"WEIGHT"</span>]] <span class="op">/</span><span class="st"> </span><span class="dv">50</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">taxable_individuals_<span class="dv">1718</span> &lt;-<span class="st"> </span>s1718[, <span class="kw">sum</span>(WEIGHT)]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">avg_tax_by_decile_allpersons201718 &lt;-<span class="st"> </span>
<span class="st">  </span>s1718[, .(new_tax, <span class="dt">baseline_tax =</span> <span class="kw">as.double</span>(baseline_tax), Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(new_tax)), keyby =<span class="st"> "Taxable_Income_decile"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total), <span class="dv">3</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_decile_allpersons201718.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]

wt_rel1718v202425 &lt;-<span class="st"> </span>
<span class="st">  </span>.project_useTreasurys[[<span class="dv">2025</span><span class="op">-</span><span class="dv">2016</span>]][<span class="dv">1</span>][[<span class="st">"WEIGHT"</span>]] <span class="op">/</span><span class="st"> </span>s1718[<span class="dv">1</span>][[<span class="st">"WEIGHT"</span>]]

avg_tax_by_decile_allpersons202425 &lt;-<span class="st"> </span>
<span class="st">  </span>Budget_<span class="dv">1922</span>[[<span class="st">"2027-28"</span>]][[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202425 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(new_tax)), keyby =<span class="st"> "Taxable_Income_decile"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total), <span class="dv">3</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_decile_allpersons202425.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]

wt_rel1718v202728 &lt;-<span class="st"> </span>
<span class="st">  </span>.project_useTreasurys[[<span class="dv">12</span>]][<span class="dv">1</span>][[<span class="st">"WEIGHT"</span>]] <span class="op">/</span><span class="st"> </span>s1718[<span class="dv">1</span>][[<span class="st">"WEIGHT"</span>]]

avg_tax_by_decile_allpersons202728 &lt;-<span class="st"> </span>
<span class="st">  </span>Budget_<span class="dv">1922</span>[[<span class="st">"2027-28"</span>]][[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202728 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">total =</span> <span class="kw">sum</span>(new_tax)), keyby =<span class="st"> "Taxable_Income_decile"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, share <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(total <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(total), <span class="dv">3</span>)] <span class="op">%T&gt;%</span>
<span class="st">  </span><span class="kw">fwrite</span>(<span class="st">"avg_tax_by_decile_allpersons202728.csv"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">decile201718 &lt;-<span class="st"> </span>
<span class="st">  </span>s1718[, .(new_tax, <span class="dt">baseline_tax =</span> <span class="kw">as.double</span>(baseline_tax), Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span><span class="kw">sum</span>(sample_files_all[fy.year <span class="op">==</span><span class="st"> "2015-16"</span>][[<span class="st">"WEIGHT"</span>]])), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>,
        <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, Taxable_Income_decile <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../../reference/weighted_ntile.html">weighted_ntile</a></span>(Taxable_Income, WEIGHT, <span class="dv">10</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">Taxable_Income =</span> <span class="kw">min</span>(Taxable_Income),
        <span class="dt">tot =</span> <span class="kw">sum</span>(baseline_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)),
    keyby =<span class="st"> </span>.(Taxable_Income_decile)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, min_Taxable_Income <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">round</span>(Taxable_Income, <span class="op">-</span><span class="dv">3</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">  </span>.[]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Budget_<span class="dv">1922</span>[[<span class="st">"2027-28"</span>]][[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202728 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(new_tax, baseline_tax, Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">  </span>decile201718[., roll =<span class="st"> </span><span class="ot">TRUE</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(new_tax)), keyby =<span class="st"> </span>.(Taxable_Income_decile, min_Taxable_Income)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]
<span class="co">#&gt;    Taxable_Income_decile min_Taxable_Income        tot         prop</span>
<span class="co">#&gt; 1:                     1                  0          0 0.0000000000</span>
<span class="co">#&gt; 2:                     4                  0          0 0.0000000000</span>
<span class="co">#&gt; 3:                     5              11000     692756 0.0001179139</span>
<span class="co">#&gt; 4:                     6              24000   56360042 0.0095930310</span>
<span class="co">#&gt; 5:                     7              37000  167886456 0.0285759187</span>
<span class="co">#&gt; 6:                     8              50000  438633631 0.0746597389</span>
<span class="co">#&gt; 7:                     9              68000  854864491 0.1455063068</span>
<span class="co">#&gt; 8:                    10              98000 4356665288 0.7415470907</span>

Budget_<span class="dv">1922</span>[[<span class="st">"2024-25"</span>]][[<span class="st">"Budget2018"</span>]] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rbind</span>(<span class="kw">data.table</span>(<span class="dt">new_tax =</span> <span class="dv">0</span>,
                   <span class="dt">baseline_tax =</span> <span class="dv">0</span>,
                   <span class="dt">Taxable_Income =</span> 0L,
                   <span class="dt">WEIGHT =</span> wt_rel1718v202728 <span class="op">*</span><span class="st"> </span>(total_population_<span class="dv">1516</span> <span class="op">-</span><span class="st"> </span>taxable_individuals_<span class="dv">1718</span>)), 
        <span class="dt">use.names =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(new_tax, baseline_tax, Taxable_Income, WEIGHT)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setkey</span>(Taxable_Income) <span class="op">%&gt;%</span>
<span class="st">  </span>decile201718[., roll =<span class="st"> </span><span class="ot">TRUE</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">tot =</span> <span class="kw">sum</span>(new_tax <span class="op">*</span><span class="st"> </span>WEIGHT <span class="op">/</span><span class="st"> </span><span class="fl">1e9</span>)), keyby =<span class="st"> </span>.(Taxable_Income_decile, min_Taxable_Income)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, prop <span class="op">:</span><span class="er">=</span><span class="st"> </span>tot <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(tot)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[]
<span class="co">#&gt;    Taxable_Income_decile min_Taxable_Income          tot         prop</span>
<span class="co">#&gt; 1:                     1                  0   0.00000000 0.0000000000</span>
<span class="co">#&gt; 2:                     4                  0   0.00000000 0.0000000000</span>
<span class="co">#&gt; 3:                     5              11000   0.04636691 0.0001534935</span>
<span class="co">#&gt; 4:                     6              24000   3.65400226 0.0120962487</span>
<span class="co">#&gt; 5:                     7              37000  10.98884486 0.0363775910</span>
<span class="co">#&gt; 6:                     8              50000  26.13241133 0.0865090174</span>
<span class="co">#&gt; 7:                     9              68000  49.44407838 0.1636802125</span>
<span class="co">#&gt; 8:                    10              98000 211.81160689 0.7011834370</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#effect-of-sbto">Effect of SBTO</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hugh Parsonage, Tim Cameron, Brendan Coates, William Young.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
